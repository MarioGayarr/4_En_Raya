# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\main.asm
  1   0000                     DEVICE ZXSPECTRUM48
  2   0000                     SLDOPT COMMENT WPMEM, LOGPOINT, ASSETION
  3   0000                     org $8000               ; Programa ubicado a partir de $8000 = 32768
  4   8000 31 00 00            ld sp, 0
  5   8003 C3 D5 9B            jp inicio
  6   8006              portada: INCBIN "portada.scr"
  7   9B06
  8   9B06              M_WL:
  9   9B06 42 69 65 6E         DB "Bienvenido al Conecta 4", 0
  9   9B0A 76 65 6E 69
  9   9B0E 64 6F 20 61
  9   9B12 6C 20 43 6F
  9   9B16 6E 65 63 74
  9   9B1A 61 20 34 00
 10   9B1E              M_PR:
 11   9B1E 51 75 69 65         DB "Quieres jugar?", 0
 11   9B22 72 65 73 20
 11   9B26 6A 75 67 61
 11   9B2A 72 3F 00
 12   9B2D              M_GB:
 13   9B2D 41 64 69 6F         DB "Adios!!!!", 0
 13   9B31 73 21 21 21
 13   9B35 21 00
 14   9B37              M_RS:
 15   9B37 00 00               DB 0,0
 16   9B39              M_PF:
 17   9B39 4C 61 20 70         DB "La partida ha finalizado  ", 0
 17   9B3D 61 72 74 69
 17   9B41 64 61 20 68
 17   9B45 61 20 66 69
 17   9B49 6E 61 6C 69
 17   9B4D 7A 61 64 6F
 17   9B51 20 20 00
 18   9B54              M_QJ:
 19   9B54 51 75 69 65         DB "Quieres jugar otra partida? ", 0
 19   9B58 72 65 73 20
 19   9B5C 6A 75 67 61
 19   9B60 72 20 6F 74
 19   9B64 72 61 20 70
 19   9B68 61 72 74 69
 19   9B6C 64 61 3F 20
 19   9B70 00
 20   9B71 00           FullTablero DB 0
 21   9B72 00           ColumnaFull db 0
 22   9B73 00           Caracter DB 0
 23   9B74              PAPEL_Azul EQU 1*8
 24   9B74              TINTA_Yel EQU 6
 25   9B74              TINTA_Red EQU 2
 26   9B74              TINTA_Blck EQU 0
 27   9B74 06           Color_Usuario db TINTA_Yel
 28   9B75              POS_MAX EQU $3A ;$5839 EN ATRIBUTOS (+24)
 29   9B75              POS_MIN EQU $20 ;$5821
 30   9B75              ;nuevas pos max
 31   9B75              POS_MAX1 EQU 6 ;$5839 EN ATRIBUTOS , en fila 7 en L
 32   9B75              POS_MIN1 EQU 0 ;columna inicial en atributos
 33   9B75              Posiciones:
 34   9B75 00 00 00 00         db 0,0,0,0,0,0,0
 34   9B79 00 00 00
 35   9B7C 00 00 00 00         db 0,0,0,0,0,0,0
 35   9B80 00 00 00
 36   9B83 00 00 00 00         db 0,0,0,0,0,0,0
 36   9B87 00 00 00
 37   9B8A 00 00 00 00         db 0,0,0,0,0,0,0
 37   9B8E 00 00 00
 38   9B91 00 00 00 00         db 0,0,0,0,0,0,0
 38   9B95 00 00 00
 39   9B98 00 00 00 00         db 0,0,0,0,0,0,0
 39   9B9C 00 00 00
 40   9B9F              Posiciones1:; poner $ff, cambiar rutina limpieza
 41   9B9F FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 41   9BA3 00 00 00 00
 41   9BA7 FF
 42   9BA8 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 42   9BAC 00 00 00 00
 42   9BB0 FF
 43   9BB1 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 43   9BB5 00 00 00 00
 43   9BB9 FF
 44   9BBA FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 44   9BBE 00 00 00 00
 44   9BC2 FF
 45   9BC3 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 45   9BC7 00 00 00 00
 45   9BCB FF
 46   9BCC FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 46   9BD0 00 00 00 00
 46   9BD4 FF
 47   9BD5
 48   9BD5              ;recomendado usar DE para color y n.judador con EXX para ir cambiando
 49   9BD5              inicio:
 50   9BD5
 51   9BD5 3E 00               LD A, 0
 52   9BD7 D3 FE               OUT ($FE), A
 53   9BD9 CD A9 9C            CALL CLEARSCR
 54   9BDC CD 93 A0            CALL IMPORT_DRAW
 55   9BDF 06 00               LD B, 0
 56   9BE1 0E 05               LD C, 5
 57   9BE3 3E 42               LD A, 2+0*8+64
 58   9BE5 DD 21 06 9B         LD IX, M_WL
 59   9BE9 CD 38 9C            CALL PRINTAT
 60   9BEC
 61   9BEC 3E 06               LD A, 6
 62   9BEE 06 14               LD B, 20
 63   9BF0 0E 01               LD C, 1
 64   9BF2 DD 21 1E 9B         LD IX, M_PR
 65   9BF6 CD 38 9C            CALL PRINTAT
 66   9BF9 3E B0               LD A, 6*8+128
 67   9BFB 32 90 5A            LD ($5800+20*32+16), A
 68   9BFE
 69   9BFE CD 32 A5            CALL LEER_SN
 70   9C01 20 34               JR NZ, fin
 71   9C03 CD DE A4            CALL JUEGO ;al salir la primera vez con F baja a jugar nuevamente.
 72   9C06
 73   9C06              JUGAR_NUEVAMENTE:  ; empieza limpiando e imprimiendo los dos textos de la pantalla
 74   9C06 3E 00               LD A, 0
 75   9C08 D3 FE               OUT ($FE), A
 76   9C0A CD A9 9C            CALL CLEARSCR
 77   9C0D 06 01               LD B, 1
 78   9C0F 0E 05               LD C, 5
 79   9C11 3E 01               LD A, 1
 80   9C13 DD 21 39 9B         LD IX, M_PF
 81   9C17 CD 38 9C            CALL PRINTAT
 82   9C1A
 83   9C1A 3E 06               LD A, 6
 84   9C1C 06 0C               LD B, 12
 85   9C1E 0E 01               LD C, 1
 86   9C20 DD 21 54 9B         LD IX, M_QJ
 87   9C24 CD 38 9C            CALL PRINTAT
 88   9C27 3E B0               LD A, 6*8+128
 89   9C29 32 9E 59            LD ($5800+12*32+30), A
 90   9C2C CD 32 A5            CALL LEER_SN     ; hace la funcion nuevamente de la pantalla inicial
 91   9C2F 20 06               JR NZ, fin
 92   9C31
 93   9C31 CD DE A4            CALL JUEGO
 94   9C34 C3 06 9C            JP JUGAR_NUEVAMENTE
 95   9C37              fin:
 96   9C37 76                  HALT
 97   9C38
 98   9C38                      INCLUDE "PRINTAT.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\PRINTAT.asm
  1+  9C38              ; -------------------------------
  2+  9C38              ; ZX Spectrum Text print library
  3+  9C38              ; Daniel León - AOC - UFV 2020
  4+  9C38              ; -------------------------------
  5+  9C38
  6+  9C38
  7+  9C38              ; ----------------------------------------------------------------------------------------
  8+  9C38              ; PRINTAT - Print a string in a position and attributes as per registers:
  9+  9C38              ;		IN	A	: Bit 7=1 For Flash / Bit 6=1 For Brigh / Bit 5,4,3 for Paper / Bit 2,1,0 for Ink
 10+  9C38              ;		IN	B	: Row 0..23
 11+  9C38              ;		IN	C	: Column 0..31
 12+  9C38              ;		IN	IX	: Address of text (Text must end in a 0)
 13+  9C38              ; ----------------------------------------------------------------------------------------
 14+  9C38 CD 47 9C     PRINTAT:	CALL PREP_PRT				; Update Attribute var &Screen & Attributes pointers
 15+  9C3B              ; ----------------------------------------------------------------------------------------
 16+  9C3B              ;		VVV Do not move PRINTSTR below as PRINTAT continues into PRINTSTR routine
 17+  9C3B              ; ----------------------------------------------------------------------------------------
 18+  9C3B              ; PRINTSTR - Prints String - IX Points to the String start
 19+  9C3B              ; ----------------------------------------------------------------------------------------
 20+  9C3B DD 7E 00     PRINTSTR:   LD A,(IX)					; A Contains first char to print
 21+  9C3E B7           			OR A						; check for end of string (0)
 22+  9C3F C8           			RET Z						; Finish printing if 0
 23+  9C40 CD 75 9C     			CALL PRINTCHNUM
 24+  9C43 DD 23        			INC IX						; Move to next char in string
 25+  9C45 18 F4        			JR PRINTSTR					; Start over printing sequence
 26+  9C47              ; ----------------------------------------------------------------------------------------
 27+  9C47
 28+  9C47
 29+  9C47              ;-----------------------------------------------------------------------------------------
 30+  9C47              ; PREP_PRT - Updates Print_Attr, SCR & ATTR Vars
 31+  9C47              ;-----------------------------------------------------------------------------------------
 32+  9C47 32 BB 9C     PREP_PRT:	LD (PRINT_ATTR),A			; Set Attribute
 33+  9C4A CD 50 9C     PREP_PRT_2:	CALL CRtoSCREEN
 34+  9C4D C3 62 9C     			JP CRtoATTR
 35+  9C50              ;-----------------------------------------------------------------------------------------
 36+  9C50
 37+  9C50              ;-----------------------------------------------------------------------------------------
 38+  9C50              ; CRtoSCREEN - Converts a scr char coord into a SCREEN Address   b,c = y,x positions
 39+  9C50              ;	IN  - B=Row, C=Column
 40+  9C50              ;	OUT - HL=Address in screen also stored in (SCR_CUR_PTR)
 41+  9C50              ;	Conversion:
 42+  9C50              ;			Row FFfff   Column CCCCC
 43+  9C50              ;			HL=%010FF000 fffCCCCC
 44+  9C50              ;-----------------------------------------------------------------------------------------
 45+  9C50              CRtoSCREEN:
 46+  9C50 78           			LD A,B						; %___FFfff
 47+  9C51 F6 40        			OR #40						; %010FFfff
 48+  9C53 E6 F8        			AND #F8						; %010FF000
 49+  9C55 67           			LD H,A
 50+  9C56
 51+  9C56 78           			LD A,B						; %___FFfff
 52+  9C57 E6 07        			AND #7						; %00000fff
 53+  9C59 0F           			RRCA						; %f00000ff
 54+  9C5A 0F           			RRCA						; %ff00000f
 55+  9C5B 0F           			RRCA						; %fff00000
 56+  9C5C B1           			OR C						; %fffCCCCC
 57+  9C5D 6F           			LD L,A
 58+  9C5E 22 B7 9C                 LD (SCR_CUR_PTR),HL			; Update Variable
 59+  9C61 C9                       RET
 60+  9C62              ; ----------------------------------------------------------------------------------------
 61+  9C62
 62+  9C62
 63+  9C62
 64+  9C62              ;-----------------------------------------------------------------------------------------
 65+  9C62              ; CRtoATTR - Converts a screen char coord  into a ATTR Address  b,c = y,x positions
 66+  9C62              ;	IN  - B=Row, C=Column
 67+  9C62              ;	OUT - HL=Address in screen also stored in (SCR_ATTR_PTR)
 68+  9C62              ;	Conversion:
 69+  9C62              ;			Row FFfff   Column CCCCC
 70+  9C62              ;			HL=%010110FF fffCCCCC
 71+  9C62              ;-----------------------------------------------------------------------------------------
 72+  9C62              CRtoATTR:
 73+  9C62 78           			LD A,B						; %___FFfff
 74+  9C63 0F           			RRCA						; %f000FFff
 75+  9C64 0F           			RRCA						; %ff000FFf
 76+  9C65 0F           			RRCA						; %fff000FF
 77+  9C66 6F           			LD L,A
 78+  9C67 E6 03        			AND 3						; %000000FF	value of FF can be only 00,01,10
 79+  9C69 F6 58        			OR #58						; %010110FF value will be #58, #59 or #5A
 80+  9C6B 67           			LD H,A
 81+  9C6C
 82+  9C6C 7D           			LD A,L						; %fff000FF
 83+  9C6D E6 E0        			AND #E0						; %fff00000
 84+  9C6F B1           			OR C						; %fffCCCCC
 85+  9C70 6F           			LD L,A
 86+  9C71
 87+  9C71 22 B9 9C                 LD (SCR_ATTR_PTR),HL		; Update Variable
 88+  9C74 C9                       RET
 89+  9C75              ; ----------------------------------------------------------------------------------------
 90+  9C75
 91+  9C75
 92+  9C75
 93+  9C75              ; ----------------------------------------------------------------------------------------
 94+  9C75              ; PRINTCHNUM - Prints Char Number N (stored in A)
 95+  9C75              ;-----------------------------------------------------------------------------------------
 96+  9C75              PRINTCHNUM:	;SUB 32						; Adjust Ascii to charset
 97+  9C75 26 00        			LD H,0						; Multiply value by 8 to get to right Char in Charset
 98+  9C77 6F           			LD L,A
 99+  9C78 29           			ADD HL,HL
100+  9C79 29           			ADD HL,HL
101+  9C7A 29           			ADD HL,HL
102+  9C7B 11 BC 9B     			LD DE, CHARSET-(8*32)		; Optimize in compile time (instead of sub 32)
103+  9C7E 19           			ADD HL,DE
104+  9C7F EB           			EX  DE,HL					;Value in DE
105+  9C80              			; Continues to printchar below
106+  9C80              ; ----------------------------------------------------------------------------------------
107+  9C80
108+  9C80
109+  9C80              ; ----------------------------------------------------------------------------------------
110+  9C80              ; PRINTCHAR - Prints Char  (DE points to the char. Uses HL as last Cur Pointer)
111+  9C80              ; ----------------------------------------------------------------------------------------
112+  9C80              PRINTCHAR:
113+  9C80 06 08        			LD B,8						; 8 Lines per char
114+  9C82 2A B7 9C                 LD HL, (SCR_CUR_PTR)		; Load Cursor Pointer y,x
115+  9C85
116+  9C85 1A           BYTEPCHAR:	LD A,(DE)					; Get Char to be printed, first line
117+  9C86 77           			LD (HL),A					; Move to Printing location
118+  9C87 24                       INC H						; inc H so next line in char (ZX Spectrum Screen RAM)
119+  9C88 13                       INC DE 						; next line to be printed
120+  9C89 10 FA                    DJNZ BYTEPCHAR				; Repeat 8 lines
121+  9C8B 3A BB 9C                 LD A,(PRINT_ATTR) 			; Load Attributes to print char with
122+  9C8E 2A B9 9C                 LD HL, (SCR_ATTR_PTR)
123+  9C91 77                       LD (HL),A
124+  9C92 21 B9 9C                 LD HL, SCR_ATTR_PTR			; Get pointer to ATTR
125+  9C95 34                       INC (HL)					; Move Attribute cursor to next char
126+  9C96 21 B7 9C     			LD HL, SCR_CUR_PTR
127+  9C99 34           			INC (HL)					; update Cursor pointer to next position
128+  9C9A C9                       RET
129+  9C9B              ; ----------------------------------------------------------------------------------------
130+  9C9B
131+  9C9B
132+  9C9B
133+  9C9B              ; ----------------------------------------------------------------------------------------
134+  9C9B              ; INK2PAPER - moves ink of attribute stored in (PRINT_ATTR) to paper and sets ink to 0
135+  9C9B              ; 				Sets bright 1 and flash 0
136+  9C9B              ; ----------------------------------------------------------------------------------------
137+  9C9B 3A BB 9C     INK2PAPER:	LD A, (PRINT_ATTR)		    ; Get storedAttribute
138+  9C9E E6 07                    AND 7						; get Attr INK in A
139+  9CA0 07           			RLCA
140+  9CA1 07           			RLCA
141+  9CA2 07           			RLCA						; move Ink to Paper
142+  9CA3 F6 40        			OR 64						; ink 0 bright 1
143+  9CA5 32 BB 9C     			LD (PRINT_ATTR),A		    ; Get storedAttribute
144+  9CA8 C9           			RET
145+  9CA9              ; ----------------------------------------------------------------------------------------
146+  9CA9
147+  9CA9
148+  9CA9
149+  9CA9
150+  9CA9 21 00 40     CLEARSCR:	LD HL,$4000					; Erases screen by writing 0 to all pixels and attributes
151+  9CAC 11 01 40     			LD DE,$4001
152+  9CAF 01 FF 1A     			LD BC,6911
153+  9CB2 36 00        			LD (HL),0
154+  9CB4 ED B0        			LDIR
155+  9CB6 C9           			RET
156+  9CB7
157+  9CB7
158+  9CB7              SCR_CUR_PTR
158+  9CB7 00 00          	db $00, $00				; Cursor Pointer in Screen (2 bytes) (HL)
159+  9CB9 00 00        SCR_ATTR_PTR: 	db $00, $00				; Attr Pointer in Screen (2 bytes) (HL)
160+  9CBB 00           PRINT_ATTR:		db $00					; Attribute used by printchar routine (1 byte)
161+  9CBC
162+  9CBC              CHARSET: incbin "charset.bin"			; Charset used
163+  9FBC
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\PRINTAT.asm
 99   9FBC                      INCLUDE "TABLERO.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\TABLERO.asm
  1+  9FBC
  2+  9FBC              TABLERO_REDONDO:
  3+  9FBC E5                   push hl
  4+  9FBD DD E5                push ix
  5+  9FBF D5                   push de
  6+  9FC0 C5                   push bc
  7+  9FC1 F5                   push AF
  8+  9FC2
  9+  9FC2 CD A9 9C             CALL CLEARSCR
 10+  9FC5
 11+  9FC5                      ; Dibujar el fondo del tablero primero
 12+  9FC5 21 60 58             LD HL, $5800 + 96     ; HL se mueve 3 filas hacia abajo, dejando espacio arriba para ficha amarilla
 13+  9FC8 E5 DD E1             LD IX,HL
 14+  9FCB
 15+  9FCB 3E 08                LD A, 8             ; A = 8, color azul para las barras del tablero
 16+  9FCD 06 13                LD B, 19            ; B = 19, número de filas
 17+  9FCF              FullCuadrao:
 18+  9FCF 0E 1D                LD C, 29
 19+  9FD1              COLUMNA:
 20+  9FD1 77                   LD (HL), A          ; Escribe el color azul en HL
 21+  9FD2 23                   INC HL              ; Avanza HL al siguiente byte
 22+  9FD3 0D                   DEC C               ; Disminuye contador de columnas
 23+  9FD4 20 FB                JR NZ, COLUMNA
 24+  9FD6 11 20 00             LD DE, 32
 25+  9FD9 DD 19                ADD IX,DE
 26+  9FDB DD E5 E1             LD HL,IX
 27+  9FDE 05                   DEC B
 28+  9FDF 20 EE                JR NZ, FullCuadrao
 29+  9FE1              ; Fila 0: $4021 / $5821
 30+  9FE1 3E 00                LD A, 0
 31+  9FE3 32 74 9B             LD (Color_Usuario), A
 32+  9FE6 DD 21 21 40          LD IX, $4021
 33+  9FEA 21 21 58             LD HL, $5821
 34+  9FED 0E 07                LD C, 7
 35+  9FEF
 36+  9FEF              FilaColumnas0:
 37+  9FEF CD A5 A0             CALL FICHA
 38+  9FF2 11 04 00             LD DE, 4
 39+  9FF5 DD 19                ADD IX, DE
 40+  9FF7 19                   ADD HL, DE
 41+  9FF8 0D                   DEC C
 42+  9FF9 20 F4                JR NZ, FilaColumnas0
 43+  9FFB
 44+  9FFB                      ; Fila 2: $40E1 / $5881+96
 45+  9FFB DD 21 E1 40          LD IX, $40E1
 46+  9FFF 21 E1 58             LD HL, $5881 + 96
 47+  A002 0E 07                LD C, 7
 48+  A004              ; Fila 1: $4081 / $5881
 49+  A004 3E 08                LD A, %00001000     ; pongo la ficha en negro
 50+  A006 32 74 9B             LD (Color_Usuario), A
 51+  A009 DD 21 81 40          LD IX, $4081
 52+  A00D 21 81 58             LD HL, $5881
 53+  A010 0E 07                LD C, 7
 54+  A012              FilaColumnas1:
 55+  A012 CD A5 A0             CALL FICHA
 56+  A015 11 04 00             LD DE, 4
 57+  A018 DD 19                ADD IX, DE
 58+  A01A 19                   ADD HL, DE
 59+  A01B 0D                   DEC C
 60+  A01C 20 F4                JR NZ, FilaColumnas1
 61+  A01E
 62+  A01E                      ; Fila 2: $40E1 / $5881+96
 63+  A01E DD 21 E1 40          LD IX, $40E1
 64+  A022 21 E1 58             LD HL, $5881 + 96
 65+  A025 0E 07                LD C, 7
 66+  A027              FilaColumnas2:
 67+  A027 CD A5 A0             CALL FICHA
 68+  A02A 11 04 00             LD DE, 4
 69+  A02D DD 19                ADD IX, DE
 70+  A02F 19                   ADD HL, DE
 71+  A030 0D                   DEC C
 72+  A031 20 F4                JR NZ, FilaColumnas2
 73+  A033
 74+  A033                      ; Fila 3: $4841 / $5881+192
 75+  A033 DD 21 41 48          LD IX, $4841
 76+  A037 21 41 59             LD HL, $5881 + 192
 77+  A03A 0E 07                LD C, 7
 78+  A03C              FilaColumnas3:
 79+  A03C CD A5 A0             CALL FICHA
 80+  A03F 11 04 00             LD DE, 4
 81+  A042 DD 19                ADD IX, DE
 82+  A044 19                   ADD HL, DE
 83+  A045 0D                   DEC C
 84+  A046 20 F4                JR NZ, FilaColumnas3
 85+  A048
 86+  A048                      ; Fila 4: $48A1 / $5881+288
 87+  A048 DD 21 A1 48          LD IX, $48A1
 88+  A04C 21 A1 59             LD HL, $5881 + 288
 89+  A04F 0E 07                LD C, 7
 90+  A051              FilaColumnas4:
 91+  A051 CD A5 A0             CALL FICHA
 92+  A054 11 04 00             LD DE, 4
 93+  A057 DD 19                ADD IX, DE
 94+  A059 19                   ADD HL, DE
 95+  A05A 0D                   DEC C
 96+  A05B 20 F4                JR NZ, FilaColumnas4
 97+  A05D
 98+  A05D                      ; Fila 5: $5001 / $5881+384
 99+  A05D DD 21 01 50          LD IX, $5001
100+  A061 21 01 5A             LD HL, $5881 + 384
101+  A064 0E 07                LD C, 7
102+  A066              FilaColumnas5:
103+  A066 CD A5 A0             CALL FICHA
104+  A069 11 04 00             LD DE, 4
105+  A06C DD 19                ADD IX, DE
106+  A06E 19                   ADD HL, DE
107+  A06F 0D                   DEC C
108+  A070 20 F4                JR NZ, FilaColumnas5
109+  A072
110+  A072                      ; Fila 6: $5061 / $5881+480
111+  A072 DD 21 61 50          LD IX, $5061
112+  A076 21 61 5A             LD HL, $5881 + 480
113+  A079 0E 07                LD C, 7
114+  A07B              FilaColumnas6:
115+  A07B CD A5 A0             CALL FICHA
116+  A07E 11 04 00             LD DE, 4
117+  A081 DD 19                ADD IX, DE
118+  A083 19                   ADD HL, DE
119+  A084 0D                   DEC C
120+  A085 20 F4                JR NZ, FilaColumnas6
121+  A087
122+  A087 3E 06                LD A, 6
123+  A089 32 74 9B             LD (Color_Usuario), A
124+  A08C
125+  A08C F1                   pop AF
126+  A08D C1                   pop bc
127+  A08E D1                   pop de
128+  A08F DD E1                pop ix
129+  A091 E1                   pop hl
130+  A092
131+  A092 C9                   RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\TABLERO.asm
100   A093                      INCLUDE "Importar_portada.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\Importar_portada.asm
  1+  A093              IMPORT_DRAW:
  2+  A093 E5               PUSH HL
  3+  A094 D5               PUSH DE
  4+  A095 C5               PUSH BC
  5+  A096 21 06 80         LD HL, portada
  6+  A099 11 00 40         LD DE, $4000
  7+  A09C 01 00 1B         LD BC, 6912
  8+  A09F ED B0            LDIR
  9+  A0A1 C1               POP BC
 10+  A0A2 D1               POP DE
 11+  A0A3 E1               POP HL
 12+  A0A4 C9               RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\Importar_portada.asm
101   A0A5                      INCLUDE "pintaficha1.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\pintaficha1.asm
  1+  A0A5              FICHA:; coje hl para pintar cuadrado y ix para la bola
  2+  A0A5 E5                   push hl
  3+  A0A6 D5                   push de
  4+  A0A7 C5                   push bc
  5+  A0A8 DD E5                push ix
  6+  A0AA F5                   PUSH AF
  7+  A0AB CD 18 A3             CALL PintaCuadrao
  8+  A0AE DD E5 E1             ld hl, ix
  9+  A0B1
 10+  A0B1                      ;Detectar si estamos en la fila problemática (segunda fila)
 11+  A0B1 7C                   LD A, H
 12+  A0B2 FE 40                CP $40
 13+  A0B4 20 0C                JR NZ, FICHA_NORMAL
 14+  A0B6 7D                   LD A, L
 15+  A0B7 FE E1                CP $E1
 16+  A0B9 38 07                JR C, FICHA_NORMAL    ; Si es menor que $E1, usar normal
 17+  A0BB FE FA                CP $FA
 18+  A0BD 30 03                JR NC, FICHA_NORMAL   ; Si es mayor o igual que $FA, usar normal
 19+  A0BF C3 EB A1             JP FICHA_ENTERCIO     ; Si está entre $E1 y $F9, usar específica
 20+  A0C2
 21+  A0C2              FICHA_NORMAL:
 22+  A0C2                      ;arriba izquierda
 23+  A0C2 3E 00                LD A,%00000000
 24+  A0C4 77                   LD(HL),A
 25+  A0C5 3E 01                LD A,%00000001
 26+  A0C7 11 00 01             LD DE, $100
 27+  A0CA 19                   ADD HL,DE
 28+  A0CB 77                   LD(HL),A
 29+  A0CC 3E 03                LD A,%00000011
 30+  A0CE 11 00 01             LD DE, $100
 31+  A0D1 19                   ADD HL,DE
 32+  A0D2 77                   LD(HL),A
 33+  A0D3 3E 07                LD A,%00000111
 34+  A0D5 11 00 01             LD DE, $100
 35+  A0D8 19                   ADD HL,DE
 36+  A0D9 77                   LD(HL),A
 37+  A0DA 11 00 01             LD DE, $100
 38+  A0DD 19                   ADD HL,DE
 39+  A0DE 77                   LD(HL),A
 40+  A0DF 3E 0F                LD A,%00001111
 41+  A0E1 11 00 01             LD DE, $100
 42+  A0E4 19                   ADD HL,DE
 43+  A0E5 77                   LD(HL),A
 44+  A0E6 11 00 01             LD DE, $100
 45+  A0E9 19                   ADD HL,DE
 46+  A0EA 77                   LD(HL),A
 47+  A0EB 11 00 01             LD DE, $100
 48+  A0EE 19                   ADD HL,DE
 49+  A0EF 77                   LD(HL),A
 50+  A0F0
 51+  A0F0                      ;arriba centro
 52+  A0F0 DD 23                INC IX
 53+  A0F2 DD E5 E1             LD HL, IX
 54+  A0F5
 55+  A0F5 3E 7E                LD A,%01111110
 56+  A0F7 77                   LD(HL),A
 57+  A0F8 3E FF                LD A,%11111111
 58+  A0FA 11 00 01             LD DE, $100
 59+  A0FD 19                   ADD HL,DE
 60+  A0FE 77                   LD(HL),A
 61+  A0FF 3E FF                LD A,%11111111
 62+  A101 11 00 01             LD DE, $100
 63+  A104 19                   ADD HL,DE
 64+  A105 77                   LD(HL),A
 65+  A106 11 00 01             LD DE, $100
 66+  A109 19                   ADD HL,DE
 67+  A10A 77                   LD(HL),A
 68+  A10B 11 00 01             LD DE, $100
 69+  A10E 19                   ADD HL,DE
 70+  A10F 77                   LD(HL),A
 71+  A110 11 00 01             LD DE, $100
 72+  A113 19                   ADD HL,DE
 73+  A114 77                   LD(HL),A
 74+  A115 11 00 01             LD DE, $100
 75+  A118 19                   ADD HL,DE
 76+  A119 77                   LD(HL),A
 77+  A11A 11 00 01             LD DE, $100
 78+  A11D 19                   ADD HL,DE
 79+  A11E 77                   LD(HL),A
 80+  A11F
 81+  A11F                      ;arriba derecha
 82+  A11F
 83+  A11F DD 23                INC IX
 84+  A121 DD E5 E1             LD HL, IX
 85+  A124 3E 00                LD A,%00000000
 86+  A126 77                   LD(HL),A
 87+  A127 3E 80                LD A,%10000000
 88+  A129 11 00 01             LD DE, $100
 89+  A12C 19                   ADD HL,DE
 90+  A12D 77                   LD(HL),A
 91+  A12E 3E C0                LD A,%11000000
 92+  A130 11 00 01             LD DE, $100
 93+  A133 19                   ADD HL,DE
 94+  A134 77                   LD(HL),A
 95+  A135 3E E0                LD A,%11100000
 96+  A137 11 00 01             LD DE, $100
 97+  A13A 19                   ADD HL,DE
 98+  A13B 77                   LD(HL),A
 99+  A13C 11 00 01             LD DE, $100
100+  A13F 19                   ADD HL,DE
101+  A140 77                   LD(HL),A
102+  A141 3E F0                LD A,%11110000
103+  A143 11 00 01             LD DE, $100
104+  A146 19                   ADD HL,DE
105+  A147 77                   LD(HL),A
106+  A148 11 00 01             LD DE, $100
107+  A14B 19                   ADD HL,DE
108+  A14C 77                   LD(HL),A
109+  A14D 11 00 01             LD DE, $100
110+  A150 19                   ADD HL,DE
111+  A151 77                   LD(HL),A
112+  A152
113+  A152
114+  A152                      ;ld de,32
115+  A152                      ;add hl, de
116+  A152
117+  A152                      ;abajo derecha
118+  A152
119+  A152 01 20 00             ld bc,$20
120+  A155 DD 09                ADD IX, BC
121+  A157 DD E5 E1             LD HL,IX
122+  A15A 3E F0                LD A,%11110000
123+  A15C 77                   LD(HL),A
124+  A15D 11 00 01             LD DE, $100
125+  A160 19                   ADD HL,DE
126+  A161 77                   LD(HL),A
127+  A162 11 00 01             LD DE, $100
128+  A165 19                   ADD HL,DE
129+  A166 77                   LD(HL),A
130+  A167 3E E0                LD A,%11100000
131+  A169 11 00 01             LD DE, $100
132+  A16C 19                   ADD HL,DE
133+  A16D 77                   LD(HL),A
134+  A16E 11 00 01             LD DE, $100
135+  A171 19                   ADD HL,DE
136+  A172 77                   LD(HL),A
137+  A173 3E C0                LD A,%11000000
138+  A175 11 00 01             LD DE, $100
139+  A178 19                   ADD HL,DE
140+  A179 77                   LD(HL),A
141+  A17A 3E 80                LD A,%10000000
142+  A17C 11 00 01             LD DE, $100
143+  A17F 19                   ADD HL,DE
144+  A180 77                   LD(HL),A
145+  A181 3E 00                LD A,%00000000
146+  A183 11 00 01             LD DE, $100
147+  A186 19                   ADD HL,DE
148+  A187 77                   LD(HL),A
149+  A188
150+  A188                      ;abajo centro
151+  A188
152+  A188 DD 2B                DEC IX
153+  A18A DD E5 E1             LD HL,IX
154+  A18D 3E FF                LD A,%11111111
155+  A18F 77                   LD(HL),A
156+  A190 11 00 01             LD DE, $100
157+  A193 19                   ADD HL,DE
158+  A194 77                   LD(HL),A
159+  A195 11 00 01             LD DE, $100
160+  A198 19                   ADD HL,DE
161+  A199 77                   LD(HL),A
162+  A19A 11 00 01             LD DE, $100
163+  A19D 19                   ADD HL,DE
164+  A19E 77                   LD(HL),A
165+  A19F 11 00 01             LD DE, $100
166+  A1A2 19                   ADD HL,DE
167+  A1A3 77                   LD(HL),A
168+  A1A4 11 00 01             LD DE, $100
169+  A1A7 19                   ADD HL,DE
170+  A1A8 77                   LD(HL),A
171+  A1A9 11 00 01             LD DE, $100
172+  A1AC 19                   ADD HL,DE
173+  A1AD 77                   LD(HL),A
174+  A1AE 11 00 01             LD DE, $100
175+  A1B1 19                   ADD HL,DE
176+  A1B2 3E 7E                LD A,%01111110
177+  A1B4 77                   LD(HL),A
178+  A1B5
179+  A1B5                      ;abajo izquierda
180+  A1B5 DD 2B                DEC IX
181+  A1B7 DD E5 E1             LD HL,IX
182+  A1BA 3E 0F                LD A,%00001111
183+  A1BC 77                   LD(HL),A
184+  A1BD 11 00 01             LD DE, $100
185+  A1C0 19                   ADD HL,DE
186+  A1C1 77                   LD(HL),A
187+  A1C2 11 00 01             LD DE, $100
188+  A1C5 19                   ADD HL,DE
189+  A1C6 77                   LD(HL),A
190+  A1C7 3E 07                LD A,%00000111
191+  A1C9 11 00 01             LD DE, $100
192+  A1CC 19                   ADD HL,DE
193+  A1CD 77                   LD(HL),A
194+  A1CE 11 00 01             LD DE, $100
195+  A1D1 19                   ADD HL,DE
196+  A1D2 77                   LD(HL),A
197+  A1D3 3E 03                LD A,%00000011
198+  A1D5 11 00 01             LD DE, $100
199+  A1D8 19                   ADD HL,DE
200+  A1D9 77                   LD(HL),A
201+  A1DA 3E 01                LD A,%00000001
202+  A1DC 11 00 01             LD DE, $100
203+  A1DF 19                   ADD HL,DE
204+  A1E0 77                   LD(HL),A
205+  A1E1 3E 00                LD A,%00000000
206+  A1E3 11 00 01             LD DE, $100
207+  A1E6 19                   ADD HL,DE
208+  A1E7 77                   LD(HL),A
209+  A1E8 C3 11 A3             jp Fin_Ficha
210+  A1EB
211+  A1EB              FICHA_ENTERCIO:
212+  A1EB                      ;arriba izquierda
213+  A1EB 3E 00                LD A,%00000000
214+  A1ED 77                   LD(HL),A
215+  A1EE 3E 01                LD A,%00000001
216+  A1F0 11 00 01             LD DE, $100
217+  A1F3 19                   ADD HL,DE
218+  A1F4 77                   LD(HL),A
219+  A1F5 3E 03                LD A,%00000011
220+  A1F7 11 00 01             LD DE, $100
221+  A1FA 19                   ADD HL,DE
222+  A1FB 77                   LD(HL),A
223+  A1FC 3E 07                LD A,%00000111
224+  A1FE 11 00 01             LD DE, $100
225+  A201 19                   ADD HL,DE
226+  A202 77                   LD(HL),A
227+  A203 11 00 01             LD DE, $100
228+  A206 19                   ADD HL,DE
229+  A207 77                   LD(HL),A
230+  A208 3E 0F                LD A,%00001111
231+  A20A 11 00 01             LD DE, $100
232+  A20D 19                   ADD HL,DE
233+  A20E 77                   LD(HL),A
234+  A20F 11 00 01             LD DE, $100
235+  A212 19                   ADD HL,DE
236+  A213 77                   LD(HL),A
237+  A214 11 00 01             LD DE, $100
238+  A217 19                   ADD HL,DE
239+  A218 77                   LD(HL),A
240+  A219
241+  A219                      ;arriba centro
242+  A219 DD 23                INC IX
243+  A21B DD E5 E1             LD HL, IX
244+  A21E
245+  A21E 3E 7E                LD A,%01111110
246+  A220 77                   LD(HL),A
247+  A221 3E FF                LD A,%11111111
248+  A223 11 00 01             LD DE, $100
249+  A226 19                   ADD HL,DE
250+  A227 77                   LD(HL),A
251+  A228 3E FF                LD A,%11111111
252+  A22A 11 00 01             LD DE, $100
253+  A22D 19                   ADD HL,DE
254+  A22E 77                   LD(HL),A
255+  A22F 11 00 01             LD DE, $100
256+  A232 19                   ADD HL,DE
257+  A233 77                   LD(HL),A
258+  A234 11 00 01             LD DE, $100
259+  A237 19                   ADD HL,DE
260+  A238 77                   LD(HL),A
261+  A239 11 00 01             LD DE, $100
262+  A23C 19                   ADD HL,DE
263+  A23D 77                   LD(HL),A
264+  A23E 11 00 01             LD DE, $100
265+  A241 19                   ADD HL,DE
266+  A242 77                   LD(HL),A
267+  A243 11 00 01             LD DE, $100
268+  A246 19                   ADD HL,DE
269+  A247 77                   LD(HL),A
270+  A248
271+  A248                      ;arriba derecha
272+  A248
273+  A248 DD 23                INC IX
274+  A24A DD E5 E1             LD HL, IX
275+  A24D 3E 00                LD A,%00000000
276+  A24F 77                   LD(HL),A
277+  A250 3E 80                LD A,%10000000
278+  A252 11 00 01             LD DE, $100
279+  A255 19                   ADD HL,DE
280+  A256 77                   LD(HL),A
281+  A257 3E C0                LD A,%11000000
282+  A259 11 00 01             LD DE, $100
283+  A25C 19                   ADD HL,DE
284+  A25D 77                   LD(HL),A
285+  A25E 3E E0                LD A,%11100000
286+  A260 11 00 01             LD DE, $100
287+  A263 19                   ADD HL,DE
288+  A264 77                   LD(HL),A
289+  A265 11 00 01             LD DE, $100
290+  A268 19                   ADD HL,DE
291+  A269 77                   LD(HL),A
292+  A26A 3E F0                LD A,%11110000
293+  A26C 11 00 01             LD DE, $100
294+  A26F 19                   ADD HL,DE
295+  A270 77                   LD(HL),A
296+  A271 11 00 01             LD DE, $100
297+  A274 19                   ADD HL,DE
298+  A275 77                   LD(HL),A
299+  A276 11 00 01             LD DE, $100
300+  A279 19                   ADD HL,DE
301+  A27A 77                   LD(HL),A
302+  A27B
303+  A27B                      ;abajo derecha en tercio
304+  A27B
305+  A27B 01 20 07             ld bc,$720
306+  A27E DD 09                ADD IX, BC
307+  A280 DD E5 E1             LD HL,IX
308+  A283 3E F0                LD A,%11110000
309+  A285 77                   LD(HL),A
310+  A286 11 00 01             LD DE, $100
311+  A289 19                   ADD HL,DE
312+  A28A 77                   LD(HL),A
313+  A28B 11 00 01             LD DE, $100
314+  A28E 19                   ADD HL,DE
315+  A28F 77                   LD(HL),A
316+  A290 3E E0                LD A,%11100000
317+  A292 11 00 01             LD DE, $100
318+  A295 19                   ADD HL,DE
319+  A296 77                   LD(HL),A
320+  A297 11 00 01             LD DE, $100
321+  A29A 19                   ADD HL,DE
322+  A29B 77                   LD(HL),A
323+  A29C 3E C0                LD A,%11000000
324+  A29E 11 00 01             LD DE, $100
325+  A2A1 19                   ADD HL,DE
326+  A2A2 77                   LD(HL),A
327+  A2A3 3E 80                LD A,%10000000
328+  A2A5 11 00 01             LD DE, $100
329+  A2A8 19                   ADD HL,DE
330+  A2A9 77                   LD(HL),A
331+  A2AA 3E 00                LD A,%00000000
332+  A2AC 11 00 01             LD DE, $100
333+  A2AF 19                   ADD HL,DE
334+  A2B0 77                   LD(HL),A
335+  A2B1
336+  A2B1                      ;abajo centro
337+  A2B1
338+  A2B1 DD 2B                DEC IX
339+  A2B3 DD E5 E1             LD HL,IX
340+  A2B6 3E FF                LD A,%11111111
341+  A2B8 77                   LD(HL),A
342+  A2B9 11 00 01             LD DE, $100
343+  A2BC 19                   ADD HL,DE
344+  A2BD 77                   LD(HL),A
345+  A2BE 11 00 01             LD DE, $100
346+  A2C1 19                   ADD HL,DE
347+  A2C2 77                   LD(HL),A
348+  A2C3 11 00 01             LD DE, $100
349+  A2C6 19                   ADD HL,DE
350+  A2C7 77                   LD(HL),A
351+  A2C8 11 00 01             LD DE, $100
352+  A2CB 19                   ADD HL,DE
353+  A2CC 77                   LD(HL),A
354+  A2CD 11 00 01             LD DE, $100
355+  A2D0 19                   ADD HL,DE
356+  A2D1 77                   LD(HL),A
357+  A2D2 11 00 01             LD DE, $100
358+  A2D5 19                   ADD HL,DE
359+  A2D6 77                   LD(HL),A
360+  A2D7 11 00 01             LD DE, $100
361+  A2DA 19                   ADD HL,DE
362+  A2DB 3E 7E                LD A,%01111110
363+  A2DD 77                   LD(HL),A
364+  A2DE
365+  A2DE                      ;abajo izquierda
366+  A2DE DD 2B                DEC IX
367+  A2E0 DD E5 E1             LD HL,IX
368+  A2E3 3E 0F                LD A,%00001111
369+  A2E5 77                   LD(HL),A
370+  A2E6 11 00 01             LD DE, $100
371+  A2E9 19                   ADD HL,DE
372+  A2EA 77                   LD(HL),A
373+  A2EB 11 00 01             LD DE, $100
374+  A2EE 19                   ADD HL,DE
375+  A2EF 77                   LD(HL),A
376+  A2F0 3E 07                LD A,%00000111
377+  A2F2 11 00 01             LD DE, $100
378+  A2F5 19                   ADD HL,DE
379+  A2F6 77                   LD(HL),A
380+  A2F7 11 00 01             LD DE, $100
381+  A2FA 19                   ADD HL,DE
382+  A2FB 77                   LD(HL),A
383+  A2FC 3E 03                LD A,%00000011
384+  A2FE 11 00 01             LD DE, $100
385+  A301 19                   ADD HL,DE
386+  A302 77                   LD(HL),A
387+  A303 3E 01                LD A,%00000001
388+  A305 11 00 01             LD DE, $100
389+  A308 19                   ADD HL,DE
390+  A309 77                   LD(HL),A
391+  A30A 3E 00                LD A,%00000000
392+  A30C 11 00 01             LD DE, $100
393+  A30F 19                   ADD HL,DE
394+  A310 77                   LD(HL),A
395+  A311              Fin_Ficha:
396+  A311 F1                   POP AF
397+  A312 DD E1                pop ix
398+  A314 C1                   pop bc
399+  A315 D1                   pop de
400+  A316 E1                   pop hl
401+  A317 C9                   RET
402+  A318
403+  A318              PintaCuadrao:;coge hl externo
404+  A318
405+  A318 3A 74 9B             LD A, (Color_Usuario)
406+  A31B 18 02                JR SEGUIR
407+  A31D              BORRAR_FICHA:
408+  A31D 3E 00                LD A,0
409+  A31F              SEGUIR:
410+  A31F C5                   PUSH BC
411+  A320 E5                   PUSH HL
412+  A321 F5                   PUSH AF
413+  A322
414+  A322
415+  A322 77                   LD (HL), A
416+  A323 23                   INC HL
417+  A324 77                   LD (HL), A
418+  A325 23                   INC HL
419+  A326 77                   LD (HL), A
420+  A327 11 20 00             LD DE,32
421+  A32A 19                   ADD HL,DE
422+  A32B 77                   LD (HL), A
423+  A32C 2B                   DEC HL
424+  A32D 77                   LD (HL),A
425+  A32E 2B                   DEC HL
426+  A32F 77                   LD (HL), A
427+  A330
428+  A330 F1                   POP AF
429+  A331 E1                   POP HL
430+  A332 C1                   POP BC
431+  A333 C9                   RET
432+  A334
433+  A334              Animacion_Caeficha:
434+  A334
435+  A334 AF                   xor a
436+  A335 32 72 9B             ld (ColumnaFull), a
437+  A338
438+  A338 7D                   ld a, l                ; A columna (0-6)
439+  A339 DD 21 9F 9B          ld ix, Posiciones1     ; IX = inicio del tablero
440+  A33D 3C                   inc a                  ; +1 por el $ff
441+  A33E 5F                   ld e, a
442+  A33F 16 00                ld d, 0
443+  A341 DD 19                add ix, de             ; IX = Posiciones1 +1 + columna
444+  A343
445+  A343 11 2D 00             ld de, 9*5             ; 45 bytes, ultima fila
446+  A346 DD 19                add ix, de             ; IX apunta a ultima fila
447+  A348
448+  A348 06 06                ld b, 6                ; 6 filas (5..0)
449+  A34A 11 F7 FF             ld de, -9              ; salto hacia arriba una fila
450+  A34D
451+  A34D              BuscarHueco:
452+  A34D DD 7E 00             ld a, (ix)
453+  A350 FE 00                cp 0
454+  A352 28 06                jr z, HuecoEncontrado
455+  A354
456+  A354 DD 19                add ix, de             ; subir 1 fila
457+  A356 10 F5                djnz BuscarHueco
458+  A358
459+  A358 18 1D                jr ColumnaLlena
460+  A35A
461+  A35A              HuecoEncontrado:
462+  A35A
463+  A35A                      ; Guardamos color
464+  A35A 3A 74 9B             ld a, (Color_Usuario)
465+  A35D DD 77 00             ld (ix), a
466+  A360
467+  A360                      ; B vale filas probadas
468+  A360 48                   ld c, b                ; C = veces que cae
469+  A361 26 00                ld h, 0                ; empezar caida desde encima del tablero
470+  A363
471+  A363              bucle_Cae:
472+  A363 24                   inc H
473+  A364 CD 7D A3             call PintaCuadrao1
474+  A367 CD B8 A3             call ESPERAR
475+  A36A 0D                   dec c
476+  A36B 28 05                jr z, TerminaAnimacion
477+  A36D CD 8D A3             call BORRAR_FICHA1
478+  A370 18 F1                jr bucle_Cae
479+  A372              TerminaAnimacion:
480+  A372 AF                   xor a
481+  A373 32 72 9B             ld (ColumnaFull), a
482+  A376 C9                   ret
483+  A377              ColumnaLlena:
484+  A377 3E 01                ld a, 1
485+  A379 32 72 9B             ld (ColumnaFull),a
486+  A37C C9                   ret
487+  A37D              PintaCuadrao1:;coge hl externo, DE 0-6 EN H (FILA) Y L (COLUMNA) CALCULA COORD Y PINTA
488+  A37D
489+  A37D 7C                   LD A, H
490+  A37E B7                   OR A
491+  A37F 28 07                JR Z, COLOR_SUPERIOR
492+  A381 3A 74 9B             LD A, (Color_Usuario)
493+  A384 F6 08                OR PAPEL_Azul
494+  A386 18 0E                JR SEGUIR1
495+  A388              COLOR_SUPERIOR:
496+  A388 3A 74 9B             LD A, (Color_Usuario)
497+  A38B 18 09                JR SEGUIR1
498+  A38D              BORRAR_FICHA1:
499+  A38D 7C                   LD A, H ;compruebo si es arriba del tablero(h=0)
500+  A38E B7                   OR A
501+  A38F 28 04                JR Z, BORRAR_SUPERIOR
502+  A391 3E 08                LD A, PAPEL_Azul + TINTA_Blck
503+  A393 18 01                JR SEGUIR1
504+  A395              BORRAR_SUPERIOR:
505+  A395 AF                   XOR A
506+  A396              SEGUIR1:
507+  A396 E5                   PUSH HL
508+  A397 F5                   PUSH AF
509+  A398 F5                   PUSH AF
510+  A399 7C                   LD A, H  ; H= H*3 +1 "abajo"
511+  A39A 84                   ADD A, H
511+  A39B 84            ADD A, H
512+  A39C 3C                   INC A
513+  A39D 67                   LD H,A
514+  A39E 7D                   LD A,L ; L = L*4 +1 "derecha"
515+  A39F 85                   ADD A,L
516+  A3A0 87                   ADD A,A
517+  A3A1 3C                   INC A
518+  A3A2 6F                   LD L,A
519+  A3A3 CD 11 A5             CALL SlotPointer ;HL>$5800
520+  A3A6 F1                   POP AF
521+  A3A7 77                   LD (HL), A
522+  A3A8 23                   INC HL
523+  A3A9 77                   LD (HL), A
524+  A3AA 23                   INC HL
525+  A3AB 77                   LD (HL), A
526+  A3AC 11 20 00             LD DE,32
527+  A3AF 19                   ADD HL,DE
528+  A3B0 77                   LD (HL), A
529+  A3B1 2B                   DEC HL
530+  A3B2 77                   LD (HL),A
531+  A3B3 2B                   DEC HL
532+  A3B4 77                   LD (HL), A
533+  A3B5
534+  A3B5 F1                   POP AF
535+  A3B6 E1                   POP HL
536+  A3B7 C9                   RET
537+  A3B8              ESPERAR:
538+  A3B8 C5                   push bc
539+  A3B9 06 32                LD B,50
540+  A3BB 0E FF        D1:     LD C, 255
541+  A3BD 0D           D2:     DEC C
542+  A3BE 20 FD                JR NZ,D2
543+  A3C0 10 F9                DJNZ D1
544+  A3C2 C1                   pop bc
545+  A3C3 C9                   RET
546+  A3C4
547+  A3C4
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\pintaficha1.asm
102   A3C4                      INCLUDE "telasNuevas.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\telasNuevas.asm
  1+  A3C4              ;funciones al leer una tecla válida(excepto F que hace que salga):
  2+  A3C4              MOVER_DERECHA:
  3+  A3C4 CD 8D A3         CALL BORRAR_FICHA1
  4+  A3C7 2C               INC L
  5+  A3C8 7D               LD A, L
  6+  A3C9 FE 06            CP POS_MAX1
  7+  A3CB 28 04            JR Z, DIBUJA_DCHA
  8+  A3CD 38 02            JR C, DIBUJA_DCHA
  9+  A3CF              SALTO_FINAL:
 10+  A3CF 2E 00            LD L, 0
 11+  A3D1              DIBUJA_DCHA:
 12+  A3D1 CD 7D A3         CALL PintaCuadrao1
 13+  A3D4 C9               RET
 14+  A3D5
 15+  A3D5
 16+  A3D5              MOVER_IZQUIERDA:
 17+  A3D5 CD 8D A3         CALL BORRAR_FICHA1
 18+  A3D8 7D               LD A, L
 19+  A3D9 FE 00            CP POS_MIN1
 20+  A3DB 28 07            JR Z, SALTO_INICIO
 21+  A3DD 38 05            JR C, SALTO_INICIO
 22+  A3DF 2D               DEC L
 23+  A3E0 CD 7D A3         CALL PintaCuadrao1
 24+  A3E3 C9               RET
 25+  A3E4              SALTO_INICIO:
 26+  A3E4 2E 06            LD L, POS_MAX1
 27+  A3E6 CD 7D A3         CALL PintaCuadrao1
 28+  A3E9 C9               RET
 29+  A3EA
 30+  A3EA              ;función principal---------------------------------
 31+  A3EA              ES_AMARILLOYNolocambio:
 32+  A3EA CD 7D A3         CALL PintaCuadrao1
 33+  A3ED              TECLAS: ; CAMBIA A
 34+  A3ED C5               PUSH BC
 35+  A3EE
 36+  A3EE              L15:
 37+  A3EE 01 FE FB         LD BC,$FBFE
 38+  A3F1 ED 78            IN A,(C)
 39+  A3F3 CB 47            BIT 0,A
 40+  A3F5 20 0D            JR NZ,L16
 41+  A3F7 CD 29 A5         CALL SOLTAR_TECLA
 42+  A3FA 3E 51            LD A,'Q'
 43+  A3FC 32 73 9B         LD (Caracter),A
 44+  A3FF C1               POP BC
 45+  A400 CD D5 A3         CALL MOVER_IZQUIERDA
 46+  A403 C9               RET
 47+  A404              L16:
 48+  A404 CB 4F            BIT 1,A
 49+  A406 20 0D            JR NZ,L17
 50+  A408 CD 29 A5         CALL SOLTAR_TECLA
 51+  A40B 3E 57            LD A,'W'
 52+  A40D 32 73 9B         LD (Caracter),A
 53+  A410 C1               POP BC
 54+  A411 CD C4 A3         CALL MOVER_DERECHA
 55+  A414 C9               RET
 56+  A415
 57+  A415
 58+  A415              L17:
 59+  A415 01 FE FD         LD BC,$FDFE
 60+  A418 ED 78            IN A,(C)
 61+  A41A CB 5F            BIT 3,A
 62+  A41C 20 0A            JR NZ,L5
 63+  A41E CD 29 A5         CALL SOLTAR_TECLA
 64+  A421 3E 46            LD A,'F'
 65+  A423 32 73 9B         LD (Caracter),A
 66+  A426 C1               POP BC
 67+  A427 C9               RET
 68+  A428              L5:                     ; Este cambia porque es RETURN y se carga como carácter $FF
 69+  A428 01 FE BF         LD BC,$BFFE
 70+  A42B ED 78            IN A,(C)
 71+  A42D CB 47            BIT 0,A
 72+  A42F 20 BD            JR NZ,L15
 73+  A431 CD 29 A5         CALL SOLTAR_TECLA
 74+  A434 3E FF            LD A,$FF
 75+  A436 32 73 9B         LD (Caracter),A
 76+  A439 C1               POP BC
 77+  A43A 18 1D            jr CAMBIAR_USUARIO
 78+  A43C
 79+  A43C
 80+  A43C              ;cambio de usuario y lectura de movimiento con o-p
 81+  A43C              ES_ROJO:
 82+  A43C CD F3 A4         CALL Tablero_lleno
 83+  A43F 3A 71 9B         ld a, (FullTablero)
 84+  A442 FE 01            cp 1
 85+  A444 28 0D            jr z, seAcaba
 86+  A446 3E 06            LD A, TINTA_Yel          ; cambiar a amarillo (sin papel)
 87+  A448 32 74 9B         LD (Color_Usuario), A
 88+  A44B 26 00            LD H,0    ; Restaurar posición inicial
 89+  A44D 2E 00            LD L,0
 90+  A44F CD 7D A3         CALL PintaCuadrao1
 91+  A452 C9               RET
 92+  A453              seAcaba:
 93+  A453 3E 46            ld a, "F"
 94+  A455 32 73 9B         ld(Caracter), A
 95+  A458 C9               ret
 96+  A459
 97+  A459              CAMBIAR_USUARIO:
 98+  A459 CD 8D A3         CALL BORRAR_FICHA1
 99+  A45C CD 34 A3         CALL Animacion_Caeficha
100+  A45F 3A 72 9B         ld a,(ColumnaFull);comprobamos si la columna ha estado llena
101+  A462 FE 01            cp 1
102+  A464 CA CF A4         jp z, nohaycambio
103+  A467 3A 74 9B         LD A, (Color_Usuario)   ; carga el color actual
104+  A46A FE 06            CP TINTA_Yel            ; comparo con amarillo
105+  A46C 20 CE            JR NZ, ES_ROJO          ; si es amarillo se cambia a rojo
106+  A46E 3E 02            LD A, TINTA_Red         ; cambiar a rojo (sin papel)
107+  A470 32 74 9B         LD (Color_Usuario), A
108+  A473 26 00            LD H,0
109+  A475 2E 00            ld L,0    ; Restaurar posición inicial
110+  A477              ES_ROJOYNolocambio:
111+  A477 CD 7D A3         CALL PintaCuadrao1
112+  A47A              L21:
113+  A47A C5               PUSH BC                 ; Guardar BC al inicio del bucle
114+  A47B 01 FE DF         LD BC,$DFFE
115+  A47E ED 78            IN A,(C)
116+  A480 CB 47            BIT 0,A
117+  A482 20 0E            JR NZ,L22
118+  A484 CD 29 A5         CALL SOLTAR_TECLA
119+  A487 3E 50            LD A,'P'
120+  A489 32 73 9B         LD (Caracter),A
121+  A48C C1               POP BC
122+  A48D CD C4 A3         CALL MOVER_DERECHA
123+  A490 18 E8            jr L21
124+  A492              L22:
125+  A492 CB 4F            BIT 1,A
126+  A494 20 0E            JR NZ,L23
127+  A496 CD 29 A5         CALL SOLTAR_TECLA
128+  A499 3E 4F            LD A,'O'
129+  A49B 32 73 9B         LD (Caracter),A
130+  A49E C1               POP BC
131+  A49F CD D5 A3         CALL MOVER_IZQUIERDA
132+  A4A2 18 D6            jr L21
133+  A4A4              L23:
134+  A4A4 01 FE FD         LD BC,$FDFE
135+  A4A7 ED 78            IN A,(C)
136+  A4A9 CB 5F            BIT 3,A
137+  A4AB 20 0A            JR NZ,L24
138+  A4AD CD 29 A5         CALL SOLTAR_TECLA
139+  A4B0 3E 46            LD A,'F'
140+  A4B2 32 73 9B         LD (Caracter),A
141+  A4B5 C1               POP BC
142+  A4B6 C9               RET
143+  A4B7              L24:                     ; Este cambia porque es RETURN y se carga como carácter $FF
144+  A4B7 01 FE BF         LD BC,$BFFE
145+  A4BA ED 78            IN A,(C)
146+  A4BC CB 47            BIT 0,A
147+  A4BE 20 0B            JR NZ,L25
148+  A4C0 CD 29 A5         CALL SOLTAR_TECLA
149+  A4C3 3E FF            LD A,$FF
150+  A4C5 32 73 9B         LD (Caracter),A
151+  A4C8 C1               POP BC
152+  A4C9 18 8E            jr CAMBIAR_USUARIO
153+  A4CB              L25:
154+  A4CB C1               POP BC              ; Limpiar stack si no se presionó ninguna tecla
155+  A4CC 18 AC            jr L21
156+  A4CE
157+  A4CE C9               RET
158+  A4CF              nohaycambio:
159+  A4CF AF               xor a
160+  A4D0 32 72 9B         ld (ColumnaFull), a
161+  A4D3 3A 74 9B         LD A, (Color_Usuario)   ; carga el color actual
162+  A4D6 FE 06            CP TINTA_Yel            ; comparo con amarillo
163+  A4D8 C2 77 A4         JP NZ, ES_ROJOYNolocambio
164+  A4DB C3 EA A3         JP ES_AMARILLOYNolocambio
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\telasNuevas.asm
103   A4DE                      INCLUDE "juego1.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\juego1.asm
  1+  A4DE              JUEGO:
  2+  A4DE CD BC 9F         CALL TABLERO_REDONDO
  3+  A4E1 26 00            LD H, 0
  4+  A4E3 2E 00            LD L, 0
  5+  A4E5 CD 7D A3         CALL PintaCuadrao1
  6+  A4E8              JUEGOEMPEZADO:
  7+  A4E8 CD ED A3         CALL TECLAS
  8+  A4EB 3A 73 9B         LD A,(Caracter)
  9+  A4EE FE 46            CP 'F'
 10+  A4F0 20 F6            jr nz, JUEGOEMPEZADO
 11+  A4F2 C9               RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\juego1.asm
104   A4F3                      INCLUDE "terminar.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\terminar.asm
  1+  A4F3              ;para saber si el juego ha terminado mirar primera fila si hay 0. Las primeras 7 filas está claro
  2+  A4F3              Tablero_lleno:
  3+  A4F3 F5               push af
  4+  A4F4 DD E5            push ix
  5+  A4F6 C5               push bc
  6+  A4F7
  7+  A4F7 DD 21 A0 9B      ld ix, Posiciones1 +1
  8+  A4FB 06 07            ld b,7
  9+  A4FD              bucle_compurebo:
 10+  A4FD DD 7E 00         ld a, (ix)
 11+  A500 B7               or a
 12+  A501 28 09            jr z, nolleno
 13+  A503 DD 23            inc ix
 14+  A505 10 F6            djnz bucle_compurebo
 15+  A507                  ;si pasa por aquí está lleno
 16+  A507 3E 01            ld a, 1
 17+  A509 32 71 9B         ld(FullTablero), a
 18+  A50C              nolleno:
 19+  A50C C1               pop bc
 20+  A50D DD E1            pop ix
 21+  A50F F1               pop af
 22+  A510 C9               ret
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\terminar.asm
105   A511                     INCLUDE "slotpointer.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\slotpointer.asm
  1+  A511              SlotPointer: ;h fila, l columna y te devuelve coordenada de atributos
  2+  A511 7C               ld a,h
  3+  A512 CB 27            sla a
  4+  A514 CB 27            sla a
  5+  A516 CB 27            sla a
  6+  A518 CB 27            sla a
  7+  A51A CB 27            sla a
  8+  A51C B5               or L
  9+  A51D 6F               ld l,a
 10+  A51E 7C               ld a,h
 11+  A51F CB 2F            sra a
 12+  A521 CB 2F            sra a
 13+  A523 CB 2F            sra a
 14+  A525 F6 58            or $58
 15+  A527 67               ld h,a
 16+  A528 C9               ret
 17+  A529
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\slotpointer.asm
106   A529
107   A529
108   A529
109   A529
110   A529
111   A529              SOLTAR_TECLA:
112   A529 ED 78               IN A, (C)
113   A52B E6 1F               AND $1F ;ASEGURA QUE LOS BITS DE A (0-7) LOS PRIMEROS 5 SON LOS Q NOS INTERESAN, ASEGURA QUE A VALGA %00011111
114   A52D FE 1F               CP $1F ;COMPRUEBA SI SE HA ESCRITO ALGO PORQUE SI VALE 1F SIGNIFICA QUE NO SE HA PULSADO TECLAS
115   A52F 20 F8               JR NZ, SOLTAR_TECLA ;SI Z=0 (ES DECIR, A ES DISTINTO DE $1F), LA TECLA SIGUE PULSADA ENTONCES BUCLE HASTA QUE EL USUARIO LA SUELTE
116   A531 C9                  RET
117   A532
118   A532
119   A532
120   A532
121   A532
122   A532
123   A532              LEER_SN:
124   A532 C5                  PUSH BC
125   A533              SN_0:
126   A533 01 FE FD            LD BC, $FDFE ;'S' en D1
127   A536 ED 78               IN A, (C)
128   A538 CB 4F               BIT 1, A
129   A53A 20 0B               JR NZ, SN_1
130   A53C CD 29 A5            CALL SOLTAR_TECLA
131   A53F 3E 53               LD A, 'S'
132   A541 CD A9 9C            CALL CLEARSCR
133   A544                     ;Z=1
134   A544 AF                  XOR A
135   A545 C1                  POP BC
136   A546 C9                  RET
137   A547
138   A547              SN_1:
139   A547 01 FE 7F            LD BC, $7FFE ;'N' en D3
140   A54A ED 78               IN A, (C)
141   A54C CB 5F               BIT 3, A
142   A54E 20 E3               JR NZ, SN_0
143   A550 CD 29 A5            CALL SOLTAR_TECLA
144   A553 3E 4E               LD A, 'N'
145   A555 CD A9 9C            CALL CLEARSCR
146   A558 3E 00               LD A, 0
147   A55A D3 FE               OUT ($FE), A
148   A55C CD A9 9C            CALL CLEARSCR
149   A55F 06 0C               LD B, 12
150   A561 0E 0C               LD C, 12
151   A563 3E 50               LD A, 0+2*8+64
152   A565 DD 21 2D 9B         LD IX, M_GB
153   A569 CD 38 9C            CALL PRINTAT
154   A56C                     ;Z=0
155   A56C 3E 01               LD A, 1
156   A56E B7                  OR A
157   A56F C1                  POP BC
158   A570 C9                  RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Rutina bienvenida 4 en raya\main.asm
