# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\main.asm
  1   0000                     DEVICE ZXSPECTRUM48
  2   0000                     SLDOPT COMMENT WPMEM, LOGPOINT, ASSETION
  3   0000                     org $8000               ; Programa ubicado a partir de $8000 = 32768
  4   8000 31 00 00            ld sp, 0
  5   8003 C3 FE 9B            jp inicio
  6   8006              portada: INCBIN "portada.scr"
  7   9B06
  8   9B06              M_WL:
  9   9B06 42 69 65 6E         DB "Bienvenido al Conecta 4", 0
  9   9B0A 76 65 6E 69
  9   9B0E 64 6F 20 61
  9   9B12 6C 20 43 6F
  9   9B16 6E 65 63 74
  9   9B1A 61 20 34 00
 10   9B1E              M_PR:
 11   9B1E 51 75 69 65         DB "Quieres jugar?", 0
 11   9B22 72 65 73 20
 11   9B26 6A 75 67 61
 11   9B2A 72 3F 00
 12   9B2D              M_GB:
 13   9B2D 41 64 69 6F         DB "Adios!!!!", 0
 13   9B31 73 21 21 21
 13   9B35 21 00
 14   9B37              M_RS:
 15   9B37 00 00               DB 0,0
 16   9B39              M_PF:
 17   9B39 4C 61 20 70         DB "La partida ha finalizado  ", 0
 17   9B3D 61 72 74 69
 17   9B41 64 61 20 68
 17   9B45 61 20 66 69
 17   9B49 6E 61 6C 69
 17   9B4D 7A 61 64 6F
 17   9B51 20 20 00
 18   9B54              M_QJ:
 19   9B54 51 75 69 65         DB "Quieres jugar otra partida? ", 0
 19   9B58 72 65 73 20
 19   9B5C 6A 75 67 61
 19   9B60 72 20 6F 74
 19   9B64 72 61 20 70
 19   9B68 61 72 74 69
 19   9B6C 64 61 3F 20
 19   9B70 00
 20   9B71              M_GAN_AMARILLO:
 21   9B71 47 61 6E 61         DB "Ganador: Amarillo", 0
 21   9B75 64 6F 72 3A
 21   9B79 20 41 6D 61
 21   9B7D 72 69 6C 6C
 21   9B81 6F 00
 22   9B83              M_GAN_ROJO:
 23   9B83 47 61 6E 61         DB "Ganador: Rojo", 0
 23   9B87 64 6F 72 3A
 23   9B8B 20 52 6F 6A
 23   9B8F 6F 00
 24   9B91              M_TABLAS:
 25   9B91 54 61 62 6C         DB "Tablas", 0
 25   9B95 61 73 00
 26   9B98 00           FullTablero DB 0
 27   9B99 00           ContadorFichas DB 0
 28   9B9A 00           Ganador DB 0          ; 0=tablas, TINTA_Yel=amarillo, TINTA_Red=rojo
 29   9B9B 00           ColumnaFull db 0
 30   9B9C 00           Caracter DB 0
 31   9B9D              PAPEL_Azul EQU 1*8
 32   9B9D              TINTA_Yel EQU 6
 33   9B9D              TINTA_Red EQU 2
 34   9B9D              TINTA_Blck EQU 0
 35   9B9D 06           Color_Usuario db TINTA_Yel
 36   9B9E              POS_MAX EQU $3A ;$5839 EN ATRIBUTOS (+24)
 37   9B9E              POS_MIN EQU $20 ;$5821
 38   9B9E              ;nuevas pos max
 39   9B9E              POS_MAX1 EQU 6 ;$5839 EN ATRIBUTOS , en fila 7 en L
 40   9B9E              POS_MIN1 EQU 0 ;columna inicial en atributos
 41   9B9E              Posiciones:
 42   9B9E 00 00 00 00         db 0,0,0,0,0,0,0
 42   9BA2 00 00 00
 43   9BA5 00 00 00 00         db 0,0,0,0,0,0,0
 43   9BA9 00 00 00
 44   9BAC 00 00 00 00         db 0,0,0,0,0,0,0
 44   9BB0 00 00 00
 45   9BB3 00 00 00 00         db 0,0,0,0,0,0,0
 45   9BB7 00 00 00
 46   9BBA 00 00 00 00         db 0,0,0,0,0,0,0
 46   9BBE 00 00 00
 47   9BC1 00 00 00 00         db 0,0,0,0,0,0,0
 47   9BC5 00 00 00
 48   9BC8              Posiciones1:; poner $ff, cambiar rutina limpieza
 49   9BC8 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 49   9BCC 00 00 00 00
 49   9BD0 FF
 50   9BD1 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 50   9BD5 00 00 00 00
 50   9BD9 FF
 51   9BDA FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 51   9BDE 00 00 00 00
 51   9BE2 FF
 52   9BE3 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 52   9BE7 00 00 00 00
 52   9BEB FF
 53   9BEC FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 53   9BF0 00 00 00 00
 53   9BF4 FF
 54   9BF5 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 54   9BF9 00 00 00 00
 54   9BFD FF
 55   9BFE
 56   9BFE              ;recomendado usar DE para color y n.judador con EXX para ir cambiando
 57   9BFE              inicio:
 58   9BFE
 59   9BFE 3E 00               LD A, 0
 60   9C00 D3 FE               OUT ($FE), A
 61   9C02 CD D5 9C            CALL CLEARSCR
 62   9C05 CD BF A0            CALL IMPORT_DRAW
 63   9C08 06 00               LD B, 0
 64   9C0A 0E 05               LD C, 5
 65   9C0C 3E 42               LD A, 2+0*8+64
 66   9C0E DD 21 06 9B         LD IX, M_WL
 67   9C12 CD 64 9C            CALL PRINTAT
 68   9C15
 69   9C15 3E 06               LD A, 6
 70   9C17 06 14               LD B, 20
 71   9C19 0E 01               LD C, 1
 72   9C1B DD 21 1E 9B         LD IX, M_PR
 73   9C1F CD 64 9C            CALL PRINTAT
 74   9C22 3E B0               LD A, 6*8+128
 75   9C24 32 90 5A            LD ($5800+20*32+16), A
 76   9C27
 77   9C27 CD C0 A6            CALL LEER_SN
 78   9C2A 20 37               JR NZ, fin
 79   9C2C CD 3F A5            CALL JUEGO ;al salir la primera vez con F baja a jugar nuevamente.
 80   9C2F
 81   9C2F              JUGAR_NUEVAMENTE:  ; empieza limpiando e imprimiendo los dos textos de la pantalla
 82   9C2F 3E 00               LD A, 0
 83   9C31 D3 FE               OUT ($FE), A
 84   9C33 CD D5 9C            CALL CLEARSCR
 85   9C36 06 01               LD B, 1
 86   9C38 0E 05               LD C, 5
 87   9C3A 3E 01               LD A, 1
 88   9C3C DD 21 39 9B         LD IX, M_PF
 89   9C40 CD 64 9C            CALL PRINTAT
 90   9C43
 91   9C43                     ; Mostrar resultado de la partida
 92   9C43 CD 4B A6            CALL MostrarResultado
 93   9C46
 94   9C46 3E 06               LD A, 6
 95   9C48 06 0C               LD B, 12
 96   9C4A 0E 01               LD C, 1
 97   9C4C DD 21 54 9B         LD IX, M_QJ
 98   9C50 CD 64 9C            CALL PRINTAT
 99   9C53 3E B0               LD A, 6*8+128
100   9C55 32 9E 59            LD ($5800+12*32+30), A
101   9C58 CD C0 A6            CALL LEER_SN     ; hace la funcion nuevamente de la pantalla inicial
102   9C5B 20 06               JR NZ, fin
103   9C5D
104   9C5D CD 3F A5            CALL JUEGO
105   9C60 C3 2F 9C            JP JUGAR_NUEVAMENTE
106   9C63              fin:
107   9C63 76                  HALT
108   9C64
109   9C64                      INCLUDE "PRINTAT.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\PRINTAT.asm
  1+  9C64              ; -------------------------------
  2+  9C64              ; ZX Spectrum Text print library
  3+  9C64              ; Daniel León - AOC - UFV 2020
  4+  9C64              ; -------------------------------
  5+  9C64
  6+  9C64
  7+  9C64              ; ----------------------------------------------------------------------------------------
  8+  9C64              ; PRINTAT - Print a string in a position and attributes as per registers:
  9+  9C64              ;		IN	A	: Bit 7=1 For Flash / Bit 6=1 For Brigh / Bit 5,4,3 for Paper / Bit 2,1,0 for Ink
 10+  9C64              ;		IN	B	: Row 0..23
 11+  9C64              ;		IN	C	: Column 0..31
 12+  9C64              ;		IN	IX	: Address of text (Text must end in a 0)
 13+  9C64              ; ----------------------------------------------------------------------------------------
 14+  9C64 CD 73 9C     PRINTAT:	CALL PREP_PRT				; Update Attribute var &Screen & Attributes pointers
 15+  9C67              ; ----------------------------------------------------------------------------------------
 16+  9C67              ;		VVV Do not move PRINTSTR below as PRINTAT continues into PRINTSTR routine
 17+  9C67              ; ----------------------------------------------------------------------------------------
 18+  9C67              ; PRINTSTR - Prints String - IX Points to the String start
 19+  9C67              ; ----------------------------------------------------------------------------------------
 20+  9C67 DD 7E 00     PRINTSTR:   LD A,(IX)					; A Contains first char to print
 21+  9C6A B7           			OR A						; check for end of string (0)
 22+  9C6B C8           			RET Z						; Finish printing if 0
 23+  9C6C CD A1 9C     			CALL PRINTCHNUM
 24+  9C6F DD 23        			INC IX						; Move to next char in string
 25+  9C71 18 F4        			JR PRINTSTR					; Start over printing sequence
 26+  9C73              ; ----------------------------------------------------------------------------------------
 27+  9C73
 28+  9C73
 29+  9C73              ;-----------------------------------------------------------------------------------------
 30+  9C73              ; PREP_PRT - Updates Print_Attr, SCR & ATTR Vars
 31+  9C73              ;-----------------------------------------------------------------------------------------
 32+  9C73 32 E7 9C     PREP_PRT:	LD (PRINT_ATTR),A			; Set Attribute
 33+  9C76 CD 7C 9C     PREP_PRT_2:	CALL CRtoSCREEN
 34+  9C79 C3 8E 9C     			JP CRtoATTR
 35+  9C7C              ;-----------------------------------------------------------------------------------------
 36+  9C7C
 37+  9C7C              ;-----------------------------------------------------------------------------------------
 38+  9C7C              ; CRtoSCREEN - Converts a scr char coord into a SCREEN Address   b,c = y,x positions
 39+  9C7C              ;	IN  - B=Row, C=Column
 40+  9C7C              ;	OUT - HL=Address in screen also stored in (SCR_CUR_PTR)
 41+  9C7C              ;	Conversion:
 42+  9C7C              ;			Row FFfff   Column CCCCC
 43+  9C7C              ;			HL=%010FF000 fffCCCCC
 44+  9C7C              ;-----------------------------------------------------------------------------------------
 45+  9C7C              CRtoSCREEN:
 46+  9C7C 78           			LD A,B						; %___FFfff
 47+  9C7D F6 40        			OR #40						; %010FFfff
 48+  9C7F E6 F8        			AND #F8						; %010FF000
 49+  9C81 67           			LD H,A
 50+  9C82
 51+  9C82 78           			LD A,B						; %___FFfff
 52+  9C83 E6 07        			AND #7						; %00000fff
 53+  9C85 0F           			RRCA						; %f00000ff
 54+  9C86 0F           			RRCA						; %ff00000f
 55+  9C87 0F           			RRCA						; %fff00000
 56+  9C88 B1           			OR C						; %fffCCCCC
 57+  9C89 6F           			LD L,A
 58+  9C8A 22 E3 9C                 LD (SCR_CUR_PTR),HL			; Update Variable
 59+  9C8D C9                       RET
 60+  9C8E              ; ----------------------------------------------------------------------------------------
 61+  9C8E
 62+  9C8E
 63+  9C8E
 64+  9C8E              ;-----------------------------------------------------------------------------------------
 65+  9C8E              ; CRtoATTR - Converts a screen char coord  into a ATTR Address  b,c = y,x positions
 66+  9C8E              ;	IN  - B=Row, C=Column
 67+  9C8E              ;	OUT - HL=Address in screen also stored in (SCR_ATTR_PTR)
 68+  9C8E              ;	Conversion:
 69+  9C8E              ;			Row FFfff   Column CCCCC
 70+  9C8E              ;			HL=%010110FF fffCCCCC
 71+  9C8E              ;-----------------------------------------------------------------------------------------
 72+  9C8E              CRtoATTR:
 73+  9C8E 78           			LD A,B						; %___FFfff
 74+  9C8F 0F           			RRCA						; %f000FFff
 75+  9C90 0F           			RRCA						; %ff000FFf
 76+  9C91 0F           			RRCA						; %fff000FF
 77+  9C92 6F           			LD L,A
 78+  9C93 E6 03        			AND 3						; %000000FF	value of FF can be only 00,01,10
 79+  9C95 F6 58        			OR #58						; %010110FF value will be #58, #59 or #5A
 80+  9C97 67           			LD H,A
 81+  9C98
 82+  9C98 7D           			LD A,L						; %fff000FF
 83+  9C99 E6 E0        			AND #E0						; %fff00000
 84+  9C9B B1           			OR C						; %fffCCCCC
 85+  9C9C 6F           			LD L,A
 86+  9C9D
 87+  9C9D 22 E5 9C                 LD (SCR_ATTR_PTR),HL		; Update Variable
 88+  9CA0 C9                       RET
 89+  9CA1              ; ----------------------------------------------------------------------------------------
 90+  9CA1
 91+  9CA1
 92+  9CA1
 93+  9CA1              ; ----------------------------------------------------------------------------------------
 94+  9CA1              ; PRINTCHNUM - Prints Char Number N (stored in A)
 95+  9CA1              ;-----------------------------------------------------------------------------------------
 96+  9CA1              PRINTCHNUM:	;SUB 32						; Adjust Ascii to charset
 97+  9CA1 26 00        			LD H,0						; Multiply value by 8 to get to right Char in Charset
 98+  9CA3 6F           			LD L,A
 99+  9CA4 29           			ADD HL,HL
100+  9CA5 29           			ADD HL,HL
101+  9CA6 29           			ADD HL,HL
102+  9CA7 11 E8 9B     			LD DE, CHARSET-(8*32)		; Optimize in compile time (instead of sub 32)
103+  9CAA 19           			ADD HL,DE
104+  9CAB EB           			EX  DE,HL					;Value in DE
105+  9CAC              			; Continues to printchar below
106+  9CAC              ; ----------------------------------------------------------------------------------------
107+  9CAC
108+  9CAC
109+  9CAC              ; ----------------------------------------------------------------------------------------
110+  9CAC              ; PRINTCHAR - Prints Char  (DE points to the char. Uses HL as last Cur Pointer)
111+  9CAC              ; ----------------------------------------------------------------------------------------
112+  9CAC              PRINTCHAR:
113+  9CAC 06 08        			LD B,8						; 8 Lines per char
114+  9CAE 2A E3 9C                 LD HL, (SCR_CUR_PTR)		; Load Cursor Pointer y,x
115+  9CB1
116+  9CB1 1A           BYTEPCHAR:	LD A,(DE)					; Get Char to be printed, first line
117+  9CB2 77           			LD (HL),A					; Move to Printing location
118+  9CB3 24                       INC H						; inc H so next line in char (ZX Spectrum Screen RAM)
119+  9CB4 13                       INC DE 						; next line to be printed
120+  9CB5 10 FA                    DJNZ BYTEPCHAR				; Repeat 8 lines
121+  9CB7 3A E7 9C                 LD A,(PRINT_ATTR) 			; Load Attributes to print char with
122+  9CBA 2A E5 9C                 LD HL, (SCR_ATTR_PTR)
123+  9CBD 77                       LD (HL),A
124+  9CBE 21 E5 9C                 LD HL, SCR_ATTR_PTR			; Get pointer to ATTR
125+  9CC1 34                       INC (HL)					; Move Attribute cursor to next char
126+  9CC2 21 E3 9C     			LD HL, SCR_CUR_PTR
127+  9CC5 34           			INC (HL)					; update Cursor pointer to next position
128+  9CC6 C9                       RET
129+  9CC7              ; ----------------------------------------------------------------------------------------
130+  9CC7
131+  9CC7
132+  9CC7
133+  9CC7              ; ----------------------------------------------------------------------------------------
134+  9CC7              ; INK2PAPER - moves ink of attribute stored in (PRINT_ATTR) to paper and sets ink to 0
135+  9CC7              ; 				Sets bright 1 and flash 0
136+  9CC7              ; ----------------------------------------------------------------------------------------
137+  9CC7 3A E7 9C     INK2PAPER:	LD A, (PRINT_ATTR)		    ; Get storedAttribute
138+  9CCA E6 07                    AND 7						; get Attr INK in A
139+  9CCC 07           			RLCA
140+  9CCD 07           			RLCA
141+  9CCE 07           			RLCA						; move Ink to Paper
142+  9CCF F6 40        			OR 64						; ink 0 bright 1
143+  9CD1 32 E7 9C     			LD (PRINT_ATTR),A		    ; Get storedAttribute
144+  9CD4 C9           			RET
145+  9CD5              ; ----------------------------------------------------------------------------------------
146+  9CD5
147+  9CD5
148+  9CD5
149+  9CD5
150+  9CD5 21 00 40     CLEARSCR:	LD HL,$4000					; Erases screen by writing 0 to all pixels and attributes
151+  9CD8 11 01 40     			LD DE,$4001
152+  9CDB 01 FF 1A     			LD BC,6911
153+  9CDE 36 00        			LD (HL),0
154+  9CE0 ED B0        			LDIR
155+  9CE2 C9           			RET
156+  9CE3
157+  9CE3
158+  9CE3              SCR_CUR_PTR
158+  9CE3 00 00          	db $00, $00				; Cursor Pointer in Screen (2 bytes) (HL)
159+  9CE5 00 00        SCR_ATTR_PTR: 	db $00, $00				; Attr Pointer in Screen (2 bytes) (HL)
160+  9CE7 00           PRINT_ATTR:		db $00					; Attribute used by printchar routine (1 byte)
161+  9CE8
162+  9CE8              CHARSET: incbin "charset.bin"			; Charset used
163+  9FE8
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\PRINTAT.asm
110   9FE8                      INCLUDE "TABLERO.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\TABLERO.asm
  1+  9FE8
  2+  9FE8              TABLERO_REDONDO:
  3+  9FE8 E5                   push hl
  4+  9FE9 DD E5                push ix
  5+  9FEB D5                   push de
  6+  9FEC C5                   push bc
  7+  9FED F5                   push AF
  8+  9FEE
  9+  9FEE CD D5 9C             CALL CLEARSCR
 10+  9FF1
 11+  9FF1                      ; Dibujar el fondo del tablero primero
 12+  9FF1 21 60 58             LD HL, $5800 + 96     ; HL se mueve 3 filas hacia abajo, dejando espacio arriba para ficha amarilla
 13+  9FF4 E5 DD E1             LD IX,HL
 14+  9FF7
 15+  9FF7 3E 08                LD A, 8             ; A = 8, color azul para las barras del tablero
 16+  9FF9 06 13                LD B, 19            ; B = 19, número de filas
 17+  9FFB              FullCuadrao:
 18+  9FFB 0E 1D                LD C, 29
 19+  9FFD              COLUMNA:
 20+  9FFD 77                   LD (HL), A          ; Escribe el color azul en HL
 21+  9FFE 23                   INC HL              ; Avanza HL al siguiente byte
 22+  9FFF 0D                   DEC C               ; Disminuye contador de columnas
 23+  A000 20 FB                JR NZ, COLUMNA
 24+  A002 11 20 00             LD DE, 32
 25+  A005 DD 19                ADD IX,DE
 26+  A007 DD E5 E1             LD HL,IX
 27+  A00A 05                   DEC B
 28+  A00B 20 EE                JR NZ, FullCuadrao
 29+  A00D              ; Fila 0: $4021 / $5821
 30+  A00D 3E 00                LD A, 0
 31+  A00F 32 9D 9B             LD (Color_Usuario), A
 32+  A012 DD 21 21 40          LD IX, $4021
 33+  A016 21 21 58             LD HL, $5821
 34+  A019 0E 07                LD C, 7
 35+  A01B
 36+  A01B              FilaColumnas0:
 37+  A01B CD D1 A0             CALL FICHA
 38+  A01E 11 04 00             LD DE, 4
 39+  A021 DD 19                ADD IX, DE
 40+  A023 19                   ADD HL, DE
 41+  A024 0D                   DEC C
 42+  A025 20 F4                JR NZ, FilaColumnas0
 43+  A027
 44+  A027                      ; Fila 2: $40E1 / $5881+96
 45+  A027 DD 21 E1 40          LD IX, $40E1
 46+  A02B 21 E1 58             LD HL, $5881 + 96
 47+  A02E 0E 07                LD C, 7
 48+  A030              ; Fila 1: $4081 / $5881
 49+  A030 3E 08                LD A, %00001000     ; pongo la ficha en negro
 50+  A032 32 9D 9B             LD (Color_Usuario), A
 51+  A035 DD 21 81 40          LD IX, $4081
 52+  A039 21 81 58             LD HL, $5881
 53+  A03C 0E 07                LD C, 7
 54+  A03E              FilaColumnas1:
 55+  A03E CD D1 A0             CALL FICHA
 56+  A041 11 04 00             LD DE, 4
 57+  A044 DD 19                ADD IX, DE
 58+  A046 19                   ADD HL, DE
 59+  A047 0D                   DEC C
 60+  A048 20 F4                JR NZ, FilaColumnas1
 61+  A04A
 62+  A04A                      ; Fila 2: $40E1 / $5881+96
 63+  A04A DD 21 E1 40          LD IX, $40E1
 64+  A04E 21 E1 58             LD HL, $5881 + 96
 65+  A051 0E 07                LD C, 7
 66+  A053              FilaColumnas2:
 67+  A053 CD D1 A0             CALL FICHA
 68+  A056 11 04 00             LD DE, 4
 69+  A059 DD 19                ADD IX, DE
 70+  A05B 19                   ADD HL, DE
 71+  A05C 0D                   DEC C
 72+  A05D 20 F4                JR NZ, FilaColumnas2
 73+  A05F
 74+  A05F                      ; Fila 3: $4841 / $5881+192
 75+  A05F DD 21 41 48          LD IX, $4841
 76+  A063 21 41 59             LD HL, $5881 + 192
 77+  A066 0E 07                LD C, 7
 78+  A068              FilaColumnas3:
 79+  A068 CD D1 A0             CALL FICHA
 80+  A06B 11 04 00             LD DE, 4
 81+  A06E DD 19                ADD IX, DE
 82+  A070 19                   ADD HL, DE
 83+  A071 0D                   DEC C
 84+  A072 20 F4                JR NZ, FilaColumnas3
 85+  A074
 86+  A074                      ; Fila 4: $48A1 / $5881+288
 87+  A074 DD 21 A1 48          LD IX, $48A1
 88+  A078 21 A1 59             LD HL, $5881 + 288
 89+  A07B 0E 07                LD C, 7
 90+  A07D              FilaColumnas4:
 91+  A07D CD D1 A0             CALL FICHA
 92+  A080 11 04 00             LD DE, 4
 93+  A083 DD 19                ADD IX, DE
 94+  A085 19                   ADD HL, DE
 95+  A086 0D                   DEC C
 96+  A087 20 F4                JR NZ, FilaColumnas4
 97+  A089
 98+  A089                      ; Fila 5: $5001 / $5881+384
 99+  A089 DD 21 01 50          LD IX, $5001
100+  A08D 21 01 5A             LD HL, $5881 + 384
101+  A090 0E 07                LD C, 7
102+  A092              FilaColumnas5:
103+  A092 CD D1 A0             CALL FICHA
104+  A095 11 04 00             LD DE, 4
105+  A098 DD 19                ADD IX, DE
106+  A09A 19                   ADD HL, DE
107+  A09B 0D                   DEC C
108+  A09C 20 F4                JR NZ, FilaColumnas5
109+  A09E
110+  A09E                      ; Fila 6: $5061 / $5881+480
111+  A09E DD 21 61 50          LD IX, $5061
112+  A0A2 21 61 5A             LD HL, $5881 + 480
113+  A0A5 0E 07                LD C, 7
114+  A0A7              FilaColumnas6:
115+  A0A7 CD D1 A0             CALL FICHA
116+  A0AA 11 04 00             LD DE, 4
117+  A0AD DD 19                ADD IX, DE
118+  A0AF 19                   ADD HL, DE
119+  A0B0 0D                   DEC C
120+  A0B1 20 F4                JR NZ, FilaColumnas6
121+  A0B3
122+  A0B3 3E 06                LD A, 6
123+  A0B5 32 9D 9B             LD (Color_Usuario), A
124+  A0B8
125+  A0B8 F1                   pop AF
126+  A0B9 C1                   pop bc
127+  A0BA D1                   pop de
128+  A0BB DD E1                pop ix
129+  A0BD E1                   pop hl
130+  A0BE
131+  A0BE C9                   RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\TABLERO.asm
111   A0BF                      INCLUDE "Importar_portada.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Importar_portada.asm
  1+  A0BF              IMPORT_DRAW:
  2+  A0BF E5               PUSH HL
  3+  A0C0 D5               PUSH DE
  4+  A0C1 C5               PUSH BC
  5+  A0C2 21 06 80         LD HL, portada
  6+  A0C5 11 00 40         LD DE, $4000
  7+  A0C8 01 00 1B         LD BC, 6912
  8+  A0CB ED B0            LDIR
  9+  A0CD C1               POP BC
 10+  A0CE D1               POP DE
 11+  A0CF E1               POP HL
 12+  A0D0 C9               RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Importar_portada.asm
112   A0D1                      INCLUDE "pintaficha1.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\pintaficha1.asm
  1+  A0D1              FICHA:; coje hl para pintar cuadrado y ix para la bola
  2+  A0D1 E5                   push hl
  3+  A0D2 D5                   push de
  4+  A0D3 C5                   push bc
  5+  A0D4 DD E5                push ix
  6+  A0D6 F5                   PUSH AF
  7+  A0D7 CD 44 A3             CALL PintaCuadrao
  8+  A0DA DD E5 E1             ld hl, ix
  9+  A0DD
 10+  A0DD                      ;Detectar si estamos en la fila problemática (segunda fila)
 11+  A0DD 7C                   LD A, H
 12+  A0DE FE 40                CP $40
 13+  A0E0 20 0C                JR NZ, FICHA_NORMAL
 14+  A0E2 7D                   LD A, L
 15+  A0E3 FE E1                CP $E1
 16+  A0E5 38 07                JR C, FICHA_NORMAL    ; Si es menor que $E1, usar normal
 17+  A0E7 FE FA                CP $FA
 18+  A0E9 30 03                JR NC, FICHA_NORMAL   ; Si es mayor o igual que $FA, usar normal
 19+  A0EB C3 17 A2             JP FICHA_ENTERCIO     ; Si está entre $E1 y $F9, usar específica
 20+  A0EE
 21+  A0EE              FICHA_NORMAL:
 22+  A0EE                      ;arriba izquierda
 23+  A0EE 3E 00                LD A,%00000000
 24+  A0F0 77                   LD(HL),A
 25+  A0F1 3E 01                LD A,%00000001
 26+  A0F3 11 00 01             LD DE, $100
 27+  A0F6 19                   ADD HL,DE
 28+  A0F7 77                   LD(HL),A
 29+  A0F8 3E 03                LD A,%00000011
 30+  A0FA 11 00 01             LD DE, $100
 31+  A0FD 19                   ADD HL,DE
 32+  A0FE 77                   LD(HL),A
 33+  A0FF 3E 07                LD A,%00000111
 34+  A101 11 00 01             LD DE, $100
 35+  A104 19                   ADD HL,DE
 36+  A105 77                   LD(HL),A
 37+  A106 11 00 01             LD DE, $100
 38+  A109 19                   ADD HL,DE
 39+  A10A 77                   LD(HL),A
 40+  A10B 3E 0F                LD A,%00001111
 41+  A10D 11 00 01             LD DE, $100
 42+  A110 19                   ADD HL,DE
 43+  A111 77                   LD(HL),A
 44+  A112 11 00 01             LD DE, $100
 45+  A115 19                   ADD HL,DE
 46+  A116 77                   LD(HL),A
 47+  A117 11 00 01             LD DE, $100
 48+  A11A 19                   ADD HL,DE
 49+  A11B 77                   LD(HL),A
 50+  A11C
 51+  A11C                      ;arriba centro
 52+  A11C DD 23                INC IX
 53+  A11E DD E5 E1             LD HL, IX
 54+  A121
 55+  A121 3E 7E                LD A,%01111110
 56+  A123 77                   LD(HL),A
 57+  A124 3E FF                LD A,%11111111
 58+  A126 11 00 01             LD DE, $100
 59+  A129 19                   ADD HL,DE
 60+  A12A 77                   LD(HL),A
 61+  A12B 3E FF                LD A,%11111111
 62+  A12D 11 00 01             LD DE, $100
 63+  A130 19                   ADD HL,DE
 64+  A131 77                   LD(HL),A
 65+  A132 11 00 01             LD DE, $100
 66+  A135 19                   ADD HL,DE
 67+  A136 77                   LD(HL),A
 68+  A137 11 00 01             LD DE, $100
 69+  A13A 19                   ADD HL,DE
 70+  A13B 77                   LD(HL),A
 71+  A13C 11 00 01             LD DE, $100
 72+  A13F 19                   ADD HL,DE
 73+  A140 77                   LD(HL),A
 74+  A141 11 00 01             LD DE, $100
 75+  A144 19                   ADD HL,DE
 76+  A145 77                   LD(HL),A
 77+  A146 11 00 01             LD DE, $100
 78+  A149 19                   ADD HL,DE
 79+  A14A 77                   LD(HL),A
 80+  A14B
 81+  A14B                      ;arriba derecha
 82+  A14B
 83+  A14B DD 23                INC IX
 84+  A14D DD E5 E1             LD HL, IX
 85+  A150 3E 00                LD A,%00000000
 86+  A152 77                   LD(HL),A
 87+  A153 3E 80                LD A,%10000000
 88+  A155 11 00 01             LD DE, $100
 89+  A158 19                   ADD HL,DE
 90+  A159 77                   LD(HL),A
 91+  A15A 3E C0                LD A,%11000000
 92+  A15C 11 00 01             LD DE, $100
 93+  A15F 19                   ADD HL,DE
 94+  A160 77                   LD(HL),A
 95+  A161 3E E0                LD A,%11100000
 96+  A163 11 00 01             LD DE, $100
 97+  A166 19                   ADD HL,DE
 98+  A167 77                   LD(HL),A
 99+  A168 11 00 01             LD DE, $100
100+  A16B 19                   ADD HL,DE
101+  A16C 77                   LD(HL),A
102+  A16D 3E F0                LD A,%11110000
103+  A16F 11 00 01             LD DE, $100
104+  A172 19                   ADD HL,DE
105+  A173 77                   LD(HL),A
106+  A174 11 00 01             LD DE, $100
107+  A177 19                   ADD HL,DE
108+  A178 77                   LD(HL),A
109+  A179 11 00 01             LD DE, $100
110+  A17C 19                   ADD HL,DE
111+  A17D 77                   LD(HL),A
112+  A17E
113+  A17E
114+  A17E                      ;ld de,32
115+  A17E                      ;add hl, de
116+  A17E
117+  A17E                      ;abajo derecha
118+  A17E
119+  A17E 01 20 00             ld bc,$20
120+  A181 DD 09                ADD IX, BC
121+  A183 DD E5 E1             LD HL,IX
122+  A186 3E F0                LD A,%11110000
123+  A188 77                   LD(HL),A
124+  A189 11 00 01             LD DE, $100
125+  A18C 19                   ADD HL,DE
126+  A18D 77                   LD(HL),A
127+  A18E 11 00 01             LD DE, $100
128+  A191 19                   ADD HL,DE
129+  A192 77                   LD(HL),A
130+  A193 3E E0                LD A,%11100000
131+  A195 11 00 01             LD DE, $100
132+  A198 19                   ADD HL,DE
133+  A199 77                   LD(HL),A
134+  A19A 11 00 01             LD DE, $100
135+  A19D 19                   ADD HL,DE
136+  A19E 77                   LD(HL),A
137+  A19F 3E C0                LD A,%11000000
138+  A1A1 11 00 01             LD DE, $100
139+  A1A4 19                   ADD HL,DE
140+  A1A5 77                   LD(HL),A
141+  A1A6 3E 80                LD A,%10000000
142+  A1A8 11 00 01             LD DE, $100
143+  A1AB 19                   ADD HL,DE
144+  A1AC 77                   LD(HL),A
145+  A1AD 3E 00                LD A,%00000000
146+  A1AF 11 00 01             LD DE, $100
147+  A1B2 19                   ADD HL,DE
148+  A1B3 77                   LD(HL),A
149+  A1B4
150+  A1B4                      ;abajo centro
151+  A1B4
152+  A1B4 DD 2B                DEC IX
153+  A1B6 DD E5 E1             LD HL,IX
154+  A1B9 3E FF                LD A,%11111111
155+  A1BB 77                   LD(HL),A
156+  A1BC 11 00 01             LD DE, $100
157+  A1BF 19                   ADD HL,DE
158+  A1C0 77                   LD(HL),A
159+  A1C1 11 00 01             LD DE, $100
160+  A1C4 19                   ADD HL,DE
161+  A1C5 77                   LD(HL),A
162+  A1C6 11 00 01             LD DE, $100
163+  A1C9 19                   ADD HL,DE
164+  A1CA 77                   LD(HL),A
165+  A1CB 11 00 01             LD DE, $100
166+  A1CE 19                   ADD HL,DE
167+  A1CF 77                   LD(HL),A
168+  A1D0 11 00 01             LD DE, $100
169+  A1D3 19                   ADD HL,DE
170+  A1D4 77                   LD(HL),A
171+  A1D5 11 00 01             LD DE, $100
172+  A1D8 19                   ADD HL,DE
173+  A1D9 77                   LD(HL),A
174+  A1DA 11 00 01             LD DE, $100
175+  A1DD 19                   ADD HL,DE
176+  A1DE 3E 7E                LD A,%01111110
177+  A1E0 77                   LD(HL),A
178+  A1E1
179+  A1E1                      ;abajo izquierda
180+  A1E1 DD 2B                DEC IX
181+  A1E3 DD E5 E1             LD HL,IX
182+  A1E6 3E 0F                LD A,%00001111
183+  A1E8 77                   LD(HL),A
184+  A1E9 11 00 01             LD DE, $100
185+  A1EC 19                   ADD HL,DE
186+  A1ED 77                   LD(HL),A
187+  A1EE 11 00 01             LD DE, $100
188+  A1F1 19                   ADD HL,DE
189+  A1F2 77                   LD(HL),A
190+  A1F3 3E 07                LD A,%00000111
191+  A1F5 11 00 01             LD DE, $100
192+  A1F8 19                   ADD HL,DE
193+  A1F9 77                   LD(HL),A
194+  A1FA 11 00 01             LD DE, $100
195+  A1FD 19                   ADD HL,DE
196+  A1FE 77                   LD(HL),A
197+  A1FF 3E 03                LD A,%00000011
198+  A201 11 00 01             LD DE, $100
199+  A204 19                   ADD HL,DE
200+  A205 77                   LD(HL),A
201+  A206 3E 01                LD A,%00000001
202+  A208 11 00 01             LD DE, $100
203+  A20B 19                   ADD HL,DE
204+  A20C 77                   LD(HL),A
205+  A20D 3E 00                LD A,%00000000
206+  A20F 11 00 01             LD DE, $100
207+  A212 19                   ADD HL,DE
208+  A213 77                   LD(HL),A
209+  A214 C3 3D A3             jp Fin_Ficha
210+  A217
211+  A217              FICHA_ENTERCIO:
212+  A217                      ;arriba izquierda
213+  A217 3E 00                LD A,%00000000
214+  A219 77                   LD(HL),A
215+  A21A 3E 01                LD A,%00000001
216+  A21C 11 00 01             LD DE, $100
217+  A21F 19                   ADD HL,DE
218+  A220 77                   LD(HL),A
219+  A221 3E 03                LD A,%00000011
220+  A223 11 00 01             LD DE, $100
221+  A226 19                   ADD HL,DE
222+  A227 77                   LD(HL),A
223+  A228 3E 07                LD A,%00000111
224+  A22A 11 00 01             LD DE, $100
225+  A22D 19                   ADD HL,DE
226+  A22E 77                   LD(HL),A
227+  A22F 11 00 01             LD DE, $100
228+  A232 19                   ADD HL,DE
229+  A233 77                   LD(HL),A
230+  A234 3E 0F                LD A,%00001111
231+  A236 11 00 01             LD DE, $100
232+  A239 19                   ADD HL,DE
233+  A23A 77                   LD(HL),A
234+  A23B 11 00 01             LD DE, $100
235+  A23E 19                   ADD HL,DE
236+  A23F 77                   LD(HL),A
237+  A240 11 00 01             LD DE, $100
238+  A243 19                   ADD HL,DE
239+  A244 77                   LD(HL),A
240+  A245
241+  A245                      ;arriba centro
242+  A245 DD 23                INC IX
243+  A247 DD E5 E1             LD HL, IX
244+  A24A
245+  A24A 3E 7E                LD A,%01111110
246+  A24C 77                   LD(HL),A
247+  A24D 3E FF                LD A,%11111111
248+  A24F 11 00 01             LD DE, $100
249+  A252 19                   ADD HL,DE
250+  A253 77                   LD(HL),A
251+  A254 3E FF                LD A,%11111111
252+  A256 11 00 01             LD DE, $100
253+  A259 19                   ADD HL,DE
254+  A25A 77                   LD(HL),A
255+  A25B 11 00 01             LD DE, $100
256+  A25E 19                   ADD HL,DE
257+  A25F 77                   LD(HL),A
258+  A260 11 00 01             LD DE, $100
259+  A263 19                   ADD HL,DE
260+  A264 77                   LD(HL),A
261+  A265 11 00 01             LD DE, $100
262+  A268 19                   ADD HL,DE
263+  A269 77                   LD(HL),A
264+  A26A 11 00 01             LD DE, $100
265+  A26D 19                   ADD HL,DE
266+  A26E 77                   LD(HL),A
267+  A26F 11 00 01             LD DE, $100
268+  A272 19                   ADD HL,DE
269+  A273 77                   LD(HL),A
270+  A274
271+  A274                      ;arriba derecha
272+  A274
273+  A274 DD 23                INC IX
274+  A276 DD E5 E1             LD HL, IX
275+  A279 3E 00                LD A,%00000000
276+  A27B 77                   LD(HL),A
277+  A27C 3E 80                LD A,%10000000
278+  A27E 11 00 01             LD DE, $100
279+  A281 19                   ADD HL,DE
280+  A282 77                   LD(HL),A
281+  A283 3E C0                LD A,%11000000
282+  A285 11 00 01             LD DE, $100
283+  A288 19                   ADD HL,DE
284+  A289 77                   LD(HL),A
285+  A28A 3E E0                LD A,%11100000
286+  A28C 11 00 01             LD DE, $100
287+  A28F 19                   ADD HL,DE
288+  A290 77                   LD(HL),A
289+  A291 11 00 01             LD DE, $100
290+  A294 19                   ADD HL,DE
291+  A295 77                   LD(HL),A
292+  A296 3E F0                LD A,%11110000
293+  A298 11 00 01             LD DE, $100
294+  A29B 19                   ADD HL,DE
295+  A29C 77                   LD(HL),A
296+  A29D 11 00 01             LD DE, $100
297+  A2A0 19                   ADD HL,DE
298+  A2A1 77                   LD(HL),A
299+  A2A2 11 00 01             LD DE, $100
300+  A2A5 19                   ADD HL,DE
301+  A2A6 77                   LD(HL),A
302+  A2A7
303+  A2A7                      ;abajo derecha en tercio
304+  A2A7
305+  A2A7 01 20 07             ld bc,$720
306+  A2AA DD 09                ADD IX, BC
307+  A2AC DD E5 E1             LD HL,IX
308+  A2AF 3E F0                LD A,%11110000
309+  A2B1 77                   LD(HL),A
310+  A2B2 11 00 01             LD DE, $100
311+  A2B5 19                   ADD HL,DE
312+  A2B6 77                   LD(HL),A
313+  A2B7 11 00 01             LD DE, $100
314+  A2BA 19                   ADD HL,DE
315+  A2BB 77                   LD(HL),A
316+  A2BC 3E E0                LD A,%11100000
317+  A2BE 11 00 01             LD DE, $100
318+  A2C1 19                   ADD HL,DE
319+  A2C2 77                   LD(HL),A
320+  A2C3 11 00 01             LD DE, $100
321+  A2C6 19                   ADD HL,DE
322+  A2C7 77                   LD(HL),A
323+  A2C8 3E C0                LD A,%11000000
324+  A2CA 11 00 01             LD DE, $100
325+  A2CD 19                   ADD HL,DE
326+  A2CE 77                   LD(HL),A
327+  A2CF 3E 80                LD A,%10000000
328+  A2D1 11 00 01             LD DE, $100
329+  A2D4 19                   ADD HL,DE
330+  A2D5 77                   LD(HL),A
331+  A2D6 3E 00                LD A,%00000000
332+  A2D8 11 00 01             LD DE, $100
333+  A2DB 19                   ADD HL,DE
334+  A2DC 77                   LD(HL),A
335+  A2DD
336+  A2DD                      ;abajo centro
337+  A2DD
338+  A2DD DD 2B                DEC IX
339+  A2DF DD E5 E1             LD HL,IX
340+  A2E2 3E FF                LD A,%11111111
341+  A2E4 77                   LD(HL),A
342+  A2E5 11 00 01             LD DE, $100
343+  A2E8 19                   ADD HL,DE
344+  A2E9 77                   LD(HL),A
345+  A2EA 11 00 01             LD DE, $100
346+  A2ED 19                   ADD HL,DE
347+  A2EE 77                   LD(HL),A
348+  A2EF 11 00 01             LD DE, $100
349+  A2F2 19                   ADD HL,DE
350+  A2F3 77                   LD(HL),A
351+  A2F4 11 00 01             LD DE, $100
352+  A2F7 19                   ADD HL,DE
353+  A2F8 77                   LD(HL),A
354+  A2F9 11 00 01             LD DE, $100
355+  A2FC 19                   ADD HL,DE
356+  A2FD 77                   LD(HL),A
357+  A2FE 11 00 01             LD DE, $100
358+  A301 19                   ADD HL,DE
359+  A302 77                   LD(HL),A
360+  A303 11 00 01             LD DE, $100
361+  A306 19                   ADD HL,DE
362+  A307 3E 7E                LD A,%01111110
363+  A309 77                   LD(HL),A
364+  A30A
365+  A30A                      ;abajo izquierda
366+  A30A DD 2B                DEC IX
367+  A30C DD E5 E1             LD HL,IX
368+  A30F 3E 0F                LD A,%00001111
369+  A311 77                   LD(HL),A
370+  A312 11 00 01             LD DE, $100
371+  A315 19                   ADD HL,DE
372+  A316 77                   LD(HL),A
373+  A317 11 00 01             LD DE, $100
374+  A31A 19                   ADD HL,DE
375+  A31B 77                   LD(HL),A
376+  A31C 3E 07                LD A,%00000111
377+  A31E 11 00 01             LD DE, $100
378+  A321 19                   ADD HL,DE
379+  A322 77                   LD(HL),A
380+  A323 11 00 01             LD DE, $100
381+  A326 19                   ADD HL,DE
382+  A327 77                   LD(HL),A
383+  A328 3E 03                LD A,%00000011
384+  A32A 11 00 01             LD DE, $100
385+  A32D 19                   ADD HL,DE
386+  A32E 77                   LD(HL),A
387+  A32F 3E 01                LD A,%00000001
388+  A331 11 00 01             LD DE, $100
389+  A334 19                   ADD HL,DE
390+  A335 77                   LD(HL),A
391+  A336 3E 00                LD A,%00000000
392+  A338 11 00 01             LD DE, $100
393+  A33B 19                   ADD HL,DE
394+  A33C 77                   LD(HL),A
395+  A33D              Fin_Ficha:
396+  A33D F1                   POP AF
397+  A33E DD E1                pop ix
398+  A340 C1                   pop bc
399+  A341 D1                   pop de
400+  A342 E1                   pop hl
401+  A343 C9                   RET
402+  A344
403+  A344              PintaCuadrao:;coge hl externo
404+  A344
405+  A344 3A 9D 9B             LD A, (Color_Usuario)
406+  A347 18 02                JR SEGUIR
407+  A349              BORRAR_FICHA:
408+  A349 3E 00                LD A,0
409+  A34B              SEGUIR:
410+  A34B C5                   PUSH BC
411+  A34C E5                   PUSH HL
412+  A34D F5                   PUSH AF
413+  A34E
414+  A34E
415+  A34E 77                   LD (HL), A
416+  A34F 23                   INC HL
417+  A350 77                   LD (HL), A
418+  A351 23                   INC HL
419+  A352 77                   LD (HL), A
420+  A353 11 20 00             LD DE,32
421+  A356 19                   ADD HL,DE
422+  A357 77                   LD (HL), A
423+  A358 2B                   DEC HL
424+  A359 77                   LD (HL),A
425+  A35A 2B                   DEC HL
426+  A35B 77                   LD (HL), A
427+  A35C
428+  A35C F1                   POP AF
429+  A35D E1                   POP HL
430+  A35E C1                   POP BC
431+  A35F C9                   RET
432+  A360
433+  A360              ; Variables para guardar posicion final de la ficha (usadas por Comprobar4enraya)
434+  A360 00           ColumnaFinal: db 0              ; Columna donde cayo la ficha (0-6)
435+  A361 00           FilaFinal:    db 0              ; Fila donde cayo la ficha (0-5)
436+  A362
437+  A362              Animacion_Caeficha:
438+  A362
439+  A362 AF                   xor a
440+  A363 32 9B 9B             ld (ColumnaFull), a
441+  A366
442+  A366                      ; GUARDAMOS LA COLUMNA para usarla despues en Comprobar4enraya
443+  A366 7D                   ld a, l                ; A columna (0-6)
444+  A367 32 60 A3             ld (ColumnaFinal), a   ; Guardar columna para despues
445+  A36A
446+  A36A DD 21 C8 9B          ld ix, Posiciones1     ; IX = inicio del tablero
447+  A36E 3C                   inc a                  ; +1 por el $ff
448+  A36F 5F                   ld e, a
449+  A370 16 00                ld d, 0
450+  A372 DD 19                add ix, de             ; IX = Posiciones1 +1 + columna
451+  A374
452+  A374 11 2D 00             ld de, 9*5             ; 45 bytes, ultima fila
453+  A377 DD 19                add ix, de             ; IX apunta a ultima fila
454+  A379
455+  A379 06 06                ld b, 6                ; 6 filas (5..0)
456+  A37B 11 F7 FF             ld de, -9              ; salto hacia arriba una fila
457+  A37E
458+  A37E              BuscarHueco:
459+  A37E DD 7E 00             ld a, (ix)
460+  A381 FE 00                cp 0
461+  A383 28 06                jr z, HuecoEncontrado
462+  A385
463+  A385 DD 19                add ix, de             ; subir 1 fila
464+  A387 10 F5                djnz BuscarHueco
465+  A389
466+  A389 18 47                jr ColumnaLlena
467+  A38B
468+  A38B              HuecoEncontrado:
469+  A38B
470+  A38B                      ; Guardamos color
471+  A38B 3A 9D 9B             ld a, (Color_Usuario)
472+  A38E DD 77 00             ld (ix), a
473+  A391
474+  A391                      ; CALCULAMOS Y GUARDAMOS LA FILA FINAL
475+  A391                      ; B=6 -> fila 5, B=5 -> fila 4, ..., B=1 -> fila 0
476+  A391                      ; Fila = B - 1
477+  A391 78                   ld a, b
478+  A392 3D                   dec a
479+  A393 32 61 A3             ld (FilaFinal), a      ; Guardar fila para Comprobar4enraya
480+  A396
481+  A396                      ; B vale filas probadas
482+  A396 48                   ld c, b                ; C = veces que cae
483+  A397 26 00                ld h, 0                ; empezar caida desde encima del tablero
484+  A399
485+  A399              bucle_Cae:
486+  A399 24                   inc H
487+  A39A CD D8 A3             call PintaCuadrao1
488+  A39D CD 13 A4             call ESPERAR
489+  A3A0 0D                   dec c
490+  A3A1 28 05                jr z, TerminaAnimacion
491+  A3A3 CD E8 A3             call BORRAR_FICHA1
492+  A3A6 18 F1                jr bucle_Cae
493+  A3A8              TerminaAnimacion:
494+  A3A8 AF                   xor a
495+  A3A9 32 9B 9B             ld (ColumnaFull), a
496+  A3AC
497+  A3AC                      ; Incrementar contador de fichas
498+  A3AC 3A 99 9B             ld a, (ContadorFichas)
499+  A3AF 3C                   inc a
500+  A3B0 32 99 9B             ld (ContadorFichas), a
501+  A3B3
502+  A3B3                      ; Cargar fila y columna guardadas para Comprobar4enraya
503+  A3B3                      ; H = fila (0-5), L = columna (0-6)
504+  A3B3 E5                   push hl                ; Guardar HL actual
505+  A3B4 3A 61 A3             ld a, (FilaFinal)
506+  A3B7 67                   ld h, a
507+  A3B8 3A 60 A3             ld a, (ColumnaFinal)
508+  A3BB 6F                   ld l, a
509+  A3BC CD C1 A5             call Comprobar4enraya
510+  A3BF E1                   pop hl                 ; Restaurar HL
511+  A3C0
512+  A3C0                      ; Si hay 4 en raya, ya termino (Caracter='F')
513+  A3C0 3A 9C 9B             ld a, (Caracter)
514+  A3C3 FE 46                cp 'F'
515+  A3C5 C8                   ret z
516+  A3C6
517+  A3C6                      ; Comprobar si tablero lleno (42 fichas = 6 filas x 7 columnas)
518+  A3C6 3A 99 9B             ld a, (ContadorFichas)
519+  A3C9 FE 2A                cp 42
520+  A3CB C0                   ret nz                 ; Si no esta lleno, seguir jugando
521+  A3CC
522+  A3CC                      ; Tablero lleno = tablas
523+  A3CC 3E 46                ld a, 'F'
524+  A3CE 32 9C 9B             ld (Caracter), a       ; Terminar juego
525+  A3D1 C9                   ret
526+  A3D2              ColumnaLlena:
527+  A3D2 3E 01                ld a, 1
528+  A3D4 32 9B 9B             ld (ColumnaFull),a
529+  A3D7 C9                   ret
530+  A3D8              PintaCuadrao1:;coge hl externo, DE 0-6 EN H (FILA) Y L (COLUMNA) CALCULA COORD Y PINTA
531+  A3D8
532+  A3D8 7C                   LD A, H
533+  A3D9 B7                   OR A
534+  A3DA 28 07                JR Z, COLOR_SUPERIOR
535+  A3DC 3A 9D 9B             LD A, (Color_Usuario)
536+  A3DF F6 08                OR PAPEL_Azul
537+  A3E1 18 0E                JR SEGUIR1
538+  A3E3              COLOR_SUPERIOR:
539+  A3E3 3A 9D 9B             LD A, (Color_Usuario)
540+  A3E6 18 09                JR SEGUIR1
541+  A3E8              BORRAR_FICHA1:
542+  A3E8 7C                   LD A, H ;compruebo si es arriba del tablero(h=0)
543+  A3E9 B7                   OR A
544+  A3EA 28 04                JR Z, BORRAR_SUPERIOR
545+  A3EC 3E 08                LD A, PAPEL_Azul + TINTA_Blck
546+  A3EE 18 01                JR SEGUIR1
547+  A3F0              BORRAR_SUPERIOR:
548+  A3F0 AF                   XOR A
549+  A3F1              SEGUIR1:
550+  A3F1 E5                   PUSH HL
551+  A3F2 F5                   PUSH AF
552+  A3F3 F5                   PUSH AF
553+  A3F4 7C                   LD A, H  ; H= H*3 +1 "abajo"
554+  A3F5 84                   ADD A, H
554+  A3F6 84            ADD A, H
555+  A3F7 3C                   INC A
556+  A3F8 67                   LD H,A
557+  A3F9 7D                   LD A,L ; L = L*4 +1 "derecha"
558+  A3FA 85                   ADD A,L
559+  A3FB 87                   ADD A,A
560+  A3FC 3C                   INC A
561+  A3FD 6F                   LD L,A
562+  A3FE CD 8A A6             CALL SlotPointer ;HL>$5800
563+  A401 F1                   POP AF
564+  A402 77                   LD (HL), A
565+  A403 23                   INC HL
566+  A404 77                   LD (HL), A
567+  A405 23                   INC HL
568+  A406 77                   LD (HL), A
569+  A407 11 20 00             LD DE,32
570+  A40A 19                   ADD HL,DE
571+  A40B 77                   LD (HL), A
572+  A40C 2B                   DEC HL
573+  A40D 77                   LD (HL),A
574+  A40E 2B                   DEC HL
575+  A40F 77                   LD (HL), A
576+  A410
577+  A410 F1                   POP AF
578+  A411 E1                   POP HL
579+  A412 C9                   RET
580+  A413              ESPERAR:
581+  A413 C5                   push bc
582+  A414 06 32                LD B,50
583+  A416 0E FF        D1:     LD C, 255
584+  A418 0D           D2:     DEC C
585+  A419 20 FD                JR NZ,D2
586+  A41B 10 F9                DJNZ D1
587+  A41D C1                   pop bc
588+  A41E C9                   RET
589+  A41F
590+  A41F
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\pintaficha1.asm
113   A41F                      INCLUDE "telasNuevas.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\telasNuevas.asm
  1+  A41F              ;funciones al leer una tecla válida(excepto F que hace que salga):
  2+  A41F              MOVER_DERECHA:
  3+  A41F CD E8 A3         CALL BORRAR_FICHA1
  4+  A422 2C               INC L
  5+  A423 7D               LD A, L
  6+  A424 FE 06            CP POS_MAX1
  7+  A426 28 04            JR Z, DIBUJA_DCHA
  8+  A428 38 02            JR C, DIBUJA_DCHA
  9+  A42A              SALTO_FINAL:
 10+  A42A 2E 00            LD L, 0
 11+  A42C              DIBUJA_DCHA:
 12+  A42C CD D8 A3         CALL PintaCuadrao1
 13+  A42F C9               RET
 14+  A430
 15+  A430
 16+  A430              MOVER_IZQUIERDA:
 17+  A430 CD E8 A3         CALL BORRAR_FICHA1
 18+  A433 7D               LD A, L
 19+  A434 FE 00            CP POS_MIN1
 20+  A436 28 07            JR Z, SALTO_INICIO
 21+  A438 38 05            JR C, SALTO_INICIO
 22+  A43A 2D               DEC L
 23+  A43B CD D8 A3         CALL PintaCuadrao1
 24+  A43E C9               RET
 25+  A43F              SALTO_INICIO:
 26+  A43F 2E 06            LD L, POS_MAX1
 27+  A441 CD D8 A3         CALL PintaCuadrao1
 28+  A444 C9               RET
 29+  A445
 30+  A445              ;función principal---------------------------------
 31+  A445              ES_AMARILLOYNolocambio:
 32+  A445 CD D8 A3         CALL PintaCuadrao1
 33+  A448              TECLAS: ; CAMBIA A
 34+  A448 C5               PUSH BC
 35+  A449
 36+  A449              L15:
 37+  A449 01 FE FB         LD BC,$FBFE
 38+  A44C ED 78            IN A,(C)
 39+  A44E CB 47            BIT 0,A
 40+  A450 20 0D            JR NZ,L16
 41+  A452 CD B7 A6         CALL SOLTAR_TECLA
 42+  A455 3E 51            LD A,'Q'
 43+  A457 32 9C 9B         LD (Caracter),A
 44+  A45A C1               POP BC
 45+  A45B CD 30 A4         CALL MOVER_IZQUIERDA
 46+  A45E C9               RET
 47+  A45F              L16:
 48+  A45F CB 4F            BIT 1,A
 49+  A461 20 0D            JR NZ,L17
 50+  A463 CD B7 A6         CALL SOLTAR_TECLA
 51+  A466 3E 57            LD A,'W'
 52+  A468 32 9C 9B         LD (Caracter),A
 53+  A46B C1               POP BC
 54+  A46C CD 1F A4         CALL MOVER_DERECHA
 55+  A46F C9               RET
 56+  A470
 57+  A470
 58+  A470              L17:
 59+  A470 01 FE FD         LD BC,$FDFE
 60+  A473 ED 78            IN A,(C)
 61+  A475 CB 5F            BIT 3,A
 62+  A477 20 0A            JR NZ,L5
 63+  A479 CD B7 A6         CALL SOLTAR_TECLA
 64+  A47C 3E 46            LD A,'F'
 65+  A47E 32 9C 9B         LD (Caracter),A
 66+  A481 C1               POP BC
 67+  A482 C9               RET
 68+  A483              L5:                     ; Este cambia porque es RETURN y se carga como carácter $FF
 69+  A483 01 FE BF         LD BC,$BFFE
 70+  A486 ED 78            IN A,(C)
 71+  A488 CB 47            BIT 0,A
 72+  A48A 20 BD            JR NZ,L15
 73+  A48C CD B7 A6         CALL SOLTAR_TECLA
 74+  A48F 3E FF            LD A,$FF
 75+  A491 32 9C 9B         LD (Caracter),A
 76+  A494 C1               POP BC
 77+  A495 18 1D            jr CAMBIAR_USUARIO
 78+  A497
 79+  A497
 80+  A497              ;cambio de usuario y lectura de movimiento con o-p
 81+  A497              ES_ROJO:
 82+  A497 CD A3 A5         CALL Tablero_lleno
 83+  A49A 3A 98 9B         ld a, (FullTablero)
 84+  A49D FE 01            cp 1
 85+  A49F 28 0D            jr z, seAcaba
 86+  A4A1 3E 06            LD A, TINTA_Yel          ; cambiar a amarillo (sin papel)
 87+  A4A3 32 9D 9B         LD (Color_Usuario), A
 88+  A4A6 26 00            LD H,0    ; Restaurar posición inicial
 89+  A4A8 2E 00            LD L,0
 90+  A4AA CD D8 A3         CALL PintaCuadrao1
 91+  A4AD C9               RET
 92+  A4AE              seAcaba:
 93+  A4AE 3E 46            ld a, "F"
 94+  A4B0 32 9C 9B         ld(Caracter), A
 95+  A4B3 C9               ret
 96+  A4B4
 97+  A4B4              CAMBIAR_USUARIO:
 98+  A4B4 CD E8 A3         CALL BORRAR_FICHA1
 99+  A4B7 CD 62 A3         CALL Animacion_Caeficha
100+  A4BA
101+  A4BA                  ; Comprobar si hay 4 en raya (Caracter = 'F') y salir inmediatamente
102+  A4BA 3A 9C 9B         ld a, (Caracter)
103+  A4BD FE 46            cp 'F'
104+  A4BF C8               ret z                  ; Si hay 4 en raya, salir sin cambiar usuario
105+  A4C0
106+  A4C0 3A 9B 9B         ld a,(ColumnaFull);comprobamos si la columna ha estado llena
107+  A4C3 FE 01            cp 1
108+  A4C5 CA 30 A5         jp z, nohaycambio
109+  A4C8 3A 9D 9B         LD A, (Color_Usuario)   ; carga el color actual
110+  A4CB FE 06            CP TINTA_Yel            ; comparo con amarillo
111+  A4CD 20 C8            JR NZ, ES_ROJO          ; si es amarillo se cambia a rojo
112+  A4CF 3E 02            LD A, TINTA_Red         ; cambiar a rojo (sin papel)
113+  A4D1 32 9D 9B         LD (Color_Usuario), A
114+  A4D4 26 00            LD H,0
115+  A4D6 2E 00            ld L,0    ; Restaurar posición inicial
116+  A4D8              ES_ROJOYNolocambio:
117+  A4D8 CD D8 A3         CALL PintaCuadrao1
118+  A4DB              L21:
119+  A4DB C5               PUSH BC                 ; Guardar BC al inicio del bucle
120+  A4DC 01 FE DF         LD BC,$DFFE
121+  A4DF ED 78            IN A,(C)
122+  A4E1 CB 47            BIT 0,A
123+  A4E3 20 0E            JR NZ,L22
124+  A4E5 CD B7 A6         CALL SOLTAR_TECLA
125+  A4E8 3E 50            LD A,'P'
126+  A4EA 32 9C 9B         LD (Caracter),A
127+  A4ED C1               POP BC
128+  A4EE CD 1F A4         CALL MOVER_DERECHA
129+  A4F1 18 E8            jr L21
130+  A4F3              L22:
131+  A4F3 CB 4F            BIT 1,A
132+  A4F5 20 0E            JR NZ,L23
133+  A4F7 CD B7 A6         CALL SOLTAR_TECLA
134+  A4FA 3E 4F            LD A,'O'
135+  A4FC 32 9C 9B         LD (Caracter),A
136+  A4FF C1               POP BC
137+  A500 CD 30 A4         CALL MOVER_IZQUIERDA
138+  A503 18 D6            jr L21
139+  A505              L23:
140+  A505 01 FE FD         LD BC,$FDFE
141+  A508 ED 78            IN A,(C)
142+  A50A CB 5F            BIT 3,A
143+  A50C 20 0A            JR NZ,L24
144+  A50E CD B7 A6         CALL SOLTAR_TECLA
145+  A511 3E 46            LD A,'F'
146+  A513 32 9C 9B         LD (Caracter),A
147+  A516 C1               POP BC
148+  A517 C9               RET
149+  A518              L24:                     ; Este cambia porque es RETURN y se carga como carácter $FF
150+  A518 01 FE BF         LD BC,$BFFE
151+  A51B ED 78            IN A,(C)
152+  A51D CB 47            BIT 0,A
153+  A51F 20 0B            JR NZ,L25
154+  A521 CD B7 A6         CALL SOLTAR_TECLA
155+  A524 3E FF            LD A,$FF
156+  A526 32 9C 9B         LD (Caracter),A
157+  A529 C1               POP BC
158+  A52A 18 88            jr CAMBIAR_USUARIO
159+  A52C              L25:
160+  A52C C1               POP BC              ; Limpiar stack si no se presionó ninguna tecla
161+  A52D 18 AC            jr L21
162+  A52F
163+  A52F C9               RET
164+  A530              nohaycambio:
165+  A530 AF               xor a
166+  A531 32 9B 9B         ld (ColumnaFull), a
167+  A534 3A 9D 9B         LD A, (Color_Usuario)   ; carga el color actual
168+  A537 FE 06            CP TINTA_Yel            ; comparo con amarillo
169+  A539 C2 D8 A4         JP NZ, ES_ROJOYNolocambio
170+  A53C C3 45 A4         JP ES_AMARILLOYNolocambio
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\telasNuevas.asm
114   A53F                      INCLUDE "juego1.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\juego1.asm
  1+  A53F              JUEGO:
  2+  A53F                  ; REINICIAR VARIABLES AL INICIO DE CADA PARTIDA
  3+  A53F AF               XOR A
  4+  A540 32 98 9B         LD (FullTablero), A    ; Reiniciar flag de tablero lleno
  5+  A543 32 9B 9B         LD (ColumnaFull), A    ; Reiniciar flag de columna llena
  6+  A546 32 99 9B         LD (ContadorFichas), A ; Reiniciar contador de fichas
  7+  A549 32 9A 9B         LD (Ganador), A        ; Reiniciar ganador (0 = tablas)
  8+  A54C
  9+  A54C                  ; LIMPIAR TABLERO Posiciones1 (6 filas x 9 bytes)
 10+  A54C CD 69 A5         CALL LimpiarTablero
 11+  A54F
 12+  A54F CD E8 9F         CALL TABLERO_REDONDO
 13+  A552
 14+  A552                  ; Reiniciar color del usuario a amarillo DESPUES de TABLERO_REDONDO
 15+  A552                  ; (TABLERO_REDONDO modifica Color_Usuario internamente)
 16+  A552 3E 06            LD A, TINTA_Yel
 17+  A554 32 9D 9B         LD (Color_Usuario), A
 18+  A557
 19+  A557 26 00            LD H, 0
 20+  A559 2E 00            LD L, 0
 21+  A55B CD D8 A3         CALL PintaCuadrao1
 22+  A55E              JUEGOEMPEZADO:
 23+  A55E CD 48 A4         CALL TECLAS
 24+  A561 3A 9C 9B         LD A,(Caracter)
 25+  A564 FE 46            CP 'F'
 26+  A566 20 F6            jr nz, JUEGOEMPEZADO
 27+  A568 C9               RET
 28+  A569
 29+  A569              ; RUTINA: Limpia el tablero Posiciones1 poniendo 0 en las casillas y $FF en los bordes
 30+  A569              LimpiarTablero:
 31+  A569 F5               PUSH AF
 32+  A56A C5               PUSH BC
 33+  A56B DD E5            PUSH IX
 34+  A56D
 35+  A56D DD 21 C8 9B      LD IX, Posiciones1
 36+  A571 06 06            LD B, 6                ; 6 filas
 37+  A573              LimpiarFila:
 38+  A573 DD 36 00 FF      LD (IX), $FF           ; Borde izquierdo
 39+  A577 DD 36 01 00      LD (IX+1), 0           ; Columnas 0-6 a 0 (vacio)
 40+  A57B DD 36 02 00      LD (IX+2), 0
 41+  A57F DD 36 03 00      LD (IX+3), 0
 42+  A583 DD 36 04 00      LD (IX+4), 0
 43+  A587 DD 36 05 00      LD (IX+5), 0
 44+  A58B DD 36 06 00      LD (IX+6), 0
 45+  A58F DD 36 07 00      LD (IX+7), 0
 46+  A593 DD 36 08 FF      LD (IX+8), $FF         ; Borde derecho
 47+  A597 11 09 00         LD DE, 9
 48+  A59A DD 19            ADD IX, DE             ; Siguiente fila
 49+  A59C 10 D5            DJNZ LimpiarFila
 50+  A59E
 51+  A59E DD E1            POP IX
 52+  A5A0 C1               POP BC
 53+  A5A1 F1               POP AF
 54+  A5A2 C9               RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\juego1.asm
115   A5A3                      INCLUDE "terminar.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\terminar.asm
  1+  A5A3              ;para saber si el juego ha terminado mirar primera fila si hay 0. Las primeras 7 filas está claro
  2+  A5A3              Tablero_lleno:
  3+  A5A3 F5               push af
  4+  A5A4 DD E5            push ix
  5+  A5A6 C5               push bc
  6+  A5A7
  7+  A5A7 DD 21 C9 9B      ld ix, Posiciones1 +1
  8+  A5AB 06 07            ld b,7
  9+  A5AD              bucle_compurebo:
 10+  A5AD DD 7E 00         ld a, (ix)
 11+  A5B0 B7               or a
 12+  A5B1 28 09            jr z, nolleno
 13+  A5B3 DD 23            inc ix
 14+  A5B5 10 F6            djnz bucle_compurebo
 15+  A5B7                  ;si pasa por aquí está lleno
 16+  A5B7 3E 01            ld a, 1
 17+  A5B9 32 98 9B         ld(FullTablero), a
 18+  A5BC              nolleno:
 19+  A5BC C1               pop bc
 20+  A5BD DD E1            pop ix
 21+  A5BF F1               pop af
 22+  A5C0 C9               ret
 23+  A5C1
 24+  A5C1              tamcolumna EQU 9
 25+  A5C1
 26+  A5C1              ; Entrada: H = fila (0-5), L = columna (0-6) donde cayo la ficha
 27+  A5C1              ; Salida: Carry=1 si hay 4 en raya, Carry=0 si no
 28+  A5C1              ; Si hay 4 en raya, pone Caracter='F' para que el juego pare
 29+  A5C1              ; Usa Posiciones1 con bordes $FF como topes
 30+  A5C1              Comprobar4enraya:
 31+  A5C1 F5               push af
 32+  A5C2 C5               push bc
 33+  A5C3 D5               push de
 34+  A5C4 E5               push hl
 35+  A5C5 DD E5            push ix
 36+  A5C7
 37+  A5C7                  ; Usar SlotPointer_Array para calcular direccion en Posiciones1
 38+  A5C7 CD A2 A6         call SlotPointer_Array   ; IX = direccion de la ficha en Posiciones1
 39+  A5CA
 40+  A5CA DD 4E 00         ld c, (ix)           ; C = color de la ficha (TINTA_Yel=6 o TINTA_Red=2)
 41+  A5CD
 42+  A5CD                  ; Guardar IX para restaurar en cada comprobacion
 43+  A5CD DD E5            push ix
 44+  A5CF
 45+  A5CF                  ; 1) HORIZONTAL (izquierda <-> derecha): DE = 1
 46+  A5CF 11 01 00         ld de, 1
 47+  A5D2 CD 20 A6         call cb1
 48+  A5D5 FE 04            cp 4
 49+  A5D7 30 34            jr nc, hay_4enraya_pop
 50+  A5D9
 51+  A5D9                  ; 2) VERTICAL (arriba <-> abajo): DE = 9 (tamcolumna)
 52+  A5D9 DD E1            pop ix
 53+  A5DB DD E5            push ix
 54+  A5DD 11 09 00         ld de, tamcolumna
 55+  A5E0 CD 20 A6         call cb1
 56+  A5E3 FE 04            cp 4
 57+  A5E5 30 26            jr nc, hay_4enraya_pop
 58+  A5E7
 59+  A5E7                  ; 3) DIAGONAL \ (arriba-izq <-> abajo-der): DE = 10 (tamcolumna+1)
 60+  A5E7 DD E1            pop ix
 61+  A5E9 DD E5            push ix
 62+  A5EB 11 0A 00         ld de, tamcolumna + 1
 63+  A5EE CD 20 A6         call cb1
 64+  A5F1 FE 04            cp 4
 65+  A5F3 30 18            jr nc, hay_4enraya_pop
 66+  A5F5
 67+  A5F5                  ; 4) DIAGONAL / (arriba-der <-> abajo-izq): DE = 8 (tamcolumna-1)
 68+  A5F5 DD E1            pop ix
 69+  A5F7 DD E5            push ix
 70+  A5F9 11 08 00         ld de, tamcolumna - 1
 71+  A5FC CD 20 A6         call cb1
 72+  A5FF FE 04            cp 4
 73+  A601 30 0A            jr nc, hay_4enraya_pop
 74+  A603
 75+  A603                  ; No hay 4 en raya
 76+  A603 DD E1            pop ix               ; limpiar stack
 77+  A605 DD E1            pop ix
 78+  A607 E1               pop hl
 79+  A608 D1               pop de
 80+  A609 C1               pop bc
 81+  A60A F1               pop af
 82+  A60B B7               or a                 ; Carry = 0
 83+  A60C C9               ret
 84+  A60D
 85+  A60D              hay_4enraya_pop:
 86+  A60D DD E1            pop ix               ; limpiar stack
 87+  A60F              hay_4enraya:
 88+  A60F                  ; Guardar color del ganador
 89+  A60F 79               ld a, c              ; C tiene el color de la ficha ganadora
 90+  A610 32 9A 9B         ld (Ganador), a
 91+  A613
 92+  A613 3E 46            ld a, 'F'
 93+  A615 32 9C 9B         ld (Caracter), a
 94+  A618 DD E1            pop ix
 95+  A61A E1               pop hl
 96+  A61B D1               pop de
 97+  A61C C1               pop bc
 98+  A61D F1               pop af
 99+  A61E 37               scf                  ; Carry = 1
100+  A61F C9               ret
101+  A620
102+  A620              ; Subrutina: Contar fichas consecutivas en ambas direcciones
103+  A620              ; Entrada: IX = posicion central, C = color a buscar, DE = desplazamiento
104+  A620              ; Salida: A = total de fichas consecutivas
105+  A620              ; Los bordes $FF actuan como tope (nunca coinciden con color 2 o 6)
106+  A620              cb1:
107+  A620 DD E5            push ix              ; guardar posicion central
108+  A622 06 01            ld b, 1              ; B = contador (1 por la ficha central)
109+  A624 D5               push de              ; guardar DE
110+  A625
111+  A625                  ; Contar en direccion positiva (+DE)
112+  A625              cb2_bucle1:
113+  A625 DD 19            add ix, de
114+  A627 DD 7E 00         ld a, (ix)           ; Leer casilla
115+  A62A B9               cp c                 ; Es del mismo color? (si es $FF o 0 o diferente, para)
116+  A62B 20 03            jr nz, cb1_seguir
117+  A62D 04               inc b
118+  A62E 18 F5            jr cb2_bucle1
119+  A630
120+  A630              cb1_seguir:
121+  A630                  ; Restaurar para direccion negativa
122+  A630 D1               pop de
123+  A631 DD E1            pop ix
124+  A633 DD E5            push ix
125+  A635
126+  A635                  ; Negar DE
127+  A635 AF               xor a
128+  A636 93               sub e
129+  A637 5F               ld e, a
130+  A638 3E 00            ld a, 0
131+  A63A 9A               sbc a, d
132+  A63B 57               ld d, a              ; DE = -DE
133+  A63C
134+  A63C                  ; Contar en direccion negativa
135+  A63C              cb2_bucle2:
136+  A63C DD 19            add ix, de
137+  A63E DD 7E 00         ld a, (ix)           ; Leer casilla
138+  A641 B9               cp c                 ; Es del mismo color?
139+  A642 20 03            jr nz, cb1_fin
140+  A644 04               inc b
141+  A645 18 F5            jr cb2_bucle2
142+  A647
143+  A647              cb1_fin:
144+  A647 DD E1            pop ix
145+  A649 78               ld a, b              ; A = total
146+  A64A C9               ret
147+  A64B
148+  A64B              ; Rutina: Mostrar resultado de la partida (centrado debajo de "La partida ha finalizado")
149+  A64B              ; Muestra "Ganador: Amarillo", "Ganador: Rojo" o "Tablas" segun el valor de Ganador
150+  A64B              MostrarResultado:
151+  A64B F5               push af
152+  A64C C5               push bc
153+  A64D DD E5            push ix
154+  A64F
155+  A64F 3A 9A 9B         ld a, (Ganador)
156+  A652
157+  A652                  ; Comprobar si es amarillo (TINTA_Yel = 6)
158+  A652 FE 06            cp TINTA_Yel
159+  A654 28 13            jr z, MostrarAmarillo
160+  A656
161+  A656                  ; Comprobar si es rojo (TINTA_Red = 2)
162+  A656 FE 02            cp TINTA_Red
163+  A658 28 1E            jr z, MostrarRojo
164+  A65A
165+  A65A                  ; Si no es ninguno, son tablas (Ganador = 0)
166+  A65A                  ; "Tablas" = 6 caracteres, centrado en columna (32-6)/2 = 13
167+  A65A 06 03            ld b, 3              ; Fila 3 (debajo de "La partida ha finalizado" que esta en fila 1)
168+  A65C 0E 0D            ld c, 13             ; Columna 13 (centrado)
169+  A65E 3E 07            ld a, 7              ; Atributo blanco
170+  A660 DD 21 91 9B      ld ix, M_TABLAS
171+  A664 CD 64 9C         call PRINTAT
172+  A667 18 1C            jr FinMostrarResultado
173+  A669
174+  A669              MostrarAmarillo:
175+  A669                  ; "Ganador: Amarillo" = 17 caracteres, centrado en columna (32-17)/2 = 7
176+  A669 06 03            ld b, 3              ; Fila 3
177+  A66B 0E 07            ld c, 7              ; Columna 7 (centrado)
178+  A66D 3E 06            ld a, TINTA_Yel      ; Atributo amarillo
179+  A66F DD 21 71 9B      ld ix, M_GAN_AMARILLO
180+  A673 CD 64 9C         call PRINTAT
181+  A676 18 0D            jr FinMostrarResultado
182+  A678
183+  A678              MostrarRojo:
184+  A678                  ; "Ganador: Rojo" = 13 caracteres, centrado en columna (32-13)/2 = 9
185+  A678 06 03            ld b, 3              ; Fila 3
186+  A67A 0E 09            ld c, 9              ; Columna 9 (centrado)
187+  A67C 3E 02            ld a, TINTA_Red      ; Atributo rojo
188+  A67E DD 21 83 9B      ld ix, M_GAN_ROJO
189+  A682 CD 64 9C         call PRINTAT
190+  A685
191+  A685              FinMostrarResultado:
192+  A685 DD E1            pop ix
193+  A687 C1               pop bc
194+  A688 F1               pop af
195+  A689 C9               ret
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\terminar.asm
116   A68A                     INCLUDE "slotpointer.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\slotpointer.asm
  1+  A68A              SlotPointer: ;h fila, l columna y te devuelve coordenada de atributos
  2+  A68A 7C               ld a,h
  3+  A68B CB 27            sla a
  4+  A68D CB 27            sla a
  5+  A68F CB 27            sla a
  6+  A691 CB 27            sla a
  7+  A693 CB 27            sla a
  8+  A695 B5               or L
  9+  A696 6F               ld l,a
 10+  A697 7C               ld a,h
 11+  A698 CB 2F            sra a
 12+  A69A CB 2F            sra a
 13+  A69C CB 2F            sra a
 14+  A69E F6 58            or $58
 15+  A6A0 67               ld h,a
 16+  A6A1 C9               ret
 17+  A6A2
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\slotpointer.asm
117   A6A2                     INCLUDE "SlotPointer_PosicionesArray.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\SlotPointer_PosicionesArray.asm
  1+  A6A2              ; SlotPointer para el array Posiciones1
  2+  A6A2              ; Similar a SlotPointer pero calcula la direccion en Posiciones1 en vez de atributos de pantalla
  3+  A6A2              ; Entrada: H = fila (0-5), L = columna (0-6)
  4+  A6A2              ; Salida: IX = direccion en Posiciones1
  5+  A6A2              ; Modifica: A, DE, IX
  6+  A6A2              SlotPointer_Array:
  7+  A6A2 7C               ld a, h              ; A = fila
  8+  A6A3 47               ld b, a              ; B = fila (guardar)
  9+  A6A4
 10+  A6A4                  ; fila * 9 = fila*8 + fila
 11+  A6A4 CB 27            sla a                ; A = fila*2
 12+  A6A6 CB 27            sla a                ; A = fila*4
 13+  A6A8 CB 27            sla a                ; A = fila*8
 14+  A6AA 80               add a, b             ; A = fila*9
 15+  A6AB 85               add a, l             ; A = fila*9 + columna
 16+  A6AC 3C               inc a                ; +1 por borde $FF izquierdo
 17+  A6AD
 18+  A6AD 5F               ld e, a
 19+  A6AE 16 00            ld d, 0
 20+  A6B0 DD 21 C8 9B      ld ix, Posiciones1
 21+  A6B4 DD 19            add ix, de           ; IX = Posiciones1 + offset
 22+  A6B6 C9               ret
 23+  A6B7
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\SlotPointer_PosicionesArray.asm
118   A6B7
119   A6B7
120   A6B7
121   A6B7
122   A6B7
123   A6B7              SOLTAR_TECLA:
124   A6B7 ED 78               IN A, (C)
125   A6B9 E6 1F               AND $1F ;ASEGURA QUE LOS BITS DE A (0-7) LOS PRIMEROS 5 SON LOS Q NOS INTERESAN, ASEGURA QUE A VALGA %00011111
126   A6BB FE 1F               CP $1F ;COMPRUEBA SI SE HA ESCRITO ALGO PORQUE SI VALE 1F SIGNIFICA QUE NO SE HA PULSADO TECLAS
127   A6BD 20 F8               JR NZ, SOLTAR_TECLA ;SI Z=0 (ES DECIR, A ES DISTINTO DE $1F), LA TECLA SIGUE PULSADA ENTONCES BUCLE HASTA QUE EL USUARIO LA SUELTE
128   A6BF C9                  RET
129   A6C0
130   A6C0
131   A6C0
132   A6C0
133   A6C0
134   A6C0
135   A6C0              LEER_SN:
136   A6C0 C5                  PUSH BC
137   A6C1              SN_0:
138   A6C1 01 FE FD            LD BC, $FDFE ;'S' en D1
139   A6C4 ED 78               IN A, (C)
140   A6C6 CB 4F               BIT 1, A
141   A6C8 20 0B               JR NZ, SN_1
142   A6CA CD B7 A6            CALL SOLTAR_TECLA
143   A6CD 3E 53               LD A, 'S'
144   A6CF CD D5 9C            CALL CLEARSCR
145   A6D2                     ;Z=1
146   A6D2 AF                  XOR A
147   A6D3 C1                  POP BC
148   A6D4 C9                  RET
149   A6D5
150   A6D5              SN_1:
151   A6D5 01 FE 7F            LD BC, $7FFE ;'N' en D3
152   A6D8 ED 78               IN A, (C)
153   A6DA CB 5F               BIT 3, A
154   A6DC 20 E3               JR NZ, SN_0
155   A6DE CD B7 A6            CALL SOLTAR_TECLA
156   A6E1 3E 4E               LD A, 'N'
157   A6E3 CD D5 9C            CALL CLEARSCR
158   A6E6 3E 00               LD A, 0
159   A6E8 D3 FE               OUT ($FE), A
160   A6EA CD D5 9C            CALL CLEARSCR
161   A6ED 06 0C               LD B, 12
162   A6EF 0E 0C               LD C, 12
163   A6F1 3E 50               LD A, 0+2*8+64
164   A6F3 DD 21 2D 9B         LD IX, M_GB
165   A6F7 CD 64 9C            CALL PRINTAT
166   A6FA                     ;Z=0
167   A6FA 3E 01               LD A, 1
168   A6FC B7                  OR A
169   A6FD C1                  POP BC
170   A6FE C9                  RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\main.asm
