# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\main.asm
  1   0000                     DEVICE ZXSPECTRUM48
  2   0000                     SLDOPT COMMENT WPMEM, LOGPOINT, ASSETION
  3   0000                     org $8000               ; Programa ubicado a partir de $8000 = 32768
  4   8000 31 00 00            ld sp, 0
  5   8003 C3 D5 9B            jp inicio
  6   8006              portada: INCBIN "portada.scr"
  7   9B06
  8   9B06              M_WL:
  9   9B06 42 69 65 6E         DB "Bienvenido al Conecta 4", 0
  9   9B0A 76 65 6E 69
  9   9B0E 64 6F 20 61
  9   9B12 6C 20 43 6F
  9   9B16 6E 65 63 74
  9   9B1A 61 20 34 00
 10   9B1E              M_PR:
 11   9B1E 51 75 69 65         DB "Quieres jugar?", 0
 11   9B22 72 65 73 20
 11   9B26 6A 75 67 61
 11   9B2A 72 3F 00
 12   9B2D              M_GB:
 13   9B2D 41 64 69 6F         DB "Adios!!!!", 0
 13   9B31 73 21 21 21
 13   9B35 21 00
 14   9B37              M_RS:
 15   9B37 00 00               DB 0,0
 16   9B39              M_PF:
 17   9B39 4C 61 20 70         DB "La partida ha finalizado  ", 0
 17   9B3D 61 72 74 69
 17   9B41 64 61 20 68
 17   9B45 61 20 66 69
 17   9B49 6E 61 6C 69
 17   9B4D 7A 61 64 6F
 17   9B51 20 20 00
 18   9B54              M_QJ:
 19   9B54 51 75 69 65         DB "Quieres jugar otra partida? ", 0
 19   9B58 72 65 73 20
 19   9B5C 6A 75 67 61
 19   9B60 72 20 6F 74
 19   9B64 72 61 20 70
 19   9B68 61 72 74 69
 19   9B6C 64 61 3F 20
 19   9B70 00
 20   9B71 00           FullTablero DB 0
 21   9B72 00           ColumnaFull db 0
 22   9B73 00           Caracter DB 0
 23   9B74              PAPEL_Azul EQU 1*8
 24   9B74              TINTA_Yel EQU 6
 25   9B74              TINTA_Red EQU 2
 26   9B74              TINTA_Blck EQU 0
 27   9B74 06           Color_Usuario db TINTA_Yel
 28   9B75              POS_MAX EQU $3A ;$5839 EN ATRIBUTOS (+24)
 29   9B75              POS_MIN EQU $20 ;$5821
 30   9B75              ;nuevas pos max
 31   9B75              POS_MAX1 EQU 6 ;$5839 EN ATRIBUTOS , en fila 7 en L
 32   9B75              POS_MIN1 EQU 0 ;columna inicial en atributos
 33   9B75              Posiciones:
 34   9B75 00 00 00 00         db 0,0,0,0,0,0,0
 34   9B79 00 00 00
 35   9B7C 00 00 00 00         db 0,0,0,0,0,0,0
 35   9B80 00 00 00
 36   9B83 00 00 00 00         db 0,0,0,0,0,0,0
 36   9B87 00 00 00
 37   9B8A 00 00 00 00         db 0,0,0,0,0,0,0
 37   9B8E 00 00 00
 38   9B91 00 00 00 00         db 0,0,0,0,0,0,0
 38   9B95 00 00 00
 39   9B98 00 00 00 00         db 0,0,0,0,0,0,0
 39   9B9C 00 00 00
 40   9B9F              Posiciones1:; poner $ff, cambiar rutina limpieza
 41   9B9F FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 41   9BA3 00 00 00 00
 41   9BA7 FF
 42   9BA8 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 42   9BAC 00 00 00 00
 42   9BB0 FF
 43   9BB1 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 43   9BB5 00 00 00 00
 43   9BB9 FF
 44   9BBA FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 44   9BBE 00 00 00 00
 44   9BC2 FF
 45   9BC3 FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 45   9BC7 00 00 00 00
 45   9BCB FF
 46   9BCC FF 00 00 00         db $ff,0,0,0,0,0,0,0,$ff
 46   9BD0 00 00 00 00
 46   9BD4 FF
 47   9BD5
 48   9BD5              ;recomendado usar DE para color y n.judador con EXX para ir cambiando
 49   9BD5              inicio:
 50   9BD5
 51   9BD5 3E 00               LD A, 0
 52   9BD7 D3 FE               OUT ($FE), A
 53   9BD9 CD A9 9C            CALL CLEARSCR
 54   9BDC CD 93 A0            CALL IMPORT_DRAW
 55   9BDF 06 00               LD B, 0
 56   9BE1 0E 05               LD C, 5
 57   9BE3 3E 42               LD A, 2+0*8+64
 58   9BE5 DD 21 06 9B         LD IX, M_WL
 59   9BE9 CD 38 9C            CALL PRINTAT
 60   9BEC
 61   9BEC 3E 06               LD A, 6
 62   9BEE 06 14               LD B, 20
 63   9BF0 0E 01               LD C, 1
 64   9BF2 DD 21 1E 9B         LD IX, M_PR
 65   9BF6 CD 38 9C            CALL PRINTAT
 66   9BF9 3E B0               LD A, 6*8+128
 67   9BFB 32 90 5A            LD ($5800+20*32+16), A
 68   9BFE
 69   9BFE CD 33 A6            CALL LEER_SN
 70   9C01 20 34               JR NZ, fin
 71   9C03 CD FB A4            CALL JUEGO ;al salir la primera vez con F baja a jugar nuevamente.
 72   9C06
 73   9C06              JUGAR_NUEVAMENTE:  ; empieza limpiando e imprimiendo los dos textos de la pantalla
 74   9C06 3E 00               LD A, 0
 75   9C08 D3 FE               OUT ($FE), A
 76   9C0A CD A9 9C            CALL CLEARSCR
 77   9C0D 06 01               LD B, 1
 78   9C0F 0E 05               LD C, 5
 79   9C11 3E 01               LD A, 1
 80   9C13 DD 21 39 9B         LD IX, M_PF
 81   9C17 CD 38 9C            CALL PRINTAT
 82   9C1A
 83   9C1A 3E 06               LD A, 6
 84   9C1C 06 0C               LD B, 12
 85   9C1E 0E 01               LD C, 1
 86   9C20 DD 21 54 9B         LD IX, M_QJ
 87   9C24 CD 38 9C            CALL PRINTAT
 88   9C27 3E B0               LD A, 6*8+128
 89   9C29 32 9E 59            LD ($5800+12*32+30), A
 90   9C2C CD 33 A6            CALL LEER_SN     ; hace la funcion nuevamente de la pantalla inicial
 91   9C2F 20 06               JR NZ, fin
 92   9C31
 93   9C31 CD FB A4            CALL JUEGO
 94   9C34 C3 06 9C            JP JUGAR_NUEVAMENTE
 95   9C37              fin:
 96   9C37 76                  HALT
 97   9C38
 98   9C38                      INCLUDE "PRINTAT.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\PRINTAT.asm
  1+  9C38              ; -------------------------------
  2+  9C38              ; ZX Spectrum Text print library
  3+  9C38              ; Daniel León - AOC - UFV 2020
  4+  9C38              ; -------------------------------
  5+  9C38
  6+  9C38
  7+  9C38              ; ----------------------------------------------------------------------------------------
  8+  9C38              ; PRINTAT - Print a string in a position and attributes as per registers:
  9+  9C38              ;		IN	A	: Bit 7=1 For Flash / Bit 6=1 For Brigh / Bit 5,4,3 for Paper / Bit 2,1,0 for Ink
 10+  9C38              ;		IN	B	: Row 0..23
 11+  9C38              ;		IN	C	: Column 0..31
 12+  9C38              ;		IN	IX	: Address of text (Text must end in a 0)
 13+  9C38              ; ----------------------------------------------------------------------------------------
 14+  9C38 CD 47 9C     PRINTAT:	CALL PREP_PRT				; Update Attribute var &Screen & Attributes pointers
 15+  9C3B              ; ----------------------------------------------------------------------------------------
 16+  9C3B              ;		VVV Do not move PRINTSTR below as PRINTAT continues into PRINTSTR routine
 17+  9C3B              ; ----------------------------------------------------------------------------------------
 18+  9C3B              ; PRINTSTR - Prints String - IX Points to the String start
 19+  9C3B              ; ----------------------------------------------------------------------------------------
 20+  9C3B DD 7E 00     PRINTSTR:   LD A,(IX)					; A Contains first char to print
 21+  9C3E B7           			OR A						; check for end of string (0)
 22+  9C3F C8           			RET Z						; Finish printing if 0
 23+  9C40 CD 75 9C     			CALL PRINTCHNUM
 24+  9C43 DD 23        			INC IX						; Move to next char in string
 25+  9C45 18 F4        			JR PRINTSTR					; Start over printing sequence
 26+  9C47              ; ----------------------------------------------------------------------------------------
 27+  9C47
 28+  9C47
 29+  9C47              ;-----------------------------------------------------------------------------------------
 30+  9C47              ; PREP_PRT - Updates Print_Attr, SCR & ATTR Vars
 31+  9C47              ;-----------------------------------------------------------------------------------------
 32+  9C47 32 BB 9C     PREP_PRT:	LD (PRINT_ATTR),A			; Set Attribute
 33+  9C4A CD 50 9C     PREP_PRT_2:	CALL CRtoSCREEN
 34+  9C4D C3 62 9C     			JP CRtoATTR
 35+  9C50              ;-----------------------------------------------------------------------------------------
 36+  9C50
 37+  9C50              ;-----------------------------------------------------------------------------------------
 38+  9C50              ; CRtoSCREEN - Converts a scr char coord into a SCREEN Address   b,c = y,x positions
 39+  9C50              ;	IN  - B=Row, C=Column
 40+  9C50              ;	OUT - HL=Address in screen also stored in (SCR_CUR_PTR)
 41+  9C50              ;	Conversion:
 42+  9C50              ;			Row FFfff   Column CCCCC
 43+  9C50              ;			HL=%010FF000 fffCCCCC
 44+  9C50              ;-----------------------------------------------------------------------------------------
 45+  9C50              CRtoSCREEN:
 46+  9C50 78           			LD A,B						; %___FFfff
 47+  9C51 F6 40        			OR #40						; %010FFfff
 48+  9C53 E6 F8        			AND #F8						; %010FF000
 49+  9C55 67           			LD H,A
 50+  9C56
 51+  9C56 78           			LD A,B						; %___FFfff
 52+  9C57 E6 07        			AND #7						; %00000fff
 53+  9C59 0F           			RRCA						; %f00000ff
 54+  9C5A 0F           			RRCA						; %ff00000f
 55+  9C5B 0F           			RRCA						; %fff00000
 56+  9C5C B1           			OR C						; %fffCCCCC
 57+  9C5D 6F           			LD L,A
 58+  9C5E 22 B7 9C                 LD (SCR_CUR_PTR),HL			; Update Variable
 59+  9C61 C9                       RET
 60+  9C62              ; ----------------------------------------------------------------------------------------
 61+  9C62
 62+  9C62
 63+  9C62
 64+  9C62              ;-----------------------------------------------------------------------------------------
 65+  9C62              ; CRtoATTR - Converts a screen char coord  into a ATTR Address  b,c = y,x positions
 66+  9C62              ;	IN  - B=Row, C=Column
 67+  9C62              ;	OUT - HL=Address in screen also stored in (SCR_ATTR_PTR)
 68+  9C62              ;	Conversion:
 69+  9C62              ;			Row FFfff   Column CCCCC
 70+  9C62              ;			HL=%010110FF fffCCCCC
 71+  9C62              ;-----------------------------------------------------------------------------------------
 72+  9C62              CRtoATTR:
 73+  9C62 78           			LD A,B						; %___FFfff
 74+  9C63 0F           			RRCA						; %f000FFff
 75+  9C64 0F           			RRCA						; %ff000FFf
 76+  9C65 0F           			RRCA						; %fff000FF
 77+  9C66 6F           			LD L,A
 78+  9C67 E6 03        			AND 3						; %000000FF	value of FF can be only 00,01,10
 79+  9C69 F6 58        			OR #58						; %010110FF value will be #58, #59 or #5A
 80+  9C6B 67           			LD H,A
 81+  9C6C
 82+  9C6C 7D           			LD A,L						; %fff000FF
 83+  9C6D E6 E0        			AND #E0						; %fff00000
 84+  9C6F B1           			OR C						; %fffCCCCC
 85+  9C70 6F           			LD L,A
 86+  9C71
 87+  9C71 22 B9 9C                 LD (SCR_ATTR_PTR),HL		; Update Variable
 88+  9C74 C9                       RET
 89+  9C75              ; ----------------------------------------------------------------------------------------
 90+  9C75
 91+  9C75
 92+  9C75
 93+  9C75              ; ----------------------------------------------------------------------------------------
 94+  9C75              ; PRINTCHNUM - Prints Char Number N (stored in A)
 95+  9C75              ;-----------------------------------------------------------------------------------------
 96+  9C75              PRINTCHNUM:	;SUB 32						; Adjust Ascii to charset
 97+  9C75 26 00        			LD H,0						; Multiply value by 8 to get to right Char in Charset
 98+  9C77 6F           			LD L,A
 99+  9C78 29           			ADD HL,HL
100+  9C79 29           			ADD HL,HL
101+  9C7A 29           			ADD HL,HL
102+  9C7B 11 BC 9B     			LD DE, CHARSET-(8*32)		; Optimize in compile time (instead of sub 32)
103+  9C7E 19           			ADD HL,DE
104+  9C7F EB           			EX  DE,HL					;Value in DE
105+  9C80              			; Continues to printchar below
106+  9C80              ; ----------------------------------------------------------------------------------------
107+  9C80
108+  9C80
109+  9C80              ; ----------------------------------------------------------------------------------------
110+  9C80              ; PRINTCHAR - Prints Char  (DE points to the char. Uses HL as last Cur Pointer)
111+  9C80              ; ----------------------------------------------------------------------------------------
112+  9C80              PRINTCHAR:
113+  9C80 06 08        			LD B,8						; 8 Lines per char
114+  9C82 2A B7 9C                 LD HL, (SCR_CUR_PTR)		; Load Cursor Pointer y,x
115+  9C85
116+  9C85 1A           BYTEPCHAR:	LD A,(DE)					; Get Char to be printed, first line
117+  9C86 77           			LD (HL),A					; Move to Printing location
118+  9C87 24                       INC H						; inc H so next line in char (ZX Spectrum Screen RAM)
119+  9C88 13                       INC DE 						; next line to be printed
120+  9C89 10 FA                    DJNZ BYTEPCHAR				; Repeat 8 lines
121+  9C8B 3A BB 9C                 LD A,(PRINT_ATTR) 			; Load Attributes to print char with
122+  9C8E 2A B9 9C                 LD HL, (SCR_ATTR_PTR)
123+  9C91 77                       LD (HL),A
124+  9C92 21 B9 9C                 LD HL, SCR_ATTR_PTR			; Get pointer to ATTR
125+  9C95 34                       INC (HL)					; Move Attribute cursor to next char
126+  9C96 21 B7 9C     			LD HL, SCR_CUR_PTR
127+  9C99 34           			INC (HL)					; update Cursor pointer to next position
128+  9C9A C9                       RET
129+  9C9B              ; ----------------------------------------------------------------------------------------
130+  9C9B
131+  9C9B
132+  9C9B
133+  9C9B              ; ----------------------------------------------------------------------------------------
134+  9C9B              ; INK2PAPER - moves ink of attribute stored in (PRINT_ATTR) to paper and sets ink to 0
135+  9C9B              ; 				Sets bright 1 and flash 0
136+  9C9B              ; ----------------------------------------------------------------------------------------
137+  9C9B 3A BB 9C     INK2PAPER:	LD A, (PRINT_ATTR)		    ; Get storedAttribute
138+  9C9E E6 07                    AND 7						; get Attr INK in A
139+  9CA0 07           			RLCA
140+  9CA1 07           			RLCA
141+  9CA2 07           			RLCA						; move Ink to Paper
142+  9CA3 F6 40        			OR 64						; ink 0 bright 1
143+  9CA5 32 BB 9C     			LD (PRINT_ATTR),A		    ; Get storedAttribute
144+  9CA8 C9           			RET
145+  9CA9              ; ----------------------------------------------------------------------------------------
146+  9CA9
147+  9CA9
148+  9CA9
149+  9CA9
150+  9CA9 21 00 40     CLEARSCR:	LD HL,$4000					; Erases screen by writing 0 to all pixels and attributes
151+  9CAC 11 01 40     			LD DE,$4001
152+  9CAF 01 FF 1A     			LD BC,6911
153+  9CB2 36 00        			LD (HL),0
154+  9CB4 ED B0        			LDIR
155+  9CB6 C9           			RET
156+  9CB7
157+  9CB7
158+  9CB7              SCR_CUR_PTR
158+  9CB7 00 00          	db $00, $00				; Cursor Pointer in Screen (2 bytes) (HL)
159+  9CB9 00 00        SCR_ATTR_PTR: 	db $00, $00				; Attr Pointer in Screen (2 bytes) (HL)
160+  9CBB 00           PRINT_ATTR:		db $00					; Attribute used by printchar routine (1 byte)
161+  9CBC
162+  9CBC              CHARSET: incbin "charset.bin"			; Charset used
163+  9FBC
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\PRINTAT.asm
 99   9FBC                      INCLUDE "TABLERO.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\TABLERO.asm
  1+  9FBC
  2+  9FBC              TABLERO_REDONDO:
  3+  9FBC E5                   push hl
  4+  9FBD DD E5                push ix
  5+  9FBF D5                   push de
  6+  9FC0 C5                   push bc
  7+  9FC1 F5                   push AF
  8+  9FC2
  9+  9FC2 CD A9 9C             CALL CLEARSCR
 10+  9FC5
 11+  9FC5                      ; Dibujar el fondo del tablero primero
 12+  9FC5 21 60 58             LD HL, $5800 + 96     ; HL se mueve 3 filas hacia abajo, dejando espacio arriba para ficha amarilla
 13+  9FC8 E5 DD E1             LD IX,HL
 14+  9FCB
 15+  9FCB 3E 08                LD A, 8             ; A = 8, color azul para las barras del tablero
 16+  9FCD 06 13                LD B, 19            ; B = 19, número de filas
 17+  9FCF              FullCuadrao:
 18+  9FCF 0E 1D                LD C, 29
 19+  9FD1              COLUMNA:
 20+  9FD1 77                   LD (HL), A          ; Escribe el color azul en HL
 21+  9FD2 23                   INC HL              ; Avanza HL al siguiente byte
 22+  9FD3 0D                   DEC C               ; Disminuye contador de columnas
 23+  9FD4 20 FB                JR NZ, COLUMNA
 24+  9FD6 11 20 00             LD DE, 32
 25+  9FD9 DD 19                ADD IX,DE
 26+  9FDB DD E5 E1             LD HL,IX
 27+  9FDE 05                   DEC B
 28+  9FDF 20 EE                JR NZ, FullCuadrao
 29+  9FE1              ; Fila 0: $4021 / $5821
 30+  9FE1 3E 00                LD A, 0
 31+  9FE3 32 74 9B             LD (Color_Usuario), A
 32+  9FE6 DD 21 21 40          LD IX, $4021
 33+  9FEA 21 21 58             LD HL, $5821
 34+  9FED 0E 07                LD C, 7
 35+  9FEF
 36+  9FEF              FilaColumnas0:
 37+  9FEF CD A5 A0             CALL FICHA
 38+  9FF2 11 04 00             LD DE, 4
 39+  9FF5 DD 19                ADD IX, DE
 40+  9FF7 19                   ADD HL, DE
 41+  9FF8 0D                   DEC C
 42+  9FF9 20 F4                JR NZ, FilaColumnas0
 43+  9FFB
 44+  9FFB                      ; Fila 2: $40E1 / $5881+96
 45+  9FFB DD 21 E1 40          LD IX, $40E1
 46+  9FFF 21 E1 58             LD HL, $5881 + 96
 47+  A002 0E 07                LD C, 7
 48+  A004              ; Fila 1: $4081 / $5881
 49+  A004 3E 08                LD A, %00001000     ; pongo la ficha en negro
 50+  A006 32 74 9B             LD (Color_Usuario), A
 51+  A009 DD 21 81 40          LD IX, $4081
 52+  A00D 21 81 58             LD HL, $5881
 53+  A010 0E 07                LD C, 7
 54+  A012              FilaColumnas1:
 55+  A012 CD A5 A0             CALL FICHA
 56+  A015 11 04 00             LD DE, 4
 57+  A018 DD 19                ADD IX, DE
 58+  A01A 19                   ADD HL, DE
 59+  A01B 0D                   DEC C
 60+  A01C 20 F4                JR NZ, FilaColumnas1
 61+  A01E
 62+  A01E                      ; Fila 2: $40E1 / $5881+96
 63+  A01E DD 21 E1 40          LD IX, $40E1
 64+  A022 21 E1 58             LD HL, $5881 + 96
 65+  A025 0E 07                LD C, 7
 66+  A027              FilaColumnas2:
 67+  A027 CD A5 A0             CALL FICHA
 68+  A02A 11 04 00             LD DE, 4
 69+  A02D DD 19                ADD IX, DE
 70+  A02F 19                   ADD HL, DE
 71+  A030 0D                   DEC C
 72+  A031 20 F4                JR NZ, FilaColumnas2
 73+  A033
 74+  A033                      ; Fila 3: $4841 / $5881+192
 75+  A033 DD 21 41 48          LD IX, $4841
 76+  A037 21 41 59             LD HL, $5881 + 192
 77+  A03A 0E 07                LD C, 7
 78+  A03C              FilaColumnas3:
 79+  A03C CD A5 A0             CALL FICHA
 80+  A03F 11 04 00             LD DE, 4
 81+  A042 DD 19                ADD IX, DE
 82+  A044 19                   ADD HL, DE
 83+  A045 0D                   DEC C
 84+  A046 20 F4                JR NZ, FilaColumnas3
 85+  A048
 86+  A048                      ; Fila 4: $48A1 / $5881+288
 87+  A048 DD 21 A1 48          LD IX, $48A1
 88+  A04C 21 A1 59             LD HL, $5881 + 288
 89+  A04F 0E 07                LD C, 7
 90+  A051              FilaColumnas4:
 91+  A051 CD A5 A0             CALL FICHA
 92+  A054 11 04 00             LD DE, 4
 93+  A057 DD 19                ADD IX, DE
 94+  A059 19                   ADD HL, DE
 95+  A05A 0D                   DEC C
 96+  A05B 20 F4                JR NZ, FilaColumnas4
 97+  A05D
 98+  A05D                      ; Fila 5: $5001 / $5881+384
 99+  A05D DD 21 01 50          LD IX, $5001
100+  A061 21 01 5A             LD HL, $5881 + 384
101+  A064 0E 07                LD C, 7
102+  A066              FilaColumnas5:
103+  A066 CD A5 A0             CALL FICHA
104+  A069 11 04 00             LD DE, 4
105+  A06C DD 19                ADD IX, DE
106+  A06E 19                   ADD HL, DE
107+  A06F 0D                   DEC C
108+  A070 20 F4                JR NZ, FilaColumnas5
109+  A072
110+  A072                      ; Fila 6: $5061 / $5881+480
111+  A072 DD 21 61 50          LD IX, $5061
112+  A076 21 61 5A             LD HL, $5881 + 480
113+  A079 0E 07                LD C, 7
114+  A07B              FilaColumnas6:
115+  A07B CD A5 A0             CALL FICHA
116+  A07E 11 04 00             LD DE, 4
117+  A081 DD 19                ADD IX, DE
118+  A083 19                   ADD HL, DE
119+  A084 0D                   DEC C
120+  A085 20 F4                JR NZ, FilaColumnas6
121+  A087
122+  A087 3E 06                LD A, 6
123+  A089 32 74 9B             LD (Color_Usuario), A
124+  A08C
125+  A08C F1                   pop AF
126+  A08D C1                   pop bc
127+  A08E D1                   pop de
128+  A08F DD E1                pop ix
129+  A091 E1                   pop hl
130+  A092
131+  A092 C9                   RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\TABLERO.asm
100   A093                      INCLUDE "Importar_portada.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Importar_portada.asm
  1+  A093              IMPORT_DRAW:
  2+  A093 E5               PUSH HL
  3+  A094 D5               PUSH DE
  4+  A095 C5               PUSH BC
  5+  A096 21 06 80         LD HL, portada
  6+  A099 11 00 40         LD DE, $4000
  7+  A09C 01 00 1B         LD BC, 6912
  8+  A09F ED B0            LDIR
  9+  A0A1 C1               POP BC
 10+  A0A2 D1               POP DE
 11+  A0A3 E1               POP HL
 12+  A0A4 C9               RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\Importar_portada.asm
101   A0A5                      INCLUDE "pintaficha1.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\pintaficha1.asm
  1+  A0A5              FICHA:; coje hl para pintar cuadrado y ix para la bola
  2+  A0A5 E5                   push hl
  3+  A0A6 D5                   push de
  4+  A0A7 C5                   push bc
  5+  A0A8 DD E5                push ix
  6+  A0AA F5                   PUSH AF
  7+  A0AB CD 18 A3             CALL PintaCuadrao
  8+  A0AE DD E5 E1             ld hl, ix
  9+  A0B1
 10+  A0B1                      ;Detectar si estamos en la fila problemática (segunda fila)
 11+  A0B1 7C                   LD A, H
 12+  A0B2 FE 40                CP $40
 13+  A0B4 20 0C                JR NZ, FICHA_NORMAL
 14+  A0B6 7D                   LD A, L
 15+  A0B7 FE E1                CP $E1
 16+  A0B9 38 07                JR C, FICHA_NORMAL    ; Si es menor que $E1, usar normal
 17+  A0BB FE FA                CP $FA
 18+  A0BD 30 03                JR NC, FICHA_NORMAL   ; Si es mayor o igual que $FA, usar normal
 19+  A0BF C3 EB A1             JP FICHA_ENTERCIO     ; Si está entre $E1 y $F9, usar específica
 20+  A0C2
 21+  A0C2              FICHA_NORMAL:
 22+  A0C2                      ;arriba izquierda
 23+  A0C2 3E 00                LD A,%00000000
 24+  A0C4 77                   LD(HL),A
 25+  A0C5 3E 01                LD A,%00000001
 26+  A0C7 11 00 01             LD DE, $100
 27+  A0CA 19                   ADD HL,DE
 28+  A0CB 77                   LD(HL),A
 29+  A0CC 3E 03                LD A,%00000011
 30+  A0CE 11 00 01             LD DE, $100
 31+  A0D1 19                   ADD HL,DE
 32+  A0D2 77                   LD(HL),A
 33+  A0D3 3E 07                LD A,%00000111
 34+  A0D5 11 00 01             LD DE, $100
 35+  A0D8 19                   ADD HL,DE
 36+  A0D9 77                   LD(HL),A
 37+  A0DA 11 00 01             LD DE, $100
 38+  A0DD 19                   ADD HL,DE
 39+  A0DE 77                   LD(HL),A
 40+  A0DF 3E 0F                LD A,%00001111
 41+  A0E1 11 00 01             LD DE, $100
 42+  A0E4 19                   ADD HL,DE
 43+  A0E5 77                   LD(HL),A
 44+  A0E6 11 00 01             LD DE, $100
 45+  A0E9 19                   ADD HL,DE
 46+  A0EA 77                   LD(HL),A
 47+  A0EB 11 00 01             LD DE, $100
 48+  A0EE 19                   ADD HL,DE
 49+  A0EF 77                   LD(HL),A
 50+  A0F0
 51+  A0F0                      ;arriba centro
 52+  A0F0 DD 23                INC IX
 53+  A0F2 DD E5 E1             LD HL, IX
 54+  A0F5
 55+  A0F5 3E 7E                LD A,%01111110
 56+  A0F7 77                   LD(HL),A
 57+  A0F8 3E FF                LD A,%11111111
 58+  A0FA 11 00 01             LD DE, $100
 59+  A0FD 19                   ADD HL,DE
 60+  A0FE 77                   LD(HL),A
 61+  A0FF 3E FF                LD A,%11111111
 62+  A101 11 00 01             LD DE, $100
 63+  A104 19                   ADD HL,DE
 64+  A105 77                   LD(HL),A
 65+  A106 11 00 01             LD DE, $100
 66+  A109 19                   ADD HL,DE
 67+  A10A 77                   LD(HL),A
 68+  A10B 11 00 01             LD DE, $100
 69+  A10E 19                   ADD HL,DE
 70+  A10F 77                   LD(HL),A
 71+  A110 11 00 01             LD DE, $100
 72+  A113 19                   ADD HL,DE
 73+  A114 77                   LD(HL),A
 74+  A115 11 00 01             LD DE, $100
 75+  A118 19                   ADD HL,DE
 76+  A119 77                   LD(HL),A
 77+  A11A 11 00 01             LD DE, $100
 78+  A11D 19                   ADD HL,DE
 79+  A11E 77                   LD(HL),A
 80+  A11F
 81+  A11F                      ;arriba derecha
 82+  A11F
 83+  A11F DD 23                INC IX
 84+  A121 DD E5 E1             LD HL, IX
 85+  A124 3E 00                LD A,%00000000
 86+  A126 77                   LD(HL),A
 87+  A127 3E 80                LD A,%10000000
 88+  A129 11 00 01             LD DE, $100
 89+  A12C 19                   ADD HL,DE
 90+  A12D 77                   LD(HL),A
 91+  A12E 3E C0                LD A,%11000000
 92+  A130 11 00 01             LD DE, $100
 93+  A133 19                   ADD HL,DE
 94+  A134 77                   LD(HL),A
 95+  A135 3E E0                LD A,%11100000
 96+  A137 11 00 01             LD DE, $100
 97+  A13A 19                   ADD HL,DE
 98+  A13B 77                   LD(HL),A
 99+  A13C 11 00 01             LD DE, $100
100+  A13F 19                   ADD HL,DE
101+  A140 77                   LD(HL),A
102+  A141 3E F0                LD A,%11110000
103+  A143 11 00 01             LD DE, $100
104+  A146 19                   ADD HL,DE
105+  A147 77                   LD(HL),A
106+  A148 11 00 01             LD DE, $100
107+  A14B 19                   ADD HL,DE
108+  A14C 77                   LD(HL),A
109+  A14D 11 00 01             LD DE, $100
110+  A150 19                   ADD HL,DE
111+  A151 77                   LD(HL),A
112+  A152
113+  A152
114+  A152                      ;ld de,32
115+  A152                      ;add hl, de
116+  A152
117+  A152                      ;abajo derecha
118+  A152
119+  A152 01 20 00             ld bc,$20
120+  A155 DD 09                ADD IX, BC
121+  A157 DD E5 E1             LD HL,IX
122+  A15A 3E F0                LD A,%11110000
123+  A15C 77                   LD(HL),A
124+  A15D 11 00 01             LD DE, $100
125+  A160 19                   ADD HL,DE
126+  A161 77                   LD(HL),A
127+  A162 11 00 01             LD DE, $100
128+  A165 19                   ADD HL,DE
129+  A166 77                   LD(HL),A
130+  A167 3E E0                LD A,%11100000
131+  A169 11 00 01             LD DE, $100
132+  A16C 19                   ADD HL,DE
133+  A16D 77                   LD(HL),A
134+  A16E 11 00 01             LD DE, $100
135+  A171 19                   ADD HL,DE
136+  A172 77                   LD(HL),A
137+  A173 3E C0                LD A,%11000000
138+  A175 11 00 01             LD DE, $100
139+  A178 19                   ADD HL,DE
140+  A179 77                   LD(HL),A
141+  A17A 3E 80                LD A,%10000000
142+  A17C 11 00 01             LD DE, $100
143+  A17F 19                   ADD HL,DE
144+  A180 77                   LD(HL),A
145+  A181 3E 00                LD A,%00000000
146+  A183 11 00 01             LD DE, $100
147+  A186 19                   ADD HL,DE
148+  A187 77                   LD(HL),A
149+  A188
150+  A188                      ;abajo centro
151+  A188
152+  A188 DD 2B                DEC IX
153+  A18A DD E5 E1             LD HL,IX
154+  A18D 3E FF                LD A,%11111111
155+  A18F 77                   LD(HL),A
156+  A190 11 00 01             LD DE, $100
157+  A193 19                   ADD HL,DE
158+  A194 77                   LD(HL),A
159+  A195 11 00 01             LD DE, $100
160+  A198 19                   ADD HL,DE
161+  A199 77                   LD(HL),A
162+  A19A 11 00 01             LD DE, $100
163+  A19D 19                   ADD HL,DE
164+  A19E 77                   LD(HL),A
165+  A19F 11 00 01             LD DE, $100
166+  A1A2 19                   ADD HL,DE
167+  A1A3 77                   LD(HL),A
168+  A1A4 11 00 01             LD DE, $100
169+  A1A7 19                   ADD HL,DE
170+  A1A8 77                   LD(HL),A
171+  A1A9 11 00 01             LD DE, $100
172+  A1AC 19                   ADD HL,DE
173+  A1AD 77                   LD(HL),A
174+  A1AE 11 00 01             LD DE, $100
175+  A1B1 19                   ADD HL,DE
176+  A1B2 3E 7E                LD A,%01111110
177+  A1B4 77                   LD(HL),A
178+  A1B5
179+  A1B5                      ;abajo izquierda
180+  A1B5 DD 2B                DEC IX
181+  A1B7 DD E5 E1             LD HL,IX
182+  A1BA 3E 0F                LD A,%00001111
183+  A1BC 77                   LD(HL),A
184+  A1BD 11 00 01             LD DE, $100
185+  A1C0 19                   ADD HL,DE
186+  A1C1 77                   LD(HL),A
187+  A1C2 11 00 01             LD DE, $100
188+  A1C5 19                   ADD HL,DE
189+  A1C6 77                   LD(HL),A
190+  A1C7 3E 07                LD A,%00000111
191+  A1C9 11 00 01             LD DE, $100
192+  A1CC 19                   ADD HL,DE
193+  A1CD 77                   LD(HL),A
194+  A1CE 11 00 01             LD DE, $100
195+  A1D1 19                   ADD HL,DE
196+  A1D2 77                   LD(HL),A
197+  A1D3 3E 03                LD A,%00000011
198+  A1D5 11 00 01             LD DE, $100
199+  A1D8 19                   ADD HL,DE
200+  A1D9 77                   LD(HL),A
201+  A1DA 3E 01                LD A,%00000001
202+  A1DC 11 00 01             LD DE, $100
203+  A1DF 19                   ADD HL,DE
204+  A1E0 77                   LD(HL),A
205+  A1E1 3E 00                LD A,%00000000
206+  A1E3 11 00 01             LD DE, $100
207+  A1E6 19                   ADD HL,DE
208+  A1E7 77                   LD(HL),A
209+  A1E8 C3 11 A3             jp Fin_Ficha
210+  A1EB
211+  A1EB              FICHA_ENTERCIO:
212+  A1EB                      ;arriba izquierda
213+  A1EB 3E 00                LD A,%00000000
214+  A1ED 77                   LD(HL),A
215+  A1EE 3E 01                LD A,%00000001
216+  A1F0 11 00 01             LD DE, $100
217+  A1F3 19                   ADD HL,DE
218+  A1F4 77                   LD(HL),A
219+  A1F5 3E 03                LD A,%00000011
220+  A1F7 11 00 01             LD DE, $100
221+  A1FA 19                   ADD HL,DE
222+  A1FB 77                   LD(HL),A
223+  A1FC 3E 07                LD A,%00000111
224+  A1FE 11 00 01             LD DE, $100
225+  A201 19                   ADD HL,DE
226+  A202 77                   LD(HL),A
227+  A203 11 00 01             LD DE, $100
228+  A206 19                   ADD HL,DE
229+  A207 77                   LD(HL),A
230+  A208 3E 0F                LD A,%00001111
231+  A20A 11 00 01             LD DE, $100
232+  A20D 19                   ADD HL,DE
233+  A20E 77                   LD(HL),A
234+  A20F 11 00 01             LD DE, $100
235+  A212 19                   ADD HL,DE
236+  A213 77                   LD(HL),A
237+  A214 11 00 01             LD DE, $100
238+  A217 19                   ADD HL,DE
239+  A218 77                   LD(HL),A
240+  A219
241+  A219                      ;arriba centro
242+  A219 DD 23                INC IX
243+  A21B DD E5 E1             LD HL, IX
244+  A21E
245+  A21E 3E 7E                LD A,%01111110
246+  A220 77                   LD(HL),A
247+  A221 3E FF                LD A,%11111111
248+  A223 11 00 01             LD DE, $100
249+  A226 19                   ADD HL,DE
250+  A227 77                   LD(HL),A
251+  A228 3E FF                LD A,%11111111
252+  A22A 11 00 01             LD DE, $100
253+  A22D 19                   ADD HL,DE
254+  A22E 77                   LD(HL),A
255+  A22F 11 00 01             LD DE, $100
256+  A232 19                   ADD HL,DE
257+  A233 77                   LD(HL),A
258+  A234 11 00 01             LD DE, $100
259+  A237 19                   ADD HL,DE
260+  A238 77                   LD(HL),A
261+  A239 11 00 01             LD DE, $100
262+  A23C 19                   ADD HL,DE
263+  A23D 77                   LD(HL),A
264+  A23E 11 00 01             LD DE, $100
265+  A241 19                   ADD HL,DE
266+  A242 77                   LD(HL),A
267+  A243 11 00 01             LD DE, $100
268+  A246 19                   ADD HL,DE
269+  A247 77                   LD(HL),A
270+  A248
271+  A248                      ;arriba derecha
272+  A248
273+  A248 DD 23                INC IX
274+  A24A DD E5 E1             LD HL, IX
275+  A24D 3E 00                LD A,%00000000
276+  A24F 77                   LD(HL),A
277+  A250 3E 80                LD A,%10000000
278+  A252 11 00 01             LD DE, $100
279+  A255 19                   ADD HL,DE
280+  A256 77                   LD(HL),A
281+  A257 3E C0                LD A,%11000000
282+  A259 11 00 01             LD DE, $100
283+  A25C 19                   ADD HL,DE
284+  A25D 77                   LD(HL),A
285+  A25E 3E E0                LD A,%11100000
286+  A260 11 00 01             LD DE, $100
287+  A263 19                   ADD HL,DE
288+  A264 77                   LD(HL),A
289+  A265 11 00 01             LD DE, $100
290+  A268 19                   ADD HL,DE
291+  A269 77                   LD(HL),A
292+  A26A 3E F0                LD A,%11110000
293+  A26C 11 00 01             LD DE, $100
294+  A26F 19                   ADD HL,DE
295+  A270 77                   LD(HL),A
296+  A271 11 00 01             LD DE, $100
297+  A274 19                   ADD HL,DE
298+  A275 77                   LD(HL),A
299+  A276 11 00 01             LD DE, $100
300+  A279 19                   ADD HL,DE
301+  A27A 77                   LD(HL),A
302+  A27B
303+  A27B                      ;abajo derecha en tercio
304+  A27B
305+  A27B 01 20 07             ld bc,$720
306+  A27E DD 09                ADD IX, BC
307+  A280 DD E5 E1             LD HL,IX
308+  A283 3E F0                LD A,%11110000
309+  A285 77                   LD(HL),A
310+  A286 11 00 01             LD DE, $100
311+  A289 19                   ADD HL,DE
312+  A28A 77                   LD(HL),A
313+  A28B 11 00 01             LD DE, $100
314+  A28E 19                   ADD HL,DE
315+  A28F 77                   LD(HL),A
316+  A290 3E E0                LD A,%11100000
317+  A292 11 00 01             LD DE, $100
318+  A295 19                   ADD HL,DE
319+  A296 77                   LD(HL),A
320+  A297 11 00 01             LD DE, $100
321+  A29A 19                   ADD HL,DE
322+  A29B 77                   LD(HL),A
323+  A29C 3E C0                LD A,%11000000
324+  A29E 11 00 01             LD DE, $100
325+  A2A1 19                   ADD HL,DE
326+  A2A2 77                   LD(HL),A
327+  A2A3 3E 80                LD A,%10000000
328+  A2A5 11 00 01             LD DE, $100
329+  A2A8 19                   ADD HL,DE
330+  A2A9 77                   LD(HL),A
331+  A2AA 3E 00                LD A,%00000000
332+  A2AC 11 00 01             LD DE, $100
333+  A2AF 19                   ADD HL,DE
334+  A2B0 77                   LD(HL),A
335+  A2B1
336+  A2B1                      ;abajo centro
337+  A2B1
338+  A2B1 DD 2B                DEC IX
339+  A2B3 DD E5 E1             LD HL,IX
340+  A2B6 3E FF                LD A,%11111111
341+  A2B8 77                   LD(HL),A
342+  A2B9 11 00 01             LD DE, $100
343+  A2BC 19                   ADD HL,DE
344+  A2BD 77                   LD(HL),A
345+  A2BE 11 00 01             LD DE, $100
346+  A2C1 19                   ADD HL,DE
347+  A2C2 77                   LD(HL),A
348+  A2C3 11 00 01             LD DE, $100
349+  A2C6 19                   ADD HL,DE
350+  A2C7 77                   LD(HL),A
351+  A2C8 11 00 01             LD DE, $100
352+  A2CB 19                   ADD HL,DE
353+  A2CC 77                   LD(HL),A
354+  A2CD 11 00 01             LD DE, $100
355+  A2D0 19                   ADD HL,DE
356+  A2D1 77                   LD(HL),A
357+  A2D2 11 00 01             LD DE, $100
358+  A2D5 19                   ADD HL,DE
359+  A2D6 77                   LD(HL),A
360+  A2D7 11 00 01             LD DE, $100
361+  A2DA 19                   ADD HL,DE
362+  A2DB 3E 7E                LD A,%01111110
363+  A2DD 77                   LD(HL),A
364+  A2DE
365+  A2DE                      ;abajo izquierda
366+  A2DE DD 2B                DEC IX
367+  A2E0 DD E5 E1             LD HL,IX
368+  A2E3 3E 0F                LD A,%00001111
369+  A2E5 77                   LD(HL),A
370+  A2E6 11 00 01             LD DE, $100
371+  A2E9 19                   ADD HL,DE
372+  A2EA 77                   LD(HL),A
373+  A2EB 11 00 01             LD DE, $100
374+  A2EE 19                   ADD HL,DE
375+  A2EF 77                   LD(HL),A
376+  A2F0 3E 07                LD A,%00000111
377+  A2F2 11 00 01             LD DE, $100
378+  A2F5 19                   ADD HL,DE
379+  A2F6 77                   LD(HL),A
380+  A2F7 11 00 01             LD DE, $100
381+  A2FA 19                   ADD HL,DE
382+  A2FB 77                   LD(HL),A
383+  A2FC 3E 03                LD A,%00000011
384+  A2FE 11 00 01             LD DE, $100
385+  A301 19                   ADD HL,DE
386+  A302 77                   LD(HL),A
387+  A303 3E 01                LD A,%00000001
388+  A305 11 00 01             LD DE, $100
389+  A308 19                   ADD HL,DE
390+  A309 77                   LD(HL),A
391+  A30A 3E 00                LD A,%00000000
392+  A30C 11 00 01             LD DE, $100
393+  A30F 19                   ADD HL,DE
394+  A310 77                   LD(HL),A
395+  A311              Fin_Ficha:
396+  A311 F1                   POP AF
397+  A312 DD E1                pop ix
398+  A314 C1                   pop bc
399+  A315 D1                   pop de
400+  A316 E1                   pop hl
401+  A317 C9                   RET
402+  A318
403+  A318              PintaCuadrao:;coge hl externo
404+  A318
405+  A318 3A 74 9B             LD A, (Color_Usuario)
406+  A31B 18 02                JR SEGUIR
407+  A31D              BORRAR_FICHA:
408+  A31D 3E 00                LD A,0
409+  A31F              SEGUIR:
410+  A31F C5                   PUSH BC
411+  A320 E5                   PUSH HL
412+  A321 F5                   PUSH AF
413+  A322
414+  A322
415+  A322 77                   LD (HL), A
416+  A323 23                   INC HL
417+  A324 77                   LD (HL), A
418+  A325 23                   INC HL
419+  A326 77                   LD (HL), A
420+  A327 11 20 00             LD DE,32
421+  A32A 19                   ADD HL,DE
422+  A32B 77                   LD (HL), A
423+  A32C 2B                   DEC HL
424+  A32D 77                   LD (HL),A
425+  A32E 2B                   DEC HL
426+  A32F 77                   LD (HL), A
427+  A330
428+  A330 F1                   POP AF
429+  A331 E1                   POP HL
430+  A332 C1                   POP BC
431+  A333 C9                   RET
432+  A334
433+  A334              ; Variables para guardar posicion final de la ficha (usadas por Comprobar4enraya)
434+  A334 00           ColumnaFinal: db 0              ; Columna donde cayo la ficha (0-6)
435+  A335 00           FilaFinal:    db 0              ; Fila donde cayo la ficha (0-5)
436+  A336
437+  A336              Animacion_Caeficha:
438+  A336
439+  A336 AF                   xor a
440+  A337 32 72 9B             ld (ColumnaFull), a
441+  A33A
442+  A33A                      ; GUARDAMOS LA COLUMNA para usarla despues en Comprobar4enraya
443+  A33A 7D                   ld a, l                ; A columna (0-6)
444+  A33B 32 34 A3             ld (ColumnaFinal), a   ; Guardar columna para despues
445+  A33E
446+  A33E DD 21 9F 9B          ld ix, Posiciones1     ; IX = inicio del tablero
447+  A342 3C                   inc a                  ; +1 por el $ff
448+  A343 5F                   ld e, a
449+  A344 16 00                ld d, 0
450+  A346 DD 19                add ix, de             ; IX = Posiciones1 +1 + columna
451+  A348
452+  A348 11 2D 00             ld de, 9*5             ; 45 bytes, ultima fila
453+  A34B DD 19                add ix, de             ; IX apunta a ultima fila
454+  A34D
455+  A34D 06 06                ld b, 6                ; 6 filas (5..0)
456+  A34F 11 F7 FF             ld de, -9              ; salto hacia arriba una fila
457+  A352
458+  A352              BuscarHueco:
459+  A352 DD 7E 00             ld a, (ix)
460+  A355 FE 00                cp 0
461+  A357 28 06                jr z, HuecoEncontrado
462+  A359
463+  A359 DD 19                add ix, de             ; subir 1 fila
464+  A35B 10 F5                djnz BuscarHueco
465+  A35D
466+  A35D 18 2F                jr ColumnaLlena
467+  A35F
468+  A35F              HuecoEncontrado:
469+  A35F
470+  A35F                      ; Guardamos color
471+  A35F 3A 74 9B             ld a, (Color_Usuario)
472+  A362 DD 77 00             ld (ix), a
473+  A365
474+  A365                      ; CALCULAMOS Y GUARDAMOS LA FILA FINAL
475+  A365                      ; B=6 -> fila 5, B=5 -> fila 4, ..., B=1 -> fila 0
476+  A365                      ; Fila = B - 1
477+  A365 78                   ld a, b
478+  A366 3D                   dec a
479+  A367 32 35 A3             ld (FilaFinal), a      ; Guardar fila para Comprobar4enraya
480+  A36A
481+  A36A                      ; B vale filas probadas
482+  A36A 48                   ld c, b                ; C = veces que cae
483+  A36B 26 00                ld h, 0                ; empezar caida desde encima del tablero
484+  A36D
485+  A36D              bucle_Cae:
486+  A36D 24                   inc H
487+  A36E CD 94 A3             call PintaCuadrao1
488+  A371 CD CF A3             call ESPERAR
489+  A374 0D                   dec c
490+  A375 28 05                jr z, TerminaAnimacion
491+  A377 CD A4 A3             call BORRAR_FICHA1
492+  A37A 18 F1                jr bucle_Cae
493+  A37C              TerminaAnimacion:
494+  A37C AF                   xor a
495+  A37D 32 72 9B             ld (ColumnaFull), a
496+  A380                      ; Cargar fila y columna guardadas para Comprobar4enraya
497+  A380                      ; H = fila (0-5), L = columna (0-6)
498+  A380 E5                   push hl                ; Guardar HL actual
499+  A381 3A 35 A3             ld a, (FilaFinal)
500+  A384 67                   ld h, a
501+  A385 3A 34 A3             ld a, (ColumnaFinal)
502+  A388 6F                   ld l, a
503+  A389 CD 77 A5             call Comprobar4enraya
504+  A38C E1                   pop hl                 ; Restaurar HL
505+  A38D C9                   ret
506+  A38E              ColumnaLlena:
507+  A38E 3E 01                ld a, 1
508+  A390 32 72 9B             ld (ColumnaFull),a
509+  A393 C9                   ret
510+  A394              PintaCuadrao1:;coge hl externo, DE 0-6 EN H (FILA) Y L (COLUMNA) CALCULA COORD Y PINTA
511+  A394
512+  A394 7C                   LD A, H
513+  A395 B7                   OR A
514+  A396 28 07                JR Z, COLOR_SUPERIOR
515+  A398 3A 74 9B             LD A, (Color_Usuario)
516+  A39B F6 08                OR PAPEL_Azul
517+  A39D 18 0E                JR SEGUIR1
518+  A39F              COLOR_SUPERIOR:
519+  A39F 3A 74 9B             LD A, (Color_Usuario)
520+  A3A2 18 09                JR SEGUIR1
521+  A3A4              BORRAR_FICHA1:
522+  A3A4 7C                   LD A, H ;compruebo si es arriba del tablero(h=0)
523+  A3A5 B7                   OR A
524+  A3A6 28 04                JR Z, BORRAR_SUPERIOR
525+  A3A8 3E 08                LD A, PAPEL_Azul + TINTA_Blck
526+  A3AA 18 01                JR SEGUIR1
527+  A3AC              BORRAR_SUPERIOR:
528+  A3AC AF                   XOR A
529+  A3AD              SEGUIR1:
530+  A3AD E5                   PUSH HL
531+  A3AE F5                   PUSH AF
532+  A3AF F5                   PUSH AF
533+  A3B0 7C                   LD A, H  ; H= H*3 +1 "abajo"
534+  A3B1 84                   ADD A, H
534+  A3B2 84            ADD A, H
535+  A3B3 3C                   INC A
536+  A3B4 67                   LD H,A
537+  A3B5 7D                   LD A,L ; L = L*4 +1 "derecha"
538+  A3B6 85                   ADD A,L
539+  A3B7 87                   ADD A,A
540+  A3B8 3C                   INC A
541+  A3B9 6F                   LD L,A
542+  A3BA CD FD A5             CALL SlotPointer ;HL>$5800
543+  A3BD F1                   POP AF
544+  A3BE 77                   LD (HL), A
545+  A3BF 23                   INC HL
546+  A3C0 77                   LD (HL), A
547+  A3C1 23                   INC HL
548+  A3C2 77                   LD (HL), A
549+  A3C3 11 20 00             LD DE,32
550+  A3C6 19                   ADD HL,DE
551+  A3C7 77                   LD (HL), A
552+  A3C8 2B                   DEC HL
553+  A3C9 77                   LD (HL),A
554+  A3CA 2B                   DEC HL
555+  A3CB 77                   LD (HL), A
556+  A3CC
557+  A3CC F1                   POP AF
558+  A3CD E1                   POP HL
559+  A3CE C9                   RET
560+  A3CF              ESPERAR:
561+  A3CF C5                   push bc
562+  A3D0 06 32                LD B,50
563+  A3D2 0E FF        D1:     LD C, 255
564+  A3D4 0D           D2:     DEC C
565+  A3D5 20 FD                JR NZ,D2
566+  A3D7 10 F9                DJNZ D1
567+  A3D9 C1                   pop bc
568+  A3DA C9                   RET
569+  A3DB
570+  A3DB
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\pintaficha1.asm
102   A3DB                      INCLUDE "telasNuevas.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\telasNuevas.asm
  1+  A3DB              ;funciones al leer una tecla válida(excepto F que hace que salga):
  2+  A3DB              MOVER_DERECHA:
  3+  A3DB CD A4 A3         CALL BORRAR_FICHA1
  4+  A3DE 2C               INC L
  5+  A3DF 7D               LD A, L
  6+  A3E0 FE 06            CP POS_MAX1
  7+  A3E2 28 04            JR Z, DIBUJA_DCHA
  8+  A3E4 38 02            JR C, DIBUJA_DCHA
  9+  A3E6              SALTO_FINAL:
 10+  A3E6 2E 00            LD L, 0
 11+  A3E8              DIBUJA_DCHA:
 12+  A3E8 CD 94 A3         CALL PintaCuadrao1
 13+  A3EB C9               RET
 14+  A3EC
 15+  A3EC
 16+  A3EC              MOVER_IZQUIERDA:
 17+  A3EC CD A4 A3         CALL BORRAR_FICHA1
 18+  A3EF 7D               LD A, L
 19+  A3F0 FE 00            CP POS_MIN1
 20+  A3F2 28 07            JR Z, SALTO_INICIO
 21+  A3F4 38 05            JR C, SALTO_INICIO
 22+  A3F6 2D               DEC L
 23+  A3F7 CD 94 A3         CALL PintaCuadrao1
 24+  A3FA C9               RET
 25+  A3FB              SALTO_INICIO:
 26+  A3FB 2E 06            LD L, POS_MAX1
 27+  A3FD CD 94 A3         CALL PintaCuadrao1
 28+  A400 C9               RET
 29+  A401
 30+  A401              ;función principal---------------------------------
 31+  A401              ES_AMARILLOYNolocambio:
 32+  A401 CD 94 A3         CALL PintaCuadrao1
 33+  A404              TECLAS: ; CAMBIA A
 34+  A404 C5               PUSH BC
 35+  A405
 36+  A405              L15:
 37+  A405 01 FE FB         LD BC,$FBFE
 38+  A408 ED 78            IN A,(C)
 39+  A40A CB 47            BIT 0,A
 40+  A40C 20 0D            JR NZ,L16
 41+  A40E CD 2A A6         CALL SOLTAR_TECLA
 42+  A411 3E 51            LD A,'Q'
 43+  A413 32 73 9B         LD (Caracter),A
 44+  A416 C1               POP BC
 45+  A417 CD EC A3         CALL MOVER_IZQUIERDA
 46+  A41A C9               RET
 47+  A41B              L16:
 48+  A41B CB 4F            BIT 1,A
 49+  A41D 20 0D            JR NZ,L17
 50+  A41F CD 2A A6         CALL SOLTAR_TECLA
 51+  A422 3E 57            LD A,'W'
 52+  A424 32 73 9B         LD (Caracter),A
 53+  A427 C1               POP BC
 54+  A428 CD DB A3         CALL MOVER_DERECHA
 55+  A42B C9               RET
 56+  A42C
 57+  A42C
 58+  A42C              L17:
 59+  A42C 01 FE FD         LD BC,$FDFE
 60+  A42F ED 78            IN A,(C)
 61+  A431 CB 5F            BIT 3,A
 62+  A433 20 0A            JR NZ,L5
 63+  A435 CD 2A A6         CALL SOLTAR_TECLA
 64+  A438 3E 46            LD A,'F'
 65+  A43A 32 73 9B         LD (Caracter),A
 66+  A43D C1               POP BC
 67+  A43E C9               RET
 68+  A43F              L5:                     ; Este cambia porque es RETURN y se carga como carácter $FF
 69+  A43F 01 FE BF         LD BC,$BFFE
 70+  A442 ED 78            IN A,(C)
 71+  A444 CB 47            BIT 0,A
 72+  A446 20 BD            JR NZ,L15
 73+  A448 CD 2A A6         CALL SOLTAR_TECLA
 74+  A44B 3E FF            LD A,$FF
 75+  A44D 32 73 9B         LD (Caracter),A
 76+  A450 C1               POP BC
 77+  A451 18 1D            jr CAMBIAR_USUARIO
 78+  A453
 79+  A453
 80+  A453              ;cambio de usuario y lectura de movimiento con o-p
 81+  A453              ES_ROJO:
 82+  A453 CD 59 A5         CALL Tablero_lleno
 83+  A456 3A 71 9B         ld a, (FullTablero)
 84+  A459 FE 01            cp 1
 85+  A45B 28 0D            jr z, seAcaba
 86+  A45D 3E 06            LD A, TINTA_Yel          ; cambiar a amarillo (sin papel)
 87+  A45F 32 74 9B         LD (Color_Usuario), A
 88+  A462 26 00            LD H,0    ; Restaurar posición inicial
 89+  A464 2E 00            LD L,0
 90+  A466 CD 94 A3         CALL PintaCuadrao1
 91+  A469 C9               RET
 92+  A46A              seAcaba:
 93+  A46A 3E 46            ld a, "F"
 94+  A46C 32 73 9B         ld(Caracter), A
 95+  A46F C9               ret
 96+  A470
 97+  A470              CAMBIAR_USUARIO:
 98+  A470 CD A4 A3         CALL BORRAR_FICHA1
 99+  A473 CD 36 A3         CALL Animacion_Caeficha
100+  A476
101+  A476                  ; Comprobar si hay 4 en raya (Caracter = 'F') y salir inmediatamente
102+  A476 3A 73 9B         ld a, (Caracter)
103+  A479 FE 46            cp 'F'
104+  A47B C8               ret z                  ; Si hay 4 en raya, salir sin cambiar usuario
105+  A47C
106+  A47C 3A 72 9B         ld a,(ColumnaFull);comprobamos si la columna ha estado llena
107+  A47F FE 01            cp 1
108+  A481 CA EC A4         jp z, nohaycambio
109+  A484 3A 74 9B         LD A, (Color_Usuario)   ; carga el color actual
110+  A487 FE 06            CP TINTA_Yel            ; comparo con amarillo
111+  A489 20 C8            JR NZ, ES_ROJO          ; si es amarillo se cambia a rojo
112+  A48B 3E 02            LD A, TINTA_Red         ; cambiar a rojo (sin papel)
113+  A48D 32 74 9B         LD (Color_Usuario), A
114+  A490 26 00            LD H,0
115+  A492 2E 00            ld L,0    ; Restaurar posición inicial
116+  A494              ES_ROJOYNolocambio:
117+  A494 CD 94 A3         CALL PintaCuadrao1
118+  A497              L21:
119+  A497 C5               PUSH BC                 ; Guardar BC al inicio del bucle
120+  A498 01 FE DF         LD BC,$DFFE
121+  A49B ED 78            IN A,(C)
122+  A49D CB 47            BIT 0,A
123+  A49F 20 0E            JR NZ,L22
124+  A4A1 CD 2A A6         CALL SOLTAR_TECLA
125+  A4A4 3E 50            LD A,'P'
126+  A4A6 32 73 9B         LD (Caracter),A
127+  A4A9 C1               POP BC
128+  A4AA CD DB A3         CALL MOVER_DERECHA
129+  A4AD 18 E8            jr L21
130+  A4AF              L22:
131+  A4AF CB 4F            BIT 1,A
132+  A4B1 20 0E            JR NZ,L23
133+  A4B3 CD 2A A6         CALL SOLTAR_TECLA
134+  A4B6 3E 4F            LD A,'O'
135+  A4B8 32 73 9B         LD (Caracter),A
136+  A4BB C1               POP BC
137+  A4BC CD EC A3         CALL MOVER_IZQUIERDA
138+  A4BF 18 D6            jr L21
139+  A4C1              L23:
140+  A4C1 01 FE FD         LD BC,$FDFE
141+  A4C4 ED 78            IN A,(C)
142+  A4C6 CB 5F            BIT 3,A
143+  A4C8 20 0A            JR NZ,L24
144+  A4CA CD 2A A6         CALL SOLTAR_TECLA
145+  A4CD 3E 46            LD A,'F'
146+  A4CF 32 73 9B         LD (Caracter),A
147+  A4D2 C1               POP BC
148+  A4D3 C9               RET
149+  A4D4              L24:                     ; Este cambia porque es RETURN y se carga como carácter $FF
150+  A4D4 01 FE BF         LD BC,$BFFE
151+  A4D7 ED 78            IN A,(C)
152+  A4D9 CB 47            BIT 0,A
153+  A4DB 20 0B            JR NZ,L25
154+  A4DD CD 2A A6         CALL SOLTAR_TECLA
155+  A4E0 3E FF            LD A,$FF
156+  A4E2 32 73 9B         LD (Caracter),A
157+  A4E5 C1               POP BC
158+  A4E6 18 88            jr CAMBIAR_USUARIO
159+  A4E8              L25:
160+  A4E8 C1               POP BC              ; Limpiar stack si no se presionó ninguna tecla
161+  A4E9 18 AC            jr L21
162+  A4EB
163+  A4EB C9               RET
164+  A4EC              nohaycambio:
165+  A4EC AF               xor a
166+  A4ED 32 72 9B         ld (ColumnaFull), a
167+  A4F0 3A 74 9B         LD A, (Color_Usuario)   ; carga el color actual
168+  A4F3 FE 06            CP TINTA_Yel            ; comparo con amarillo
169+  A4F5 C2 94 A4         JP NZ, ES_ROJOYNolocambio
170+  A4F8 C3 01 A4         JP ES_AMARILLOYNolocambio
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\telasNuevas.asm
103   A4FB                      INCLUDE "juego1.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\juego1.asm
  1+  A4FB              JUEGO:
  2+  A4FB                  ; REINICIAR VARIABLES AL INICIO DE CADA PARTIDA
  3+  A4FB AF               XOR A
  4+  A4FC 32 71 9B         LD (FullTablero), A    ; Reiniciar flag de tablero lleno
  5+  A4FF 32 72 9B         LD (ColumnaFull), A    ; Reiniciar flag de columna llena
  6+  A502
  7+  A502                  ; LIMPIAR TABLERO Posiciones1 (6 filas x 9 bytes)
  8+  A502 CD 1F A5         CALL LimpiarTablero
  9+  A505
 10+  A505 CD BC 9F         CALL TABLERO_REDONDO
 11+  A508
 12+  A508                  ; Reiniciar color del usuario a amarillo DESPUES de TABLERO_REDONDO
 13+  A508                  ; (TABLERO_REDONDO modifica Color_Usuario internamente)
 14+  A508 3E 06            LD A, TINTA_Yel
 15+  A50A 32 74 9B         LD (Color_Usuario), A
 16+  A50D
 17+  A50D 26 00            LD H, 0
 18+  A50F 2E 00            LD L, 0
 19+  A511 CD 94 A3         CALL PintaCuadrao1
 20+  A514              JUEGOEMPEZADO:
 21+  A514 CD 04 A4         CALL TECLAS
 22+  A517 3A 73 9B         LD A,(Caracter)
 23+  A51A FE 46            CP 'F'
 24+  A51C 20 F6            jr nz, JUEGOEMPEZADO
 25+  A51E C9               RET
 26+  A51F
 27+  A51F              ; RUTINA: Limpia el tablero Posiciones1 poniendo 0 en las casillas y $FF en los bordes
 28+  A51F              LimpiarTablero:
 29+  A51F F5               PUSH AF
 30+  A520 C5               PUSH BC
 31+  A521 DD E5            PUSH IX
 32+  A523
 33+  A523 DD 21 9F 9B      LD IX, Posiciones1
 34+  A527 06 06            LD B, 6                ; 6 filas
 35+  A529              LimpiarFila:
 36+  A529 DD 36 00 FF      LD (IX), $FF           ; Borde izquierdo
 37+  A52D DD 36 01 00      LD (IX+1), 0           ; Columnas 0-6 a 0 (vacio)
 38+  A531 DD 36 02 00      LD (IX+2), 0
 39+  A535 DD 36 03 00      LD (IX+3), 0
 40+  A539 DD 36 04 00      LD (IX+4), 0
 41+  A53D DD 36 05 00      LD (IX+5), 0
 42+  A541 DD 36 06 00      LD (IX+6), 0
 43+  A545 DD 36 07 00      LD (IX+7), 0
 44+  A549 DD 36 08 FF      LD (IX+8), $FF         ; Borde derecho
 45+  A54D 11 09 00         LD DE, 9
 46+  A550 DD 19            ADD IX, DE             ; Siguiente fila
 47+  A552 10 D5            DJNZ LimpiarFila
 48+  A554
 49+  A554 DD E1            POP IX
 50+  A556 C1               POP BC
 51+  A557 F1               POP AF
 52+  A558 C9               RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\juego1.asm
104   A559                      INCLUDE "terminar.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\terminar.asm
  1+  A559              ;para saber si el juego ha terminado mirar primera fila si hay 0. Las primeras 7 filas está claro
  2+  A559              Tablero_lleno:
  3+  A559 F5               push af
  4+  A55A DD E5            push ix
  5+  A55C C5               push bc
  6+  A55D
  7+  A55D DD 21 A0 9B      ld ix, Posiciones1 +1
  8+  A561 06 07            ld b,7
  9+  A563              bucle_compurebo:
 10+  A563 DD 7E 00         ld a, (ix)
 11+  A566 B7               or a
 12+  A567 28 09            jr z, nolleno
 13+  A569 DD 23            inc ix
 14+  A56B 10 F6            djnz bucle_compurebo
 15+  A56D                  ;si pasa por aquí está lleno
 16+  A56D 3E 01            ld a, 1
 17+  A56F 32 71 9B         ld(FullTablero), a
 18+  A572              nolleno:
 19+  A572 C1               pop bc
 20+  A573 DD E1            pop ix
 21+  A575 F1               pop af
 22+  A576 C9               ret
 23+  A577
 24+  A577              tamcolumna EQU 9
 25+  A577
 26+  A577              ; Entrada: H = fila (0-5), L = columna (0-6) donde cayo la ficha
 27+  A577              ; Salida: Carry=1 si hay 4 en raya, Carry=0 si no
 28+  A577              ; Si hay 4 en raya, pone Caracter='F' para que el juego pare
 29+  A577              ; Usa Posiciones1 con bordes $FF como topes
 30+  A577              Comprobar4enraya:
 31+  A577 F5               push af
 32+  A578 C5               push bc
 33+  A579 D5               push de
 34+  A57A E5               push hl
 35+  A57B DD E5            push ix
 36+  A57D
 37+  A57D                  ; Usar SlotPointer_Array para calcular direccion en Posiciones1
 38+  A57D CD 15 A6         call SlotPointer_Array   ; IX = direccion de la ficha en Posiciones1
 39+  A580
 40+  A580 DD 4E 00         ld c, (ix)           ; C = color de la ficha (TINTA_Yel=6 o TINTA_Red=2)
 41+  A583
 42+  A583                  ; Guardar IX para restaurar en cada comprobacion
 43+  A583 DD E5            push ix
 44+  A585
 45+  A585                  ; 1) HORIZONTAL (izquierda <-> derecha): DE = 1
 46+  A585 11 01 00         ld de, 1
 47+  A588 CD D2 A5         call cb1
 48+  A58B FE 04            cp 4
 49+  A58D 30 34            jr nc, hay_4enraya_pop
 50+  A58F
 51+  A58F                  ; 2) VERTICAL (arriba <-> abajo): DE = 9 (tamcolumna)
 52+  A58F DD E1            pop ix
 53+  A591 DD E5            push ix
 54+  A593 11 09 00         ld de, tamcolumna
 55+  A596 CD D2 A5         call cb1
 56+  A599 FE 04            cp 4
 57+  A59B 30 26            jr nc, hay_4enraya_pop
 58+  A59D
 59+  A59D                  ; 3) DIAGONAL \ (arriba-izq <-> abajo-der): DE = 10 (tamcolumna+1)
 60+  A59D DD E1            pop ix
 61+  A59F DD E5            push ix
 62+  A5A1 11 0A 00         ld de, tamcolumna + 1
 63+  A5A4 CD D2 A5         call cb1
 64+  A5A7 FE 04            cp 4
 65+  A5A9 30 18            jr nc, hay_4enraya_pop
 66+  A5AB
 67+  A5AB                  ; 4) DIAGONAL / (arriba-der <-> abajo-izq): DE = 8 (tamcolumna-1)
 68+  A5AB DD E1            pop ix
 69+  A5AD DD E5            push ix
 70+  A5AF 11 08 00         ld de, tamcolumna - 1
 71+  A5B2 CD D2 A5         call cb1
 72+  A5B5 FE 04            cp 4
 73+  A5B7 30 0A            jr nc, hay_4enraya_pop
 74+  A5B9
 75+  A5B9                  ; No hay 4 en raya
 76+  A5B9 DD E1            pop ix               ; limpiar stack
 77+  A5BB DD E1            pop ix
 78+  A5BD E1               pop hl
 79+  A5BE D1               pop de
 80+  A5BF C1               pop bc
 81+  A5C0 F1               pop af
 82+  A5C1 B7               or a                 ; Carry = 0
 83+  A5C2 C9               ret
 84+  A5C3
 85+  A5C3              hay_4enraya_pop:
 86+  A5C3 DD E1            pop ix               ; limpiar stack
 87+  A5C5              hay_4enraya:
 88+  A5C5 3E 46            ld a, 'F'
 89+  A5C7 32 73 9B         ld (Caracter), a
 90+  A5CA DD E1            pop ix
 91+  A5CC E1               pop hl
 92+  A5CD D1               pop de
 93+  A5CE C1               pop bc
 94+  A5CF F1               pop af
 95+  A5D0 37               scf                  ; Carry = 1
 96+  A5D1 C9               ret
 97+  A5D2
 98+  A5D2              ; Subrutina: Contar fichas consecutivas en ambas direcciones
 99+  A5D2              ; Entrada: IX = posicion central, C = color a buscar, DE = desplazamiento
100+  A5D2              ; Salida: A = total de fichas consecutivas
101+  A5D2              ; Los bordes $FF actuan como tope (nunca coinciden con color 2 o 6)
102+  A5D2              cb1:
103+  A5D2 DD E5            push ix              ; guardar posicion central
104+  A5D4 06 01            ld b, 1              ; B = contador (1 por la ficha central)
105+  A5D6 D5               push de              ; guardar DE
106+  A5D7
107+  A5D7                  ; Contar en direccion positiva (+DE)
108+  A5D7              cb2_bucle1:
109+  A5D7 DD 19            add ix, de
110+  A5D9 DD 7E 00         ld a, (ix)           ; Leer casilla
111+  A5DC B9               cp c                 ; Es del mismo color? (si es $FF o 0 o diferente, para)
112+  A5DD 20 03            jr nz, cb1_seguir
113+  A5DF 04               inc b
114+  A5E0 18 F5            jr cb2_bucle1
115+  A5E2
116+  A5E2              cb1_seguir:
117+  A5E2                  ; Restaurar para direccion negativa
118+  A5E2 D1               pop de
119+  A5E3 DD E1            pop ix
120+  A5E5 DD E5            push ix
121+  A5E7
122+  A5E7                  ; Negar DE
123+  A5E7 AF               xor a
124+  A5E8 93               sub e
125+  A5E9 5F               ld e, a
126+  A5EA 3E 00            ld a, 0
127+  A5EC 9A               sbc a, d
128+  A5ED 57               ld d, a              ; DE = -DE
129+  A5EE
130+  A5EE                  ; Contar en direccion negativa
131+  A5EE              cb2_bucle2:
132+  A5EE DD 19            add ix, de
133+  A5F0 DD 7E 00         ld a, (ix)           ; Leer casilla
134+  A5F3 B9               cp c                 ; Es del mismo color?
135+  A5F4 20 03            jr nz, cb1_fin
136+  A5F6 04               inc b
137+  A5F7 18 F5            jr cb2_bucle2
138+  A5F9
139+  A5F9              cb1_fin:
140+  A5F9 DD E1            pop ix
141+  A5FB 78               ld a, b              ; A = total
142+  A5FC C9               ret
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\terminar.asm
105   A5FD                     INCLUDE "slotpointer.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\slotpointer.asm
  1+  A5FD              SlotPointer: ;h fila, l columna y te devuelve coordenada de atributos
  2+  A5FD 7C               ld a,h
  3+  A5FE CB 27            sla a
  4+  A600 CB 27            sla a
  5+  A602 CB 27            sla a
  6+  A604 CB 27            sla a
  7+  A606 CB 27            sla a
  8+  A608 B5               or L
  9+  A609 6F               ld l,a
 10+  A60A 7C               ld a,h
 11+  A60B CB 2F            sra a
 12+  A60D CB 2F            sra a
 13+  A60F CB 2F            sra a
 14+  A611 F6 58            or $58
 15+  A613 67               ld h,a
 16+  A614 C9               ret
 17+  A615
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\slotpointer.asm
106   A615                     INCLUDE "SlotPointer_PosicionesArray.asm"
# file opened: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\SlotPointer_PosicionesArray.asm
  1+  A615              ; SlotPointer para el array Posiciones1
  2+  A615              ; Similar a SlotPointer pero calcula la direccion en Posiciones1 en vez de atributos de pantalla
  3+  A615              ; Entrada: H = fila (0-5), L = columna (0-6)
  4+  A615              ; Salida: IX = direccion en Posiciones1
  5+  A615              ; Modifica: A, DE, IX
  6+  A615              SlotPointer_Array:
  7+  A615 7C               ld a, h              ; A = fila
  8+  A616 47               ld b, a              ; B = fila (guardar)
  9+  A617
 10+  A617                  ; fila * 9 = fila*8 + fila
 11+  A617 CB 27            sla a                ; A = fila*2
 12+  A619 CB 27            sla a                ; A = fila*4
 13+  A61B CB 27            sla a                ; A = fila*8
 14+  A61D 80               add a, b             ; A = fila*9
 15+  A61E 85               add a, l             ; A = fila*9 + columna
 16+  A61F 3C               inc a                ; +1 por borde $FF izquierdo
 17+  A620
 18+  A620 5F               ld e, a
 19+  A621 16 00            ld d, 0
 20+  A623 DD 21 9F 9B      ld ix, Posiciones1
 21+  A627 DD 19            add ix, de           ; IX = Posiciones1 + offset
 22+  A629 C9               ret
 23+  A62A
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\SlotPointer_PosicionesArray.asm
107   A62A
108   A62A
109   A62A
110   A62A
111   A62A
112   A62A              SOLTAR_TECLA:
113   A62A ED 78               IN A, (C)
114   A62C E6 1F               AND $1F ;ASEGURA QUE LOS BITS DE A (0-7) LOS PRIMEROS 5 SON LOS Q NOS INTERESAN, ASEGURA QUE A VALGA %00011111
115   A62E FE 1F               CP $1F ;COMPRUEBA SI SE HA ESCRITO ALGO PORQUE SI VALE 1F SIGNIFICA QUE NO SE HA PULSADO TECLAS
116   A630 20 F8               JR NZ, SOLTAR_TECLA ;SI Z=0 (ES DECIR, A ES DISTINTO DE $1F), LA TECLA SIGUE PULSADA ENTONCES BUCLE HASTA QUE EL USUARIO LA SUELTE
117   A632 C9                  RET
118   A633
119   A633
120   A633
121   A633
122   A633
123   A633
124   A633              LEER_SN:
125   A633 C5                  PUSH BC
126   A634              SN_0:
127   A634 01 FE FD            LD BC, $FDFE ;'S' en D1
128   A637 ED 78               IN A, (C)
129   A639 CB 4F               BIT 1, A
130   A63B 20 0B               JR NZ, SN_1
131   A63D CD 2A A6            CALL SOLTAR_TECLA
132   A640 3E 53               LD A, 'S'
133   A642 CD A9 9C            CALL CLEARSCR
134   A645                     ;Z=1
135   A645 AF                  XOR A
136   A646 C1                  POP BC
137   A647 C9                  RET
138   A648
139   A648              SN_1:
140   A648 01 FE 7F            LD BC, $7FFE ;'N' en D3
141   A64B ED 78               IN A, (C)
142   A64D CB 5F               BIT 3, A
143   A64F 20 E3               JR NZ, SN_0
144   A651 CD 2A A6            CALL SOLTAR_TECLA
145   A654 3E 4E               LD A, 'N'
146   A656 CD A9 9C            CALL CLEARSCR
147   A659 3E 00               LD A, 0
148   A65B D3 FE               OUT ($FE), A
149   A65D CD A9 9C            CALL CLEARSCR
150   A660 06 0C               LD B, 12
151   A662 0E 0C               LD C, 12
152   A664 3E 50               LD A, 0+2*8+64
153   A666 DD 21 2D 9B         LD IX, M_GB
154   A66A CD 38 9C            CALL PRINTAT
155   A66D                     ;Z=0
156   A66D 3E 01               LD A, 1
157   A66F B7                  OR A
158   A670 C1                  POP BC
159   A671 C9                  RET
# file closed: C:\Users\mario\.vscode\Workspace\Arquitectura Computadores\Rutina bienvenida 4 en raya\main.asm
